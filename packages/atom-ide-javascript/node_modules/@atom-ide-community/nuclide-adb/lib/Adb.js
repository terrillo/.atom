"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Adb = void 0;

var _assert = _interopRequireDefault(require("assert"));

var _nuclideUri = _interopRequireDefault(require("@atom-ide-community/nuclide-commons/nuclideUri"));

var _rxjsCompatUmdMin = require("rxjs-compat/bundles/rxjs-compat.umd.min.js");

var _ps = require("./common/ps");

var _process = require("@atom-ide-community/nuclide-commons/process");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */
const ADB_TIMEOUT = 5000;

class Adb {
  constructor(serial) {
    this._serial = void 0;
    this._serial = serial;
  }

  getAndroidProp(key) {
    return this.runShortCommand('shell', 'getprop', key).map(s => s.trim());
  }

  getDeviceArchitecture() {
    return this.getAndroidProp('ro.product.cpu.abi');
  }

  async getInstalledPackages() {
    const prefix = 'package:';
    const stdout = await this.runShortCommand('shell', 'pm', 'list', 'packages').toPromise();
    return stdout.trim().split(/\s+/).map(s => s.substring(prefix.length));
  }

  async isPackageInstalled(pkg) {
    const packages = await this.getInstalledPackages();
    return packages.includes(pkg);
  }

  getDeviceModel() {
    return this.getAndroidProp('ro.product.model').map(s => s === 'sdk' ? 'emulator' : s);
  }

  getAPIVersion() {
    return this.getAndroidProp('ro.build.version.sdk');
  }

  getBrand() {
    return this.getAndroidProp('ro.product.brand');
  }

  getManufacturer() {
    return this.getAndroidProp('ro.product.manufacturer');
  }

  getDeviceInfo() {
    const unknownCB = () => _rxjsCompatUmdMin.Observable.of('');

    return _rxjsCompatUmdMin.Observable.forkJoin(this.getDeviceArchitecture().catch(unknownCB), this.getAPIVersion().catch(unknownCB), this.getDeviceModel().catch(unknownCB), this.getOSVersion().catch(unknownCB), this.getManufacturer().catch(unknownCB), this.getBrand().catch(unknownCB), this.getWifiIp().catch(unknownCB)).map(([architecture, apiVersion, model, android_version, manufacturer, brand, wifi_ip]) => {
      return new Map([['name', this._serial], ['adb_port', '5037'], ['architecture', architecture], ['api_version', apiVersion], ['model', model], ['android_version', android_version], ['manufacturer', manufacturer], ['brand', brand], ['wifi_ip', wifi_ip]]);
    });
  }

  getWifiIp() {
    return this.runShortCommand('shell', 'ip', 'addr', 'show', 'wlan0').map(lines => {
      const line = lines.split(/\n/).filter(l => l.includes('inet'))[0];

      if (line == null) {
        return '';
      }

      const rawIp = line.trim().split(/\s+/)[1];
      return rawIp.substring(0, rawIp.indexOf('/'));
    });
  } // In some android devices, we have to kill the package, not the process.
  // http://stackoverflow.com/questions/17154961/adb-shell-operation-not-permitted


  async stopProcess(packageName, pid) {
    await Promise.all([this.runShortCommand('shell', 'am', 'force-stop', packageName).toPromise(), this.runShortCommand('shell', 'kill', '-9', `${pid}`).toPromise(), this.runShortCommand('shell', 'run-as', packageName, 'kill', '-9', `${pid}`).toPromise()]);
  }

  getOSVersion() {
    return this.getAndroidProp('ro.build.version.release');
  }

  installPackage(packagePath) {
    (0, _assert.default)(!_nuclideUri.default.isRemote(packagePath));
    return this.getAPIVersion().map(version => parseInt(version, 10) >= 17).catch(() => _rxjsCompatUmdMin.Observable.of(false)).switchMap(canUseDowngradeOption => this.runLongCommandNew(...['install', '-r', // The -d option allows downgrades, which happen frequently during development.
    ...(canUseDowngradeOption ? ['-d'] : []), packagePath])) // adb install sends a lot of identical progress events to stdout, deduplicate them
    .distinctUntilChanged((a, b) => {
      if (a.kind === 'stdout' && b.kind === 'stdout') {
        return a.data === b.data;
      } else {
        return false;
      }
    });
  }

  uninstallPackage(packageName) {
    // TODO(T17463635)
    return this.runLongCommand('uninstall', packageName);
  }

  async getForwardSpec(pid) {
    const specLines = await this.runShortCommand('forward', '--list').toPromise();
    const specs = specLines.split(/\n/).map(line => {
      const cols = line.split(/\s+/);
      return {
        spec: cols[1],
        target: cols[2]
      };
    });
    const matchingSpec = specs.find(spec => spec.target === `jdwp:${pid}`);

    if (matchingSpec != null) {
      return matchingSpec.spec;
    }

    return null;
  }

  async forwardJdwpPortToPid(tcpPort, pid) {
    await this.runShortCommand('forward', `tcp:${tcpPort}`, `jdwp:${pid}`).toPromise();
    return this.getForwardSpec(pid);
  }

  async removeJdwpForwardSpec(spec) {
    let output;
    let result = '';

    if (spec != null) {
      output = this.runLongCommand('forward', '--remove', spec);
    } else {
      output = this.runLongCommand('forward', '--remove-all');
    }

    const subscription = output.subscribe(processMessage => {
      switch (processMessage.kind) {
        case 'stdout':
        case 'stderr':
          result += processMessage.data + '\n';
          break;
      }
    });
    await output.toPromise();
    subscription.unsubscribe();
    return result;
  }

  async launchActivity(packageName, activity, debug, action, parameters) {
    if (debug) {
      // Enable "wait for debugger" semantics for the next launch of
      // the specified package.
      await this.setDebugApp(packageName, false);
    }

    const args = ['shell', 'am', 'start'];

    if (action != null) {
      args.push('-a', action);
    }

    if (parameters != null) {
      for (const [key, parameter] of parameters) {
        args.push('-e', key, parameter);
      }
    }

    args.push('-W', '-n');
    args.push(`${packageName}/${activity}`);
    return this.runShortCommand(...args).toPromise();
  }

  async launchMainActivity(packageName, debug) {
    if (debug) {
      // Enable "wait for debugger" semantics for the next launch of
      // the specified package.
      await this.setDebugApp(packageName, false);
    }

    const args = ['shell', 'monkey', '-p', `${packageName}`, '-c', 'android.intent.category.LAUNCHER', '1'];
    return this.runShortCommand(...args).toPromise();
  }

  async launchService(packageName, serviceName, debug) {
    if (debug) {
      // Enable "wait for debugger" semantics for the next launch of
      // the specified package.
      await this.setDebugApp(packageName, false);
    }

    const args = ['shell', 'am', 'startservice', `${packageName}/${serviceName}`];
    return this.runShortCommand(...args).toPromise();
  }

  setDebugApp(packageName, persist) {
    const args = ['shell', 'am', 'set-debug-app', '-w'];

    if (persist) {
      args.push('--persistent');
    }

    args.push(`${packageName}`);
    return this.runShortCommand(...args).toPromise();
  }

  _dumpsysPackage() {
    return this.runShortCommand('shell', 'dumpsys', 'package');
  }

  activityExists(packageName, activity) {
    const packageActivityString = `${packageName}/${activity}`;
    return this._dumpsysPackage().map(stdout => stdout.includes(packageActivityString)).toPromise();
  }

  getAllAvailablePackages() {
    return this._dumpsysPackage().map(stdout => stdout.split('\n').map(line => line.trim())).toPromise();
  }

  touchFile(path) {
    return this.runShortCommand('shell', 'touch', path).toPromise();
  }

  removeFile(path) {
    return this.runShortCommand('shell', 'rm', path).toPromise();
  }

  getDebuggableProcesses() {
    return this.getJavaProcesses();
  }

  getJavaProcesses() {
    const jdwpProcesses = new Set();
    return this.runPsCommand().map(stdout => {
      const psOutput = stdout.trim();
      return (0, _ps.parsePsTableOutput)(psOutput, ['user', 'pid', 'name']);
    }).switchMap(allProcesses => {
      const map = new Map();
      allProcesses.filter(row => row != null).forEach(proc => map.set(proc.pid, proc));
      return Promise.resolve(map);
    }).switchMap(allProcessesMap => {
      return this.runLongCommand('jdwp').map(output => {
        if (output.kind === 'stdout') {
          const block = output.data;
          block.split(/\s+/).forEach(pid => {
            const proc = allProcessesMap.get(pid);

            if (proc != null) {
              jdwpProcesses.add(proc);
            }
          });
        }
      });
    }).timeout(1000).catch(error => _rxjsCompatUmdMin.Observable.of([])).switchMap(() => {
      return Promise.resolve(Array.from(jdwpProcesses));
    });
  }

  async dumpsysPackage(pkg) {
    if (!(await this.isPackageInstalled(pkg))) {
      return null;
    }

    return this.runShortCommand('shell', 'dumpsys', 'package', pkg).toPromise();
  }

  getDeviceArgs() {
    return this._serial !== '' ? ['-s', this._serial] : [];
  }

  getProcesses() {
    return this.runPsCommand().map(stdout => stdout.split(/\n/).map(line => {
      const info = line.trim().split(/\s+/);
      return {
        user: info[0],
        pid: info[1],
        name: info[info.length - 1]
      };
    }));
  }

  runPsCommand(...additionalCommands) {
    return this.getAPIVersion().switchMap(apiVersion => {
      let commands = ['shell', 'ps']; // Starting with Android 8.0 Oreo (API 26) ps only returns all processes
      // with -A

      if (parseInt(apiVersion, 10) >= 26) {
        commands.push('-A');
      }

      commands = commands.concat(additionalCommands);
      return this.runShortCommand(...commands);
    });
  }

  runShortCommand(...command) {
    return (0, _process.runCommand)('adb', this.getDeviceArgs().concat(command));
  }

  runLongCommand(...command) {
    // TODO(T17463635)
    return (0, _process.observeProcess)('adb', this.getDeviceArgs().concat(command), {
      killTreeWhenDone: true,

      /* TODO(T17353599) */
      isExitError: () => false
    }).catch(error => _rxjsCompatUmdMin.Observable.of({
      kind: 'error',
      error
    })); // TODO(T17463635)
  }

  runLongCommandNew(...command) {
    return (0, _process.observeProcess)('adb', this.getDeviceArgs().concat(command), {
      killTreeWhenDone: true
    });
  }

  static _parseDevicesCommandOutput(stdout) {
    const nameFrequency = new Map();
    return stdout.split(/\n+/g).slice(1).filter(s => s.length > 0 && !s.trim().startsWith('*')).map(s => s.split(/\s+/g)).filter(a => a[0] !== '').map(a => {
      const serial = a[0];
      const props = a.slice(2);
      let product;
      let model;
      let device;
      let usb;
      let transportId;

      for (const prop of props) {
        const pair = prop.split(':');

        if (pair.length !== 2) {
          continue;
        }

        switch (pair[0]) {
          case 'product':
            product = pair[1];
            break;

          case 'model':
            model = pair[1];
            break;

          case 'device':
            device = pair[1];
            break;

          case 'usb':
            usb = pair[1];
            break;

          case 'transport_id':
            transportId = pair[1];
            break;

          default:
            break;
        }
      }

      const displayName = serial.startsWith('emulator') || serial.startsWith('localhost:') || model == null ? serial : model;
      const count = nameFrequency.get(displayName);

      if (count == null) {
        nameFrequency.set(displayName, 1);
      } else {
        nameFrequency.set(displayName, count + 1);
      }

      return {
        serial,
        displayName,
        product,
        model,
        device,
        usb,
        transportId
      };
    }).map(device => {
      const {
        displayName,
        serial
      } = device;

      if (displayName === serial || nameFrequency.get(displayName) === 1) {
        return device;
      } else {
        return { ...device,
          displayName: `${displayName} - ${serial}`
        };
      }
    });
  }

  static getDevices() {
    return (0, _process.runCommand)('adb', ['devices', '-l']).map(stdout => this._parseDevicesCommandOutput(stdout)).timeout(ADB_TIMEOUT).toPromise();
  }

  static killServer() {
    return (0, _process.runCommand)('adb', ['kill-server']).mapTo(undefined).toPromise();
  }

  static getVersion() {
    return (0, _process.runCommand)('adb', ['version']).map(versionString => {
      const version = versionString.match(/version (\d+.\d+.\d+)/);

      if (version) {
        return version[1];
      }

      throw new Error(`No version found with "${versionString}"`);
    }).toPromise();
  }

}

exports.Adb = Adb;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL251Y2xpZGUvbnVjbGlkZS1hZGIvbGliL0FkYi5qcyJdLCJuYW1lcyI6WyJBREJfVElNRU9VVCIsIkFkYiIsImNvbnN0cnVjdG9yIiwic2VyaWFsIiwiX3NlcmlhbCIsImdldEFuZHJvaWRQcm9wIiwia2V5IiwicnVuU2hvcnRDb21tYW5kIiwibWFwIiwicyIsInRyaW0iLCJnZXREZXZpY2VBcmNoaXRlY3R1cmUiLCJnZXRJbnN0YWxsZWRQYWNrYWdlcyIsInByZWZpeCIsInN0ZG91dCIsInRvUHJvbWlzZSIsInNwbGl0Iiwic3Vic3RyaW5nIiwibGVuZ3RoIiwiaXNQYWNrYWdlSW5zdGFsbGVkIiwicGtnIiwicGFja2FnZXMiLCJpbmNsdWRlcyIsImdldERldmljZU1vZGVsIiwiZ2V0QVBJVmVyc2lvbiIsImdldEJyYW5kIiwiZ2V0TWFudWZhY3R1cmVyIiwiZ2V0RGV2aWNlSW5mbyIsInVua25vd25DQiIsIk9ic2VydmFibGUiLCJvZiIsImZvcmtKb2luIiwiY2F0Y2giLCJnZXRPU1ZlcnNpb24iLCJnZXRXaWZpSXAiLCJhcmNoaXRlY3R1cmUiLCJhcGlWZXJzaW9uIiwibW9kZWwiLCJhbmRyb2lkX3ZlcnNpb24iLCJtYW51ZmFjdHVyZXIiLCJicmFuZCIsIndpZmlfaXAiLCJNYXAiLCJsaW5lcyIsImxpbmUiLCJmaWx0ZXIiLCJsIiwicmF3SXAiLCJpbmRleE9mIiwic3RvcFByb2Nlc3MiLCJwYWNrYWdlTmFtZSIsInBpZCIsIlByb21pc2UiLCJhbGwiLCJpbnN0YWxsUGFja2FnZSIsInBhY2thZ2VQYXRoIiwibnVjbGlkZVVyaSIsImlzUmVtb3RlIiwidmVyc2lvbiIsInBhcnNlSW50Iiwic3dpdGNoTWFwIiwiY2FuVXNlRG93bmdyYWRlT3B0aW9uIiwicnVuTG9uZ0NvbW1hbmROZXciLCJkaXN0aW5jdFVudGlsQ2hhbmdlZCIsImEiLCJiIiwia2luZCIsImRhdGEiLCJ1bmluc3RhbGxQYWNrYWdlIiwicnVuTG9uZ0NvbW1hbmQiLCJnZXRGb3J3YXJkU3BlYyIsInNwZWNMaW5lcyIsInNwZWNzIiwiY29scyIsInNwZWMiLCJ0YXJnZXQiLCJtYXRjaGluZ1NwZWMiLCJmaW5kIiwiZm9yd2FyZEpkd3BQb3J0VG9QaWQiLCJ0Y3BQb3J0IiwicmVtb3ZlSmR3cEZvcndhcmRTcGVjIiwib3V0cHV0IiwicmVzdWx0Iiwic3Vic2NyaXB0aW9uIiwic3Vic2NyaWJlIiwicHJvY2Vzc01lc3NhZ2UiLCJ1bnN1YnNjcmliZSIsImxhdW5jaEFjdGl2aXR5IiwiYWN0aXZpdHkiLCJkZWJ1ZyIsImFjdGlvbiIsInBhcmFtZXRlcnMiLCJzZXREZWJ1Z0FwcCIsImFyZ3MiLCJwdXNoIiwicGFyYW1ldGVyIiwibGF1bmNoTWFpbkFjdGl2aXR5IiwibGF1bmNoU2VydmljZSIsInNlcnZpY2VOYW1lIiwicGVyc2lzdCIsIl9kdW1wc3lzUGFja2FnZSIsImFjdGl2aXR5RXhpc3RzIiwicGFja2FnZUFjdGl2aXR5U3RyaW5nIiwiZ2V0QWxsQXZhaWxhYmxlUGFja2FnZXMiLCJ0b3VjaEZpbGUiLCJwYXRoIiwicmVtb3ZlRmlsZSIsImdldERlYnVnZ2FibGVQcm9jZXNzZXMiLCJnZXRKYXZhUHJvY2Vzc2VzIiwiamR3cFByb2Nlc3NlcyIsIlNldCIsInJ1blBzQ29tbWFuZCIsInBzT3V0cHV0IiwiYWxsUHJvY2Vzc2VzIiwicm93IiwiZm9yRWFjaCIsInByb2MiLCJzZXQiLCJyZXNvbHZlIiwiYWxsUHJvY2Vzc2VzTWFwIiwiYmxvY2siLCJnZXQiLCJhZGQiLCJ0aW1lb3V0IiwiZXJyb3IiLCJBcnJheSIsImZyb20iLCJkdW1wc3lzUGFja2FnZSIsImdldERldmljZUFyZ3MiLCJnZXRQcm9jZXNzZXMiLCJpbmZvIiwidXNlciIsIm5hbWUiLCJhZGRpdGlvbmFsQ29tbWFuZHMiLCJjb21tYW5kcyIsImNvbmNhdCIsImNvbW1hbmQiLCJraWxsVHJlZVdoZW5Eb25lIiwiaXNFeGl0RXJyb3IiLCJfcGFyc2VEZXZpY2VzQ29tbWFuZE91dHB1dCIsIm5hbWVGcmVxdWVuY3kiLCJzbGljZSIsInN0YXJ0c1dpdGgiLCJwcm9wcyIsInByb2R1Y3QiLCJkZXZpY2UiLCJ1c2IiLCJ0cmFuc3BvcnRJZCIsInByb3AiLCJwYWlyIiwiZGlzcGxheU5hbWUiLCJjb3VudCIsImdldERldmljZXMiLCJraWxsU2VydmVyIiwibWFwVG8iLCJ1bmRlZmluZWQiLCJnZXRWZXJzaW9uIiwidmVyc2lvblN0cmluZyIsIm1hdGNoIiwiRXJyb3IiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFtQkE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUF2QkE7Ozs7Ozs7Ozs7O0FBeUJBLE1BQU1BLFdBQVcsR0FBRyxJQUFwQjs7QUFFTyxNQUFNQyxHQUFOLENBQVU7QUFHZkMsRUFBQUEsV0FBVyxDQUFDQyxNQUFELEVBQWlCO0FBQUEsU0FGNUJDLE9BRTRCO0FBQzFCLFNBQUtBLE9BQUwsR0FBZUQsTUFBZjtBQUNEOztBQUVERSxFQUFBQSxjQUFjLENBQUNDLEdBQUQsRUFBa0M7QUFDOUMsV0FBTyxLQUFLQyxlQUFMLENBQXFCLE9BQXJCLEVBQThCLFNBQTlCLEVBQXlDRCxHQUF6QyxFQUE4Q0UsR0FBOUMsQ0FBa0RDLENBQUMsSUFBSUEsQ0FBQyxDQUFDQyxJQUFGLEVBQXZELENBQVA7QUFDRDs7QUFFREMsRUFBQUEscUJBQXFCLEdBQXVCO0FBQzFDLFdBQU8sS0FBS04sY0FBTCxDQUFvQixvQkFBcEIsQ0FBUDtBQUNEOztBQUVELFFBQU1PLG9CQUFOLEdBQXFEO0FBQ25ELFVBQU1DLE1BQU0sR0FBRyxVQUFmO0FBQ0EsVUFBTUMsTUFBTSxHQUFHLE1BQU0sS0FBS1AsZUFBTCxDQUNuQixPQURtQixFQUVuQixJQUZtQixFQUduQixNQUhtQixFQUluQixVQUptQixFQUtuQlEsU0FMbUIsRUFBckI7QUFNQSxXQUFPRCxNQUFNLENBQ1ZKLElBREksR0FFSk0sS0FGSSxDQUVFLEtBRkYsRUFHSlIsR0FISSxDQUdBQyxDQUFDLElBQUlBLENBQUMsQ0FBQ1EsU0FBRixDQUFZSixNQUFNLENBQUNLLE1BQW5C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RCxTQUFPcUosVUFBUCxHQUErQztBQUM3QyxXQUFPLHlCQUFXLEtBQVgsRUFBa0IsQ0FBQyxTQUFELEVBQVksSUFBWixDQUFsQixFQUNKaEosR0FESSxDQUNBTSxNQUFNLElBQUksS0FBSzZILDBCQUFMLENBQWdDN0gsTUFBaEMsQ0FEVixFQUVKNkcsT0FGSSxDQUVJM0gsV0FGSixFQUdKZSxTQUhJLEVBQVA7QUFJRDs7QUFFRCxTQUFPMEksVUFBUCxHQUFtQztBQUNqQyxXQUFPLHlCQUFXLEtBQVgsRUFBa0IsQ0FBQyxhQUFELENBQWxCLEVBQ0pDLEtBREksQ0FDRUMsU0FERixFQUVKNUksU0FGSSxFQUFQO0FBR0Q7O0FBRUQsU0FBTzZJLFVBQVAsR0FBcUM7QUFDbkMsV0FBTyx5QkFBVyxLQUFYLEVBQWtCLENBQUMsU0FBRCxDQUFsQixFQUNKcEosR0FESSxDQUNBcUosYUFBYSxJQUFJO0FBQ3BCLFlBQU1uRyxPQUFPLEdBQUdtRyxhQUFhLENBQUNDLEtBQWQsQ0FBb0IsdUJBQXBCLENBQWhCOztBQUNBLFVBQUlwRyxPQUFKLEVBQWE7QUFDWCxlQUFPQSxPQUFPLENBQUMsQ0FBRCxDQUFkO0FBQ0Q7O0FBQ0QsWUFBTSxJQUFJcUcsS0FBSixDQUFXLDBCQUF5QkYsYUFBYyxHQUFsRCxDQUFOO0FBQ0QsS0FQSSxFQVFKOUksU0FSSSxFQUFQO0FBU0Q7O0FBeGZjIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENvcHlyaWdodCAoYykgMjAxNy1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxyXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4gKlxyXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBCU0Qtc3R5bGUgbGljZW5zZSBmb3VuZCBpbiB0aGVcclxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLiBBbiBhZGRpdGlvbmFsIGdyYW50XHJcbiAqIG9mIHBhdGVudCByaWdodHMgY2FuIGJlIGZvdW5kIGluIHRoZSBQQVRFTlRTIGZpbGUgaW4gdGhlIHNhbWUgZGlyZWN0b3J5LlxyXG4gKlxyXG4gKiBAZmxvdyBzdHJpY3QtbG9jYWxcclxuICogQGZvcm1hdFxyXG4gKi9cclxuXHJcbmltcG9ydCB0eXBlIHtBbmRyb2lkSmF2YVByb2Nlc3MsIFNpbXBsZVByb2Nlc3MsIEFkYkRldmljZX0gZnJvbSAnLi90eXBlcyc7XHJcbmltcG9ydCB0eXBlIHtcclxuICBMZWdhY3lQcm9jZXNzTWVzc2FnZSxcclxuICBQcm9jZXNzTWVzc2FnZSxcclxufSBmcm9tICdAYXRvbS1pZGUtY29tbXVuaXR5L251Y2xpZGUtY29tbW9ucy9wcm9jZXNzJztcclxuaW1wb3J0IHR5cGUge051Y2xpZGVVcml9IGZyb20gJ0BhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zL251Y2xpZGVVcmknO1xyXG5cclxuaW1wb3J0IGludmFyaWFudCBmcm9tICdhc3NlcnQnO1xyXG5pbXBvcnQgbnVjbGlkZVVyaSBmcm9tICdAYXRvbS1pZGUtY29tbXVuaXR5L251Y2xpZGUtY29tbW9ucy9udWNsaWRlVXJpJztcclxuaW1wb3J0IHtPYnNlcnZhYmxlfSBmcm9tICdyeGpzLWNvbXBhdC9idW5kbGVzL3J4anMtY29tcGF0LnVtZC5taW4uanMnO1xyXG5pbXBvcnQge3BhcnNlUHNUYWJsZU91dHB1dH0gZnJvbSAnLi9jb21tb24vcHMnO1xyXG5pbXBvcnQge3J1bkNvbW1hbmQsIG9ic2VydmVQcm9jZXNzfSBmcm9tICdAYXRvbS1pZGUtY29tbXVuaXR5L251Y2xpZGUtY29tbW9ucy9wcm9jZXNzJztcclxuXHJcbmNvbnN0IEFEQl9USU1FT1VUID0gNTAwMDtcclxuXHJcbmV4cG9ydCBjbGFzcyBBZGIge1xyXG4gIF9zZXJpYWw6IHN0cmluZztcclxuXHJcbiAgY29uc3RydWN0b3Ioc2VyaWFsOiBzdHJpbmcpIHtcclxuICAgIHRoaXMuX3NlcmlhbCA9IHNlcmlhbDtcclxuICB9XHJcblxyXG4gIGdldEFuZHJvaWRQcm9wKGtleTogc3RyaW5nKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcclxuICAgIHJldHVybiB0aGlzLnJ1blNob3J0Q29tbWFuZCgnc2hlbGwnLCAnZ2V0cHJvcCcsIGtleSkubWFwKHMgPT4gcy50cmltKCkpO1xyXG4gIH1cclxuXHJcbiAgZ2V0RGV2aWNlQXJjaGl0ZWN0dXJlKCk6IE9ic2VydmFibGU8c3RyaW5nPiB7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRBbmRyb2lkUHJvcCgncm8ucHJvZHVjdC5jcHUuYWJpJyk7XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRJbnN0YWxsZWRQYWNrYWdlcygpOiBQcm9taXNlPEFycmF5PHN0cmluZz4+IHtcclxuICAgIGNvbnN0IHByZWZpeCA9ICdwYWNrYWdlOic7XHJcbiAgICBjb25zdCBzdGRvdXQgPSBhd2FpdCB0aGlzLnJ1blNob3J0Q29tbWFuZChcclxuICAgICAgJ3NoZWxsJyxcclxuICAgICAgJ3BtJyxcclxuICAgICAgJ2xpc3QnLFxyXG4gICAgICAncGFja2FnZXMnLFxyXG4gICAgKS50b1Byb21pc2UoKTtcclxuICAgIHJldHVybiBzdGRvdXRcclxuICAgICAgLnRyaW0oKVxyXG4gICAgICAuc3BsaXQoL1xccysvKVxyXG4gICAgICAubWFwKHMgPT4gcy5zdWJzdHJpbmcocHJlZml4Lmxlbmd0aCkpO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgaXNQYWNrYWdlSW5zdGFsbGVkKHBrZzogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgICBjb25zdCBwYWNrYWdlcyA9IGF3YWl0IHRoaXMuZ2V0SW5zdGFsbGVkUGFja2FnZXMoKTtcclxuICAgIHJldHVybiBwYWNrYWdlcy5pbmNsdWRlcyhwa2cpO1xyXG4gIH1cclxuXHJcbiAgZ2V0RGV2aWNlTW9kZWwoKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcclxuICAgIHJldHVybiB0aGlzLmdldEFuZHJvaWRQcm9wKCdyby5wcm9kdWN0Lm1vZGVsJykubWFwKFxyXG4gICAgICBzID0+IChzID09PSAnc2RrJyA/ICdlbXVsYXRvcicgOiBzKSxcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBnZXRBUElWZXJzaW9uKCk6IE9ic2VydmFibGU8c3RyaW5nPiB7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRBbmRyb2lkUHJvcCgncm8uYnVpbGQudmVyc2lvbi5zZGsnKTtcclxuICB9XHJcblxyXG4gIGdldEJyYW5kKCk6IE9ic2VydmFibGU8c3RyaW5nPiB7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRBbmRyb2lkUHJvcCgncm8ucHJvZHVjdC5icmFuZCcpO1xyXG4gIH1cclxuXHJcbiAgZ2V0TWFudWZhY3R1cmVyKCk6IE9ic2VydmFibGU8c3RyaW5nPiB7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRBbmRyb2lkUHJvcCgncm8ucHJvZHVjdC5tYW51ZmFjdHVyZXInKTtcclxuICB9XHJcblxyXG4gIGdldERldmljZUluZm8oKTogT2JzZXJ2YWJsZTxNYXA8c3RyaW5nLCBzdHJpbmc+PiB7XHJcbiAgICBjb25zdCB1bmtub3duQ0IgPSAoKSA9PiBPYnNlcnZhYmxlLm9mKCcnKTtcclxuICAgIHJldHVybiBPYnNlcnZhYmxlLmZvcmtKb2luKFxyXG4gICAgICB0aGlzLmdldERldmljZUFyY2hpdGVjdHVyZSgpLmNhdGNoKHVua25vd25DQiksXHJcbiAgICAgIHRoaXMuZ2V0QVBJVmVyc2lvbigpLmNhdGNoKHVua25vd25DQiksXHJcbiAgICAgIHRoaXMuZ2V0RGV2aWNlTW9kZWwoKS5jYXRjaCh1bmtub3duQ0IpLFxyXG4gICAgICB0aGlzLmdldE9TVmVyc2lvbigpLmNhdGNoKHVua25vd25DQiksXHJcbiAgICAgIHRoaXMuZ2V0TWFudWZhY3R1cmVyKCkuY2F0Y2godW5rbm93bkNCKSxcclxuICAgICAgdGhpcy5nZXRCcmFuZCgpLmNhdGNoKHVua25vd25DQiksXHJcbiAgICAgIHRoaXMuZ2V0V2lmaUlwKCkuY2F0Y2godW5rbm93bkNCKSxcclxuICAgICkubWFwKFxyXG4gICAgICAoW1xyXG4gICAgICAgIGFyY2hpdGVjdHVyZSxcclxuICAgICAgICBhcGlWZXJzaW9uLFxyXG4gICAgICAgIG1vZGVsLFxyXG4gICAgICAgIGFuZHJvaWRfdmVyc2lvbixcclxuICAgICAgICBtYW51ZmFjdHVyZXIsXHJcbiAgICAgICAgYnJhbmQsXHJcbiAgICAgICAgd2lmaV9pcCxcclxuICAgICAgXSkgPT4ge1xyXG4gICAgICAgIHJldHVybiBuZXcgTWFwKFtcclxuICAgICAgICAgIFsnbmFtZScsIHRoaXMuX3NlcmlhbF0sXHJcbiAgICAgICAgICBbJ2FkYl9wb3J0JywgJzUwMzcnXSxcclxuICAgICAgICAgIFsnYXJjaGl0ZWN0dXJlJywgYXJjaGl0ZWN0dXJlXSxcclxuICAgICAgICAgIFsnYXBpX3ZlcnNpb24nLCBhcGlWZXJzaW9uXSxcclxuICAgICAgICAgIFsnbW9kZWwnLCBtb2RlbF0sXHJcbiAgICAgICAgICBbJ2FuZHJvaWRfdmVyc2lvbicsIGFuZHJvaWRfdmVyc2lvbl0sXHJcbiAgICAgICAgICBbJ21hbnVmYWN0dXJlcicsIG1hbnVmYWN0dXJlcl0sXHJcbiAgICAgICAgICBbJ2JyYW5kJywgYnJhbmRdLFxyXG4gICAgICAgICAgWyd3aWZpX2lwJywgd2lmaV9pcF0sXHJcbiAgICAgICAgXSk7XHJcbiAgICAgIH0sXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgZ2V0V2lmaUlwKCk6IE9ic2VydmFibGU8c3RyaW5nPiB7XHJcbiAgICByZXR1cm4gdGhpcy5ydW5TaG9ydENvbW1hbmQoJ3NoZWxsJywgJ2lwJywgJ2FkZHInLCAnc2hvdycsICd3bGFuMCcpLm1hcChcclxuICAgICAgbGluZXMgPT4ge1xyXG4gICAgICAgIGNvbnN0IGxpbmUgPSBsaW5lcy5zcGxpdCgvXFxuLykuZmlsdGVyKGwgPT4gbC5pbmNsdWRlcygnaW5ldCcpKVswXTtcclxuICAgICAgICBpZiAobGluZSA9PSBudWxsKSB7XHJcbiAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHJhd0lwID0gbGluZS50cmltKCkuc3BsaXQoL1xccysvKVsxXTtcclxuICAgICAgICByZXR1cm4gcmF3SXAuc3Vic3RyaW5nKDAsIHJhd0lwLmluZGV4T2YoJy8nKSk7XHJcbiAgICAgIH0sXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLy8gSW4gc29tZSBhbmRyb2lkIGRldmljZXMsIHdlIGhhdmUgdG8ga2lsbCB0aGUgcGFja2FnZSwgbm90IHRoZSBwcm9jZXNzLlxyXG4gIC8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTcxNTQ5NjEvYWRiLXNoZWxsLW9wZXJhdGlvbi1ub3QtcGVybWl0dGVkXHJcbiAgYXN5bmMgc3RvcFByb2Nlc3MocGFja2FnZU5hbWU6IHN0cmluZywgcGlkOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGF3YWl0IFByb21pc2UuYWxsKFtcclxuICAgICAgdGhpcy5ydW5TaG9ydENvbW1hbmQoXHJcbiAgICAgICAgJ3NoZWxsJyxcclxuICAgICAgICAnYW0nLFxyXG4gICAgICAgICdmb3JjZS1zdG9wJyxcclxuICAgICAgICBwYWNrYWdlTmFtZSxcclxuICAgICAgKS50b1Byb21pc2UoKSxcclxuICAgICAgdGhpcy5ydW5TaG9ydENvbW1hbmQoJ3NoZWxsJywgJ2tpbGwnLCAnLTknLCBgJHtwaWR9YCkudG9Qcm9taXNlKCksXHJcbiAgICAgIHRoaXMucnVuU2hvcnRDb21tYW5kKFxyXG4gICAgICAgICdzaGVsbCcsXHJcbiAgICAgICAgJ3J1bi1hcycsXHJcbiAgICAgICAgcGFja2FnZU5hbWUsXHJcbiAgICAgICAgJ2tpbGwnLFxyXG4gICAgICAgICctOScsXHJcbiAgICAgICAgYCR7cGlkfWAsXHJcbiAgICAgICkudG9Qcm9taXNlKCksXHJcbiAgICBdKTtcclxuICB9XHJcblxyXG4gIGdldE9TVmVyc2lvbigpOiBPYnNlcnZhYmxlPHN0cmluZz4ge1xyXG4gICAgcmV0dXJuIHRoaXMuZ2V0QW5kcm9pZFByb3AoJ3JvLmJ1aWxkLnZlcnNpb24ucmVsZWFzZScpO1xyXG4gIH1cclxuXHJcbiAgaW5zdGFsbFBhY2thZ2UocGFja2FnZVBhdGg6IE51Y2xpZGVVcmkpOiBPYnNlcnZhYmxlPFByb2Nlc3NNZXNzYWdlPiB7XHJcbiAgICBpbnZhcmlhbnQoIW51Y2xpZGVVcmkuaXNSZW1vdGUocGFja2FnZVBhdGgpKTtcclxuICAgIHJldHVybiAoXHJcbiAgICAgIHRoaXMuZ2V0QVBJVmVyc2lvbigpXHJcbiAgICAgICAgLm1hcCh2ZXJzaW9uID0+IHBhcnNlSW50KHZlcnNpb24sIDEwKSA+PSAxNylcclxuICAgICAgICAuY2F0Y2goKCkgPT4gT2JzZXJ2YWJsZS5vZihmYWxzZSkpXHJcbiAgICAgICAgLnN3aXRjaE1hcChjYW5Vc2VEb3duZ3JhZGVPcHRpb24gPT5cclxuICAgICAgICAgIHRoaXMucnVuTG9uZ0NvbW1hbmROZXcoXHJcbiAgICAgICAgICAgIC4uLltcclxuICAgICAgICAgICAgICAnaW5zdGFsbCcsXHJcbiAgICAgICAgICAgICAgJy1yJyxcclxuICAgICAgICAgICAgICAvLyBUaGUgLWQgb3B0aW9uIGFsbG93cyBkb3duZ3JhZGVzLCB3aGljaCBoYXBwZW4gZnJlcXVlbnRseSBkdXJpbmcgZGV2ZWxvcG1lbnQuXHJcbiAgICAgICAgICAgICAgLi4uKGNhblVzZURvd25ncmFkZU9wdGlvbiA/IFsnLWQnXSA6IFtdKSxcclxuICAgICAgICAgICAgICBwYWNrYWdlUGF0aCxcclxuICAgICAgICAgICAgXSxcclxuICAgICAgICAgICksXHJcbiAgICAgICAgKVxyXG4gICAgICAgIC8vIGFkYiBpbnN0YWxsIHNlbmRzIGEgbG90IG9mIGlkZW50aWNhbCBwcm9ncmVzcyBldmVudHMgdG8gc3Rkb3V0LCBkZWR1cGxpY2F0ZSB0aGVtXHJcbiAgICAgICAgLmRpc3RpbmN0VW50aWxDaGFuZ2VkKChhLCBiKSA9PiB7XHJcbiAgICAgICAgICBpZiAoYS5raW5kID09PSAnc3Rkb3V0JyAmJiBiLmtpbmQgPT09ICdzdGRvdXQnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhLmRhdGEgPT09IGIuZGF0YTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHVuaW5zdGFsbFBhY2thZ2UocGFja2FnZU5hbWU6IHN0cmluZyk6IE9ic2VydmFibGU8TGVnYWN5UHJvY2Vzc01lc3NhZ2U+IHtcclxuICAgIC8vIFRPRE8oVDE3NDYzNjM1KVxyXG4gICAgcmV0dXJuIHRoaXMucnVuTG9uZ0NvbW1hbmQoJ3VuaW5zdGFsbCcsIHBhY2thZ2VOYW1lKTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGdldEZvcndhcmRTcGVjKHBpZDogbnVtYmVyKTogUHJvbWlzZTw/c3RyaW5nPiB7XHJcbiAgICBjb25zdCBzcGVjTGluZXMgPSBhd2FpdCB0aGlzLnJ1blNob3J0Q29tbWFuZChcclxuICAgICAgJ2ZvcndhcmQnLFxyXG4gICAgICAnLS1saXN0JyxcclxuICAgICkudG9Qcm9taXNlKCk7XHJcbiAgICBjb25zdCBzcGVjcyA9IHNwZWNMaW5lcy5zcGxpdCgvXFxuLykubWFwKGxpbmUgPT4ge1xyXG4gICAgICBjb25zdCBjb2xzID0gbGluZS5zcGxpdCgvXFxzKy8pO1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHNwZWM6IGNvbHNbMV0sXHJcbiAgICAgICAgdGFyZ2V0OiBjb2xzWzJdLFxyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcbiAgICBjb25zdCBtYXRjaGluZ1NwZWMgPSBzcGVjcy5maW5kKHNwZWMgPT4gc3BlYy50YXJnZXQgPT09IGBqZHdwOiR7cGlkfWApO1xyXG4gICAgaWYgKG1hdGNoaW5nU3BlYyAhPSBudWxsKSB7XHJcbiAgICAgIHJldHVybiBtYXRjaGluZ1NwZWMuc3BlYztcclxuICAgIH1cclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZm9yd2FyZEpkd3BQb3J0VG9QaWQodGNwUG9ydDogbnVtYmVyLCBwaWQ6IG51bWJlcik6IFByb21pc2U8P3N0cmluZz4ge1xyXG4gICAgYXdhaXQgdGhpcy5ydW5TaG9ydENvbW1hbmQoXHJcbiAgICAgICdmb3J3YXJkJyxcclxuICAgICAgYHRjcDoke3RjcFBvcnR9YCxcclxuICAgICAgYGpkd3A6JHtwaWR9YCxcclxuICAgICkudG9Qcm9taXNlKCk7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRGb3J3YXJkU3BlYyhwaWQpO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgcmVtb3ZlSmR3cEZvcndhcmRTcGVjKHNwZWM6ID9zdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gICAgbGV0IG91dHB1dDtcclxuICAgIGxldCByZXN1bHQgPSAnJztcclxuICAgIGlmIChzcGVjICE9IG51bGwpIHtcclxuICAgICAgb3V0cHV0ID0gdGhpcy5ydW5Mb25nQ29tbWFuZCgnZm9yd2FyZCcsICctLXJlbW92ZScsIHNwZWMpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgb3V0cHV0ID0gdGhpcy5ydW5Mb25nQ29tbWFuZCgnZm9yd2FyZCcsICctLXJlbW92ZS1hbGwnKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzdWJzY3JpcHRpb24gPSBvdXRwdXQuc3Vic2NyaWJlKHByb2Nlc3NNZXNzYWdlID0+IHtcclxuICAgICAgc3dpdGNoIChwcm9jZXNzTWVzc2FnZS5raW5kKSB7XHJcbiAgICAgICAgY2FzZSAnc3Rkb3V0JzpcclxuICAgICAgICBjYXNlICdzdGRlcnInOlxyXG4gICAgICAgICAgcmVzdWx0ICs9IHByb2Nlc3NNZXNzYWdlLmRhdGEgKyAnXFxuJztcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIGF3YWl0IG91dHB1dC50b1Byb21pc2UoKTtcclxuICAgIHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcblxyXG4gIGFzeW5jIGxhdW5jaEFjdGl2aXR5KFxyXG4gICAgcGFja2FnZU5hbWU6IHN0cmluZyxcclxuICAgIGFjdGl2aXR5OiBzdHJpbmcsXHJcbiAgICBkZWJ1ZzogYm9vbGVhbixcclxuICAgIGFjdGlvbjogP3N0cmluZyxcclxuICAgIHBhcmFtZXRlcnM6ID9NYXA8c3RyaW5nLCBzdHJpbmc+LFxyXG4gICk6IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgICBpZiAoZGVidWcpIHtcclxuICAgICAgLy8gRW5hYmxlIFwid2FpdCBmb3IgZGVidWdnZXJcIiBzZW1hbnRpY3MgZm9yIHRoZSBuZXh0IGxhdW5jaCBvZlxyXG4gICAgICAvLyB0aGUgc3BlY2lmaWVkIHBhY2thZ2UuXHJcbiAgICAgIGF3YWl0IHRoaXMuc2V0RGVidWdBcHAocGFja2FnZU5hbWUsIGZhbHNlKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBhcmdzID0gWydzaGVsbCcsICdhbScsICdzdGFydCddO1xyXG4gICAgaWYgKGFjdGlvbiAhPSBudWxsKSB7XHJcbiAgICAgIGFyZ3MucHVzaCgnLWEnLCBhY3Rpb24pO1xyXG4gICAgfVxyXG4gICAgaWYgKHBhcmFtZXRlcnMgIT0gbnVsbCkge1xyXG4gICAgICBmb3IgKGNvbnN0IFtrZXksIHBhcmFtZXRlcl0gb2YgcGFyYW1ldGVycykge1xyXG4gICAgICAgIGFyZ3MucHVzaCgnLWUnLCBrZXksIHBhcmFtZXRlcik7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGFyZ3MucHVzaCgnLVcnLCAnLW4nKTtcclxuICAgIGFyZ3MucHVzaChgJHtwYWNrYWdlTmFtZX0vJHthY3Rpdml0eX1gKTtcclxuICAgIHJldHVybiB0aGlzLnJ1blNob3J0Q29tbWFuZCguLi5hcmdzKS50b1Byb21pc2UoKTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGxhdW5jaE1haW5BY3Rpdml0eShcclxuICAgIHBhY2thZ2VOYW1lOiBzdHJpbmcsXHJcbiAgICBkZWJ1ZzogYm9vbGVhbixcclxuICApOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gICAgaWYgKGRlYnVnKSB7XHJcbiAgICAgIC8vIEVuYWJsZSBcIndhaXQgZm9yIGRlYnVnZ2VyXCIgc2VtYW50aWNzIGZvciB0aGUgbmV4dCBsYXVuY2ggb2ZcclxuICAgICAgLy8gdGhlIHNwZWNpZmllZCBwYWNrYWdlLlxyXG4gICAgICBhd2FpdCB0aGlzLnNldERlYnVnQXBwKHBhY2thZ2VOYW1lLCBmYWxzZSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgYXJncyA9IFtcclxuICAgICAgJ3NoZWxsJyxcclxuICAgICAgJ21vbmtleScsXHJcbiAgICAgICctcCcsXHJcbiAgICAgIGAke3BhY2thZ2VOYW1lfWAsXHJcbiAgICAgICctYycsXHJcbiAgICAgICdhbmRyb2lkLmludGVudC5jYXRlZ29yeS5MQVVOQ0hFUicsXHJcbiAgICAgICcxJyxcclxuICAgIF07XHJcbiAgICByZXR1cm4gdGhpcy5ydW5TaG9ydENvbW1hbmQoLi4uYXJncykudG9Qcm9taXNlKCk7XHJcbiAgfVxyXG5cclxuICBhc3luYyBsYXVuY2hTZXJ2aWNlKFxyXG4gICAgcGFja2FnZU5hbWU6IHN0cmluZyxcclxuICAgIHNlcnZpY2VOYW1lOiBzdHJpbmcsXHJcbiAgICBkZWJ1ZzogYm9vbGVhbixcclxuICApOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gICAgaWYgKGRlYnVnKSB7XHJcbiAgICAgIC8vIEVuYWJsZSBcIndhaXQgZm9yIGRlYnVnZ2VyXCIgc2VtYW50aWNzIGZvciB0aGUgbmV4dCBsYXVuY2ggb2ZcclxuICAgICAgLy8gdGhlIHNwZWNpZmllZCBwYWNrYWdlLlxyXG4gICAgICBhd2FpdCB0aGlzLnNldERlYnVnQXBwKHBhY2thZ2VOYW1lLCBmYWxzZSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgYXJncyA9IFtcclxuICAgICAgJ3NoZWxsJyxcclxuICAgICAgJ2FtJyxcclxuICAgICAgJ3N0YXJ0c2VydmljZScsXHJcbiAgICAgIGAke3BhY2thZ2VOYW1lfS8ke3NlcnZpY2VOYW1lfWAsXHJcbiAgICBdO1xyXG4gICAgcmV0dXJuIHRoaXMucnVuU2hvcnRDb21tYW5kKC4uLmFyZ3MpLnRvUHJvbWlzZSgpO1xyXG4gIH1cclxuXHJcbiAgc2V0RGVidWdBcHAocGFja2FnZU5hbWU6IHN0cmluZywgcGVyc2lzdDogYm9vbGVhbik6IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgICBjb25zdCBhcmdzID0gWydzaGVsbCcsICdhbScsICdzZXQtZGVidWctYXBwJywgJy13J107XHJcblxyXG4gICAgaWYgKHBlcnNpc3QpIHtcclxuICAgICAgYXJncy5wdXNoKCctLXBlcnNpc3RlbnQnKTtcclxuICAgIH1cclxuICAgIGFyZ3MucHVzaChgJHtwYWNrYWdlTmFtZX1gKTtcclxuICAgIHJldHVybiB0aGlzLnJ1blNob3J0Q29tbWFuZCguLi5hcmdzKS50b1Byb21pc2UoKTtcclxuICB9XHJcblxyXG4gIF9kdW1wc3lzUGFja2FnZSgpOiBPYnNlcnZhYmxlPHN0cmluZz4ge1xyXG4gICAgcmV0dXJuIHRoaXMucnVuU2hvcnRDb21tYW5kKCdzaGVsbCcsICdkdW1wc3lzJywgJ3BhY2thZ2UnKTtcclxuICB9XHJcblxyXG4gIGFjdGl2aXR5RXhpc3RzKHBhY2thZ2VOYW1lOiBzdHJpbmcsIGFjdGl2aXR5OiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICAgIGNvbnN0IHBhY2thZ2VBY3Rpdml0eVN0cmluZyA9IGAke3BhY2thZ2VOYW1lfS8ke2FjdGl2aXR5fWA7XHJcbiAgICByZXR1cm4gdGhpcy5fZHVtcHN5c1BhY2thZ2UoKVxyXG4gICAgICAubWFwKHN0ZG91dCA9PiBzdGRvdXQuaW5jbHVkZXMocGFja2FnZUFjdGl2aXR5U3RyaW5nKSlcclxuICAgICAgLnRvUHJvbWlzZSgpO1xyXG4gIH1cclxuXHJcbiAgZ2V0QWxsQXZhaWxhYmxlUGFja2FnZXMoKTogUHJvbWlzZTxBcnJheTxzdHJpbmc+PiB7XHJcbiAgICByZXR1cm4gdGhpcy5fZHVtcHN5c1BhY2thZ2UoKVxyXG4gICAgICAubWFwKHN0ZG91dCA9PiBzdGRvdXQuc3BsaXQoJ1xcbicpLm1hcChsaW5lID0+IGxpbmUudHJpbSgpKSlcclxuICAgICAgLnRvUHJvbWlzZSgpO1xyXG4gIH1cclxuXHJcbiAgdG91Y2hGaWxlKHBhdGg6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgICByZXR1cm4gdGhpcy5ydW5TaG9ydENvbW1hbmQoJ3NoZWxsJywgJ3RvdWNoJywgcGF0aCkudG9Qcm9taXNlKCk7XHJcbiAgfVxyXG5cclxuICByZW1vdmVGaWxlKHBhdGg6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgICByZXR1cm4gdGhpcy5ydW5TaG9ydENvbW1hbmQoJ3NoZWxsJywgJ3JtJywgcGF0aCkudG9Qcm9taXNlKCk7XHJcbiAgfVxyXG5cclxuICBnZXREZWJ1Z2dhYmxlUHJvY2Vzc2VzKCk6IE9ic2VydmFibGU8QXJyYXk8U2ltcGxlUHJvY2Vzcz4+IHtcclxuICAgIHJldHVybiB0aGlzLmdldEphdmFQcm9jZXNzZXMoKTtcclxuICB9XHJcblxyXG4gIGdldEphdmFQcm9jZXNzZXMoKTogT2JzZXJ2YWJsZTxBcnJheTxBbmRyb2lkSmF2YVByb2Nlc3M+PiB7XHJcbiAgICBjb25zdCBqZHdwUHJvY2Vzc2VzID0gbmV3IFNldCgpO1xyXG4gICAgcmV0dXJuIHRoaXMucnVuUHNDb21tYW5kKClcclxuICAgICAgLm1hcChzdGRvdXQgPT4ge1xyXG4gICAgICAgIGNvbnN0IHBzT3V0cHV0ID0gc3Rkb3V0LnRyaW0oKTtcclxuICAgICAgICByZXR1cm4gcGFyc2VQc1RhYmxlT3V0cHV0KHBzT3V0cHV0LCBbJ3VzZXInLCAncGlkJywgJ25hbWUnXSk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5zd2l0Y2hNYXAoYWxsUHJvY2Vzc2VzID0+IHtcclxuICAgICAgICBjb25zdCBtYXAgPSBuZXcgTWFwKCk7XHJcbiAgICAgICAgYWxsUHJvY2Vzc2VzXHJcbiAgICAgICAgICAuZmlsdGVyKHJvdyA9PiByb3cgIT0gbnVsbClcclxuICAgICAgICAgIC5mb3JFYWNoKHByb2MgPT4gbWFwLnNldChwcm9jLnBpZCwgcHJvYykpO1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobWFwKTtcclxuICAgICAgfSlcclxuICAgICAgLnN3aXRjaE1hcChhbGxQcm9jZXNzZXNNYXAgPT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJ1bkxvbmdDb21tYW5kKCdqZHdwJykubWFwKG91dHB1dCA9PiB7XHJcbiAgICAgICAgICBpZiAob3V0cHV0LmtpbmQgPT09ICdzdGRvdXQnKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGJsb2NrOiBzdHJpbmcgPSBvdXRwdXQuZGF0YTtcclxuICAgICAgICAgICAgYmxvY2suc3BsaXQoL1xccysvKS5mb3JFYWNoKHBpZCA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc3QgcHJvYyA9IGFsbFByb2Nlc3Nlc01hcC5nZXQocGlkKTtcclxuICAgICAgICAgICAgICBpZiAocHJvYyAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBqZHdwUHJvY2Vzc2VzLmFkZChwcm9jKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KVxyXG4gICAgICAudGltZW91dCgxMDAwKVxyXG4gICAgICAuY2F0Y2goZXJyb3IgPT4gT2JzZXJ2YWJsZS5vZihbXSkpXHJcbiAgICAgIC5zd2l0Y2hNYXAoKCkgPT4ge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoQXJyYXkuZnJvbShqZHdwUHJvY2Vzc2VzKSk7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZHVtcHN5c1BhY2thZ2UocGtnOiBzdHJpbmcpOiBQcm9taXNlPD9zdHJpbmc+IHtcclxuICAgIGlmICghKGF3YWl0IHRoaXMuaXNQYWNrYWdlSW5zdGFsbGVkKHBrZykpKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMucnVuU2hvcnRDb21tYW5kKCdzaGVsbCcsICdkdW1wc3lzJywgJ3BhY2thZ2UnLCBwa2cpLnRvUHJvbWlzZSgpO1xyXG4gIH1cclxuXHJcbiAgZ2V0RGV2aWNlQXJncygpOiBBcnJheTxzdHJpbmc+IHtcclxuICAgIHJldHVybiB0aGlzLl9zZXJpYWwgIT09ICcnID8gWyctcycsIHRoaXMuX3NlcmlhbF0gOiBbXTtcclxuICB9XHJcblxyXG4gIGdldFByb2Nlc3NlcygpOiBPYnNlcnZhYmxlPEFycmF5PFNpbXBsZVByb2Nlc3M+PiB7XHJcbiAgICByZXR1cm4gdGhpcy5ydW5Qc0NvbW1hbmQoKS5tYXAoc3Rkb3V0ID0+XHJcbiAgICAgIHN0ZG91dC5zcGxpdCgvXFxuLykubWFwKGxpbmUgPT4ge1xyXG4gICAgICAgIGNvbnN0IGluZm8gPSBsaW5lLnRyaW0oKS5zcGxpdCgvXFxzKy8pO1xyXG4gICAgICAgIHJldHVybiB7dXNlcjogaW5mb1swXSwgcGlkOiBpbmZvWzFdLCBuYW1lOiBpbmZvW2luZm8ubGVuZ3RoIC0gMV19O1xyXG4gICAgICB9KSxcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBydW5Qc0NvbW1hbmQoLi4uYWRkaXRpb25hbENvbW1hbmRzOiBzdHJpbmdbXSk6IE9ic2VydmFibGU8c3RyaW5nPiB7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRBUElWZXJzaW9uKCkuc3dpdGNoTWFwKGFwaVZlcnNpb24gPT4ge1xyXG4gICAgICBsZXQgY29tbWFuZHMgPSBbJ3NoZWxsJywgJ3BzJ107XHJcbiAgICAgIC8vIFN0YXJ0aW5nIHdpdGggQW5kcm9pZCA4LjAgT3JlbyAoQVBJIDI2KSBwcyBvbmx5IHJldHVybnMgYWxsIHByb2Nlc3Nlc1xyXG4gICAgICAvLyB3aXRoIC1BXHJcbiAgICAgIGlmIChwYXJzZUludChhcGlWZXJzaW9uLCAxMCkgPj0gMjYpIHtcclxuICAgICAgICBjb21tYW5kcy5wdXNoKCctQScpO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbW1hbmRzID0gY29tbWFuZHMuY29uY2F0KGFkZGl0aW9uYWxDb21tYW5kcyk7XHJcbiAgICAgIHJldHVybiB0aGlzLnJ1blNob3J0Q29tbWFuZCguLi5jb21tYW5kcyk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHJ1blNob3J0Q29tbWFuZCguLi5jb21tYW5kOiBzdHJpbmdbXSk6IE9ic2VydmFibGU8c3RyaW5nPiB7XHJcbiAgICByZXR1cm4gcnVuQ29tbWFuZCgnYWRiJywgdGhpcy5nZXREZXZpY2VBcmdzKCkuY29uY2F0KGNvbW1hbmQpKTtcclxuICB9XHJcblxyXG4gIHJ1bkxvbmdDb21tYW5kKC4uLmNvbW1hbmQ6IHN0cmluZ1tdKTogT2JzZXJ2YWJsZTxMZWdhY3lQcm9jZXNzTWVzc2FnZT4ge1xyXG4gICAgLy8gVE9ETyhUMTc0NjM2MzUpXHJcbiAgICByZXR1cm4gb2JzZXJ2ZVByb2Nlc3MoJ2FkYicsIHRoaXMuZ2V0RGV2aWNlQXJncygpLmNvbmNhdChjb21tYW5kKSwge1xyXG4gICAgICBraWxsVHJlZVdoZW5Eb25lOiB0cnVlLFxyXG4gICAgICAvKiBUT0RPKFQxNzM1MzU5OSkgKi8gaXNFeGl0RXJyb3I6ICgpID0+IGZhbHNlLFxyXG4gICAgfSkuY2F0Y2goZXJyb3IgPT4gT2JzZXJ2YWJsZS5vZih7a2luZDogJ2Vycm9yJywgZXJyb3J9KSk7IC8vIFRPRE8oVDE3NDYzNjM1KVxyXG4gIH1cclxuXHJcbiAgcnVuTG9uZ0NvbW1hbmROZXcoLi4uY29tbWFuZDogc3RyaW5nW10pOiBPYnNlcnZhYmxlPFByb2Nlc3NNZXNzYWdlPiB7XHJcbiAgICByZXR1cm4gb2JzZXJ2ZVByb2Nlc3MoJ2FkYicsIHRoaXMuZ2V0RGV2aWNlQXJncygpLmNvbmNhdChjb21tYW5kKSwge1xyXG4gICAgICBraWxsVHJlZVdoZW5Eb25lOiB0cnVlLFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgX3BhcnNlRGV2aWNlc0NvbW1hbmRPdXRwdXQoc3Rkb3V0OiBzdHJpbmcpOiBBcnJheTxBZGJEZXZpY2U+IHtcclxuICAgIGNvbnN0IG5hbWVGcmVxdWVuY3k6IE1hcDxzdHJpbmcsIG51bWJlcj4gPSBuZXcgTWFwKCk7XHJcblxyXG4gICAgcmV0dXJuIHN0ZG91dFxyXG4gICAgICAuc3BsaXQoL1xcbisvZylcclxuICAgICAgLnNsaWNlKDEpXHJcbiAgICAgIC5maWx0ZXIocyA9PiBzLmxlbmd0aCA+IDAgJiYgIXMudHJpbSgpLnN0YXJ0c1dpdGgoJyonKSlcclxuICAgICAgLm1hcChzID0+IHMuc3BsaXQoL1xccysvZykpXHJcbiAgICAgIC5maWx0ZXIoYSA9PiBhWzBdICE9PSAnJylcclxuICAgICAgLm1hcChhID0+IHtcclxuICAgICAgICBjb25zdCBzZXJpYWwgPSBhWzBdO1xyXG4gICAgICAgIGNvbnN0IHByb3BzID0gYS5zbGljZSgyKTtcclxuICAgICAgICBsZXQgcHJvZHVjdDtcclxuICAgICAgICBsZXQgbW9kZWw7XHJcbiAgICAgICAgbGV0IGRldmljZTtcclxuICAgICAgICBsZXQgdXNiO1xyXG4gICAgICAgIGxldCB0cmFuc3BvcnRJZDtcclxuICAgICAgICBmb3IgKGNvbnN0IHByb3Agb2YgcHJvcHMpIHtcclxuICAgICAgICAgIGNvbnN0IHBhaXIgPSBwcm9wLnNwbGl0KCc6Jyk7XHJcbiAgICAgICAgICBpZiAocGFpci5sZW5ndGggIT09IDIpIHtcclxuICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBzd2l0Y2ggKHBhaXJbMF0pIHtcclxuICAgICAgICAgICAgY2FzZSAncHJvZHVjdCc6XHJcbiAgICAgICAgICAgICAgcHJvZHVjdCA9IHBhaXJbMV07XHJcbiAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ21vZGVsJzpcclxuICAgICAgICAgICAgICBtb2RlbCA9IHBhaXJbMV07XHJcbiAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2RldmljZSc6XHJcbiAgICAgICAgICAgICAgZGV2aWNlID0gcGFpclsxXTtcclxuICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAndXNiJzpcclxuICAgICAgICAgICAgICB1c2IgPSBwYWlyWzFdO1xyXG4gICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICd0cmFuc3BvcnRfaWQnOlxyXG4gICAgICAgICAgICAgIHRyYW5zcG9ydElkID0gcGFpclsxXTtcclxuICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgZGlzcGxheU5hbWUgPVxyXG4gICAgICAgICAgc2VyaWFsLnN0YXJ0c1dpdGgoJ2VtdWxhdG9yJykgfHxcclxuICAgICAgICAgIHNlcmlhbC5zdGFydHNXaXRoKCdsb2NhbGhvc3Q6JykgfHxcclxuICAgICAgICAgIG1vZGVsID09IG51bGxcclxuICAgICAgICAgICAgPyBzZXJpYWxcclxuICAgICAgICAgICAgOiBtb2RlbDtcclxuXHJcbiAgICAgICAgY29uc3QgY291bnQgPSBuYW1lRnJlcXVlbmN5LmdldChkaXNwbGF5TmFtZSk7XHJcbiAgICAgICAgaWYgKGNvdW50ID09IG51bGwpIHtcclxuICAgICAgICAgIG5hbWVGcmVxdWVuY3kuc2V0KGRpc3BsYXlOYW1lLCAxKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgbmFtZUZyZXF1ZW5jeS5zZXQoZGlzcGxheU5hbWUsIGNvdW50ICsgMSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgc2VyaWFsLFxyXG4gICAgICAgICAgZGlzcGxheU5hbWUsXHJcbiAgICAgICAgICBwcm9kdWN0LFxyXG4gICAgICAgICAgbW9kZWwsXHJcbiAgICAgICAgICBkZXZpY2UsXHJcbiAgICAgICAgICB1c2IsXHJcbiAgICAgICAgICB0cmFuc3BvcnRJZCxcclxuICAgICAgICB9O1xyXG4gICAgICB9KVxyXG4gICAgICAubWFwKGRldmljZSA9PiB7XHJcbiAgICAgICAgY29uc3Qge2Rpc3BsYXlOYW1lLCBzZXJpYWx9ID0gZGV2aWNlO1xyXG4gICAgICAgIGlmIChkaXNwbGF5TmFtZSA9PT0gc2VyaWFsIHx8IG5hbWVGcmVxdWVuY3kuZ2V0KGRpc3BsYXlOYW1lKSA9PT0gMSkge1xyXG4gICAgICAgICAgcmV0dXJuIGRldmljZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgLi4uZGV2aWNlLFxyXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogYCR7ZGlzcGxheU5hbWV9IC0gJHtzZXJpYWx9YCxcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBnZXREZXZpY2VzKCk6IFByb21pc2U8QXJyYXk8QWRiRGV2aWNlPj4ge1xyXG4gICAgcmV0dXJuIHJ1bkNvbW1hbmQoJ2FkYicsIFsnZGV2aWNlcycsICctbCddKVxyXG4gICAgICAubWFwKHN0ZG91dCA9PiB0aGlzLl9wYXJzZURldmljZXNDb21tYW5kT3V0cHV0KHN0ZG91dCkpXHJcbiAgICAgIC50aW1lb3V0KEFEQl9USU1FT1VUKVxyXG4gICAgICAudG9Qcm9taXNlKCk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMga2lsbFNlcnZlcigpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIHJldHVybiBydW5Db21tYW5kKCdhZGInLCBbJ2tpbGwtc2VydmVyJ10pXHJcbiAgICAgIC5tYXBUbyh1bmRlZmluZWQpXHJcbiAgICAgIC50b1Byb21pc2UoKTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBnZXRWZXJzaW9uKCk6IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgICByZXR1cm4gcnVuQ29tbWFuZCgnYWRiJywgWyd2ZXJzaW9uJ10pXHJcbiAgICAgIC5tYXAodmVyc2lvblN0cmluZyA9PiB7XHJcbiAgICAgICAgY29uc3QgdmVyc2lvbiA9IHZlcnNpb25TdHJpbmcubWF0Y2goL3ZlcnNpb24gKFxcZCsuXFxkKy5cXGQrKS8pO1xyXG4gICAgICAgIGlmICh2ZXJzaW9uKSB7XHJcbiAgICAgICAgICByZXR1cm4gdmVyc2lvblsxXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyB2ZXJzaW9uIGZvdW5kIHdpdGggXCIke3ZlcnNpb25TdHJpbmd9XCJgKTtcclxuICAgICAgfSlcclxuICAgICAgLnRvUHJvbWlzZSgpO1xyXG4gIH1cclxufVxyXG4iXX0=