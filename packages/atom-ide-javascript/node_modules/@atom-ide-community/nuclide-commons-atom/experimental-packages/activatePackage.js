"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = activatePackage;

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */
function activatePackage({
  main,
  providedServices,
  consumedServices
}, messageRouter) {
  const connections = Object.create(null);
  Object.keys(providedServices).forEach(key => {
    const {
      rawConnections
    } = providedServices[key];
    connections[key] = rawConnections.map(({
      socket,
      config
    }) => messageRouter.createConnection(socket, config));
  }); // Create clients for each consumed service.

  const clients = Object.create(null);
  Object.keys(consumedServices).forEach(key => {
    const {
      socket,
      client
    } = consumedServices[key]; // $FlowIgnore

    const clientClass = require(client).default;

    clients[key] = new clientClass(messageRouter.createConnection(socket));
  }); // $FlowIgnore

  const packageClass = require(main).default;

  return new packageClass(clients, connections);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL251Y2xpZGUvbnVjbGlkZS1jb21tb25zLWF0b20vZXhwZXJpbWVudGFsLXBhY2thZ2VzL2FjdGl2YXRlUGFja2FnZS5qcyJdLCJuYW1lcyI6WyJhY3RpdmF0ZVBhY2thZ2UiLCJtYWluIiwicHJvdmlkZWRTZXJ2aWNlcyIsImNvbnN1bWVkU2VydmljZXMiLCJtZXNzYWdlUm91dGVyIiwiY29ubmVjdGlvbnMiLCJPYmplY3QiLCJjcmVhdGUiLCJrZXlzIiwiZm9yRWFjaCIsImtleSIsInJhd0Nvbm5lY3Rpb25zIiwibWFwIiwic29ja2V0IiwiY29uZmlnIiwiY3JlYXRlQ29ubmVjdGlvbiIsImNsaWVudHMiLCJjbGllbnQiLCJjbGllbnRDbGFzcyIsInJlcXVpcmUiLCJkZWZhdWx0IiwicGFja2FnZUNsYXNzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7Ozs7Ozs7Ozs7O0FBZWUsU0FBU0EsZUFBVCxDQUNiO0FBQUNDLEVBQUFBLElBQUQ7QUFBT0MsRUFBQUEsZ0JBQVA7QUFBeUJDLEVBQUFBO0FBQXpCLENBRGEsRUFFYkMsYUFGYSxFQUdBO0FBQ2IsUUFBTUMsV0FBVyxHQUFHQyxNQUFNLENBQUNDLE1BQVAsQ0FBYyxJQUFkLENBQXBCO0FBQ0FELEVBQUFBLE1BQU0sQ0FBQ0UsSUFBUCxDQUFZTixnQkFBWixFQUE4Qk8sT0FBOUIsQ0FBc0NDLEdBQUcsSUFBSTtBQUMzQyxVQUFNO0FBQUNDLE1BQUFBO0FBQUQsUUFBbUJULGdCQUFnQixDQUFDUSxHQUFELENBQXpDO0FBQ0FMLElBQUFBLFdBQVcsQ0FBQ0ssR0FBRCxDQUFYLEdBQW1CQyxjQUFjLENBQUNDLEdBQWYsQ0FBbUIsQ0FBQztBQUFDQyxNQUFBQSxNQUFEO0FBQVNDLE1BQUFBO0FBQVQsS0FBRCxLQUNwQ1YsYUFBYSxDQUFDVyxnQkFBZCxDQUErQkYsTUFBL0IsRUFBdUNDLE1BQXZDLENBRGlCLENBQW5CO0FBR0QsR0FMRCxFQUZhLENBU2I7O0FBQ0EsUUFBTUUsT0FBTyxHQUFHVixNQUFNLENBQUNDLE1BQVAsQ0FBYyxJQUFkLENBQWhCO0FBQ0FELEVBQUFBLE1BQU0sQ0FBQ0UsSUFBUCxDQUFZTCxnQkFBWixFQUE4Qk0sT0FBOUIsQ0FBc0NDLEdBQUcsSUFBSTtBQUMzQyxVQUFNO0FBQUNHLE1BQUFBLE1BQUQ7QUFBU0ksTUFBQUE7QUFBVCxRQUFtQmQsZ0JBQWdCLENBQUNPLEdBQUQsQ0FBekMsQ0FEMkMsQ0FFM0M7O0FBQ0EsVUFBTVEsV0FBVyxHQUFHQyxPQUFPLENBQUNGLE1BQUQsQ0FBUCxDQUFnQkcsT0FBcEM7O0FBQ0FKLElBQUFBLE9BQU8sQ0FBQ04sR0FBRCxDQUFQLEdBQWUsSUFBSVEsV0FBSixDQUFnQmQsYUFBYSxDQUFDVyxnQkFBZCxDQUErQkYsTUFBL0IsQ0FBaEIsQ0FBZjtBQUNELEdBTEQsRUFYYSxDQWtCYjs7QUFDQSxRQUFNUSxZQUFZLEdBQUdGLE9BQU8sQ0FBQ2xCLElBQUQsQ0FBUCxDQUFjbUIsT0FBbkM7O0FBQ0EsU0FBTyxJQUFJQyxZQUFKLENBQWlCTCxPQUFqQixFQUEwQlgsV0FBMUIsQ0FBUDtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENvcHlyaWdodCAoYykgMjAxNy1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxyXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4gKlxyXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBCU0Qtc3R5bGUgbGljZW5zZSBmb3VuZCBpbiB0aGVcclxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLiBBbiBhZGRpdGlvbmFsIGdyYW50XHJcbiAqIG9mIHBhdGVudCByaWdodHMgY2FuIGJlIGZvdW5kIGluIHRoZSBQQVRFTlRTIGZpbGUgaW4gdGhlIHNhbWUgZGlyZWN0b3J5LlxyXG4gKlxyXG4gKiBAZmxvd1xyXG4gKiBAZm9ybWF0XHJcbiAqL1xyXG5cclxuaW1wb3J0IHR5cGUge1BhY2thZ2VQYXJhbXN9IGZyb20gJy4vdHlwZXMnO1xyXG5pbXBvcnQgdHlwZSBNZXNzYWdlUm91dGVyIGZyb20gJy4vTWVzc2FnZVJvdXRlcic7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBhY3RpdmF0ZVBhY2thZ2UoXHJcbiAge21haW4sIHByb3ZpZGVkU2VydmljZXMsIGNvbnN1bWVkU2VydmljZXN9OiBQYWNrYWdlUGFyYW1zLFxyXG4gIG1lc3NhZ2VSb3V0ZXI6IE1lc3NhZ2VSb3V0ZXIsXHJcbik6IElEaXNwb3NhYmxlIHtcclxuICBjb25zdCBjb25uZWN0aW9ucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XHJcbiAgT2JqZWN0LmtleXMocHJvdmlkZWRTZXJ2aWNlcykuZm9yRWFjaChrZXkgPT4ge1xyXG4gICAgY29uc3Qge3Jhd0Nvbm5lY3Rpb25zfSA9IHByb3ZpZGVkU2VydmljZXNba2V5XTtcclxuICAgIGNvbm5lY3Rpb25zW2tleV0gPSByYXdDb25uZWN0aW9ucy5tYXAoKHtzb2NrZXQsIGNvbmZpZ30pID0+XHJcbiAgICAgIG1lc3NhZ2VSb3V0ZXIuY3JlYXRlQ29ubmVjdGlvbihzb2NrZXQsIGNvbmZpZyksXHJcbiAgICApO1xyXG4gIH0pO1xyXG5cclxuICAvLyBDcmVhdGUgY2xpZW50cyBmb3IgZWFjaCBjb25zdW1lZCBzZXJ2aWNlLlxyXG4gIGNvbnN0IGNsaWVudHMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xyXG4gIE9iamVjdC5rZXlzKGNvbnN1bWVkU2VydmljZXMpLmZvckVhY2goa2V5ID0+IHtcclxuICAgIGNvbnN0IHtzb2NrZXQsIGNsaWVudH0gPSBjb25zdW1lZFNlcnZpY2VzW2tleV07XHJcbiAgICAvLyAkRmxvd0lnbm9yZVxyXG4gICAgY29uc3QgY2xpZW50Q2xhc3MgPSByZXF1aXJlKGNsaWVudCkuZGVmYXVsdDtcclxuICAgIGNsaWVudHNba2V5XSA9IG5ldyBjbGllbnRDbGFzcyhtZXNzYWdlUm91dGVyLmNyZWF0ZUNvbm5lY3Rpb24oc29ja2V0KSk7XHJcbiAgfSk7XHJcblxyXG4gIC8vICRGbG93SWdub3JlXHJcbiAgY29uc3QgcGFja2FnZUNsYXNzID0gcmVxdWlyZShtYWluKS5kZWZhdWx0O1xyXG4gIHJldHVybiBuZXcgcGFja2FnZUNsYXNzKGNsaWVudHMsIGNvbm5lY3Rpb25zKTtcclxufVxyXG4iXX0=