"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createCustomLineNumberGutter = createCustomLineNumberGutter;
exports.LoadingFileChanges = exports.default = exports.HunkDiff = void 0;

var _AtomTextEditor = require("./AtomTextEditor");

var _goToLocation = require("@atom-ide-community/nuclide-commons-atom/go-to-location");

var _LoadingSpinner = require("./LoadingSpinner");

var _nullthrows = _interopRequireDefault(require("nullthrows"));

var _string = require("@atom-ide-community/nuclide-commons/string");

var _atom = require("atom");

var React = _interopRequireWildcard(require("react"));

var _reactDom = _interopRequireDefault(require("react-dom"));

var _renderReactRoot = require("./renderReactRoot");

var _Section = require("./Section");

var _UniversalDisposable = _interopRequireDefault(require("@atom-ide-community/nuclide-commons/UniversalDisposable"));

var _classnames = _interopRequireDefault(require("classnames"));

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */
const MAX_GUTTER_WIDTH = 5;

function getHighlightClass(type) {
  if (type === 'add') {
    return 'nuclide-ui-hunk-diff-insert';
  }

  if (type === 'del') {
    return 'nuclide-ui-hunk-diff-delete';
  }

  return null;
} // add a gutter to a text editor with line numbers defined by an iterable, as
// opposed to being forced to start at 1 and counting up


function createCustomLineNumberGutter(editor, lineNumbers, gutterWidth, options = {}) {
  const {
    extraName,
    onClick
  } = options; // 'nuclide-ui-file-changes-line-number-gutter-wX' makes a gutter Xem wide.
  // 'nuclide-ui-file-changes-line-number-gutter' makes a gutter 5em wide

  const suffix = gutterWidth > 0 && gutterWidth < MAX_GUTTER_WIDTH ? `-w${gutterWidth}` : '';
  let name = `nuclide-ui-file-changes-line-number-gutter${suffix}`;

  if (extraName != null) {
    name += ` ${extraName}`;
  }

  const gutter = editor.addGutter({
    name
  });
  let index = -1;

  for (const lineNumber of lineNumbers) {
    index++;

    if (lineNumber == null) {
      continue;
    }

    const marker = editor.markBufferPosition([index, 0], {
      invalidate: 'touch'
    });
    const item = createGutterItem(lineNumber, gutterWidth, onClick);
    gutter.decorateMarker(marker, {
      type: 'gutter',
      item
    });
    gutter.onDidDestroy(() => {
      marker.destroy();

      _reactDom.default.unmountComponentAtNode(item);
    });
  }

  return gutter;
}

const NBSP = '\xa0';

function createGutterItem(lineNumber, gutterWidth, onClick) {
  const fillWidth = gutterWidth - String(lineNumber).length; // Paralleling the original line-number implementation,
  // pad the line number with leading spaces.

  const filler = fillWidth > 0 ? new Array(fillWidth).fill(NBSP).join('') : ''; // Attempt to reuse the existing line-number styles.

  return (0, _renderReactRoot.renderReactRoot)( /*#__PURE__*/React.createElement("div", {
    onClick: onClick && (() => onClick(lineNumber)),
    className: (0, _classnames.default)('line-number', {
      clickable: onClick != null
    })
  }, filler, lineNumber));
}

class HunkDiff extends React.Component {
  constructor(props) {
    super(props);
    this.editor = void 0;
    this._disposables = void 0;
    this._disposables = new _UniversalDisposable.default( // enable copying filename
    // core:copy isn't used because it breaks the custom copy behavior below,
    // and this selection doesn't work easily with cmd-c anyway.
    atom.contextMenu.add({
      '.nuclide-ui-file-changes-item': [{
        label: 'Copy',
        command: 'nuclide-ui-file-changes-item:copy'
      }]
    }), atom.commands.add('.nuclide-ui-file-changes-item', 'nuclide-ui-file-changes-item:copy', event => {
      // need to strip out zero-width spaces that were added to the filename
      if (!(event.target instanceof HTMLElement)) {
        return;
      }

      const element = event.target;
      const text = element.innerText;

      if (text == null) {
        return;
      }

      const allSpacesRegex = new RegExp(_string.ZERO_WIDTH_SPACE, 'g');
      atom.clipboard.write(text.replace(allSpacesRegex, ''));
      event.stopPropagation();
    }));
  }

  componentDidMount() {
    const editor = (0, _nullthrows.default)(this.editor);

    this._createLineMarkers(editor);

    this._createLineNumbers(editor);
  }

  UNSAFE_componentWillReceiveProps(nextProps) {
    const {
      hunk,
      grammar
    } = nextProps;
    const changes = hunk.changes;
    const prevHunk = this.props.hunk;
    const editor = (0, _nullthrows.default)(this.editor);
    const newText = changes.map(change => change.content.slice(1)).join('\n');
    const oldText = prevHunk.changes.map(change => change.content.slice(1)).join('\n');
    const oldGrammar = this.props.grammar;

    if (newText === oldText && grammar === oldGrammar) {
      return;
    }

    if (newText !== oldText) {
      editor.setText(newText);
    }

    if (grammar !== oldGrammar) {
      editor.setGrammar(grammar);
    }

    this._disposables.dispose();

    this._disposables = new _UniversalDisposable.default();

    this._createLineMarkers(editor);

    this._createLineNumbers(editor);
  }

  shouldComponentUpdate(nextProps) {
    return false;
  }

  componentWillUnmount() {
    this._disposables.dispose();
  } // Line numbers are contiguous, but have a random starting point, so we can't use the
  // default line-number gutter.


  _createLineNumbers(editor) {
    const {
      changes,
      newStart: initialOffset
    } = this.props.hunk;
    const changeCount = changes.length;
    const maxDisplayLineNumber = initialOffset + changeCount - 1; // The maximum required gutter width for this hunk, in characters:

    const gutterWidth = String(maxDisplayLineNumber).length;
    let deletedLinesInSection = 0;
    let deletedLines = 0; // use a generator to avoid having to precalculate and store an array of
    // line numbers

    function* lineNumberGenerator() {
      for (let line = 0; line < changeCount; line++) {
        if (changes[line].type === 'del') {
          deletedLinesInSection++;
        } else {
          deletedLines += deletedLinesInSection;
          deletedLinesInSection = 0;
        }

        yield line + initialOffset - deletedLines;
      }
    }

    const gutter = createCustomLineNumberGutter(editor, lineNumberGenerator(), gutterWidth, {
      onClick: this.props.onClickLine
    });

    this._disposables.add(() => {
      gutter.destroy();
    });
  }
  /**
   * @param lineNumber A buffer line number to be highlighted.
   * @param type The type of highlight to be applied to the line.
   *             Could be a value of: ['insert', 'delete'].
   */


  _createLineMarkers(editor) {
    let hunkIndex = 0;

    for (const hunkChanges of this.props.hunk.changes) {
      const lineNumber = hunkIndex++;
      const range = new _atom.Range([lineNumber, 0], [lineNumber + 1, 0]);
      const marker = editor.markBufferRange(range, {
        invalidate: 'never'
      });
      const className = getHighlightClass(hunkChanges.type);

      if (className == null) {
        // No need to highlight normal lines.
        continue;
      }

      const decoration = editor.decorateMarker(marker, {
        type: 'highlight',
        class: className
      });

      this._disposables.add(() => {
        decoration.destroy();
      });
    }
  }

  render() {
    const {
      hunk,
      grammar,
      softWrapped
    } = this.props;
    const {
      changes
    } = hunk; // Remove the first character in each line (/[+- ]/) which indicates addition / deletion

    const text = changes.map(change => change.content.slice(1)).join('\n');
    const textBuffer = new _atom.TextBuffer();
    textBuffer.setText(text);
    return /*#__PURE__*/React.createElement(_AtomTextEditor.AtomTextEditor, {
      autoGrow: true,
      className: "nuclide-ui-hunk-diff-text-editor",
      correctContainerWidth: false,
      grammar: grammar,
      gutterHidden: true,
      readOnly: true,
      softWrapped: softWrapped,
      ref: editorRef => {
        // $FlowFixMe(>=0.53.0) Flow suppress
        this.editor = editorRef && editorRef.getModel();
      },
      textBuffer: textBuffer
    });
  }

}

exports.HunkDiff = HunkDiff;

function handleFilenameClick(fullPath, event) {
  if (fullPath == null) {
    return;
  }

  (0, _goToLocation.goToLocation)(fullPath);
  event.stopPropagation();
}

function renderFileChangeContainer(content, isPreview, collapsable, fullPath, displayPath, collapsedByDefault, hideHeadline, diff) {
  const {
    additions,
    annotation,
    deletions,
    from: fromFileName,
    to: toFileName
  } = diff != null ? diff : {
    additions: null,
    annotation: null,
    deletions: null,
    from: fullPath,
    to: fullPath
  };

  if (toFileName == null || fromFileName == null) {
    // sanity check: toFileName & fromFileName should always be given
    return null;
  }

  const fileName = displayPath != null ? displayPath : toFileName !== '/dev/null' ? toFileName : fromFileName;
  let annotationComponent;

  if (!isPreview && annotation != null) {
    annotationComponent = /*#__PURE__*/React.createElement("span", null, annotation.split('\n').map((line, index) => /*#__PURE__*/React.createElement("span", {
      key: index
    }, line, /*#__PURE__*/React.createElement("br", null))));
  }

  let addedOrDeletedString = '';

  if (toFileName === '/dev/null') {
    addedOrDeletedString = 'file deleted - ';
  } else if (fromFileName === '/dev/null') {
    addedOrDeletedString = 'file added - ';
  }

  const diffDetails = isPreview ? null : /*#__PURE__*/React.createElement("span", {
    className: "nuclide-ui-file-changes-details"
  }, annotationComponent, " (", addedOrDeletedString, additions + deletions, " ", (0, _string.pluralize)('line', additions + deletions), ")"); // insert zero-width spaces so filenames are wrapped at '/'

  const breakableFilename = fileName.replace(/\//g, '/' + _string.ZERO_WIDTH_SPACE);
  const renderedFilename = fullPath != null ? /*#__PURE__*/React.createElement("a", {
    className: "nuclide-ui-file-changes-name",
    onClick: handleFilenameClick.bind(null, fullPath)
  }, breakableFilename) : breakableFilename;

  if (hideHeadline) {
    return content;
  }

  const headline = /*#__PURE__*/React.createElement("span", {
    className: (0, _classnames.default)('nuclide-ui-file-changes-item', 'native-key-bindings'),
    tabIndex: -1
  }, renderedFilename, " ", diffDetails);
  return /*#__PURE__*/React.createElement(_Section.Section, {
    collapsable: collapsable === true,
    collapsedByDefault: collapsedByDefault === true,
    headline: headline,
    title: "Click to open"
  }, content);
}
/* Renders changes to a single file. */


class FileChanges extends React.Component {
  render() {
    const {
      collapsable,
      fullPath,
      displayPath,
      collapsedByDefault,
      hideHeadline,
      diff,
      grammar,
      softWrapped
    } = this.props;
    const {
      chunks,
      from: fromFileName,
      to: toFileName
    } = diff;

    if (toFileName == null || fromFileName == null) {
      // sanity check: toFileName & fromFileName should always be given
      return null;
    }

    const fileName = toFileName !== '/dev/null' ? toFileName : fromFileName;
    const hunks = [];
    let i = 0;

    for (const chunk of chunks) {
      if (i > 0) {
        hunks.push( /*#__PURE__*/React.createElement("div", {
          className: "nuclide-ui-hunk-diff-spacer",
          key: `spacer-${i}`
        }));
      }

      hunks.push(
      /*#__PURE__*/
      // $FlowFixMe(>=0.53.0) Flow suppress
      React.createElement(this.props.hunkComponentClass, {
        extraData: this.props.extraData,
        key: chunk.oldStart,
        grammar: grammar != null ? grammar : atom.grammars.selectGrammar(fileName, ''),
        hunk: chunk,
        onClickLine: line => {
          if (fullPath != null) {
            (0, _goToLocation.goToLocation)(fullPath, {
              line
            });
          }
        },
        softWrapped: softWrapped
      }));
      i++;
    }

    return renderFileChangeContainer(hunks,
    /* isPreview */
    false, collapsable, fullPath, displayPath, collapsedByDefault, hideHeadline, diff);
  }

}

exports.default = FileChanges;
FileChanges.defaultProps = {
  hunkComponentClass: HunkDiff
};

class LoadingFileChanges extends React.Component {
  constructor(...args) {
    super(...args);

    this._handleFilenameClick = event => {
      const {
        fullPath
      } = this.props;

      if (fullPath == null) {
        return;
      }

      (0, _goToLocation.goToLocation)(fullPath);
      event.stopPropagation();
    };
  }

  render() {
    const spinner = /*#__PURE__*/React.createElement(_LoadingSpinner.LoadingSpinner, {
      size: _LoadingSpinner.LoadingSpinnerSizes.EXTRA_SMALL,
      className: "nuclide-ui-file-changes-file-spinner"
    });
    const {
      collapsable,
      fullPath,
      displayPath,
      collapsedByDefault,
      hideHeadline
    } = this.props;
    return renderFileChangeContainer(spinner,
    /* isPreview */
    true, collapsable, fullPath, displayPath, collapsedByDefault, hideHeadline,
    /* diff */
    null);
  }

}

exports.LoadingFileChanges = LoadingFileChanges;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL251Y2xpZGUvbnVjbGlkZS1jb21tb25zLXVpL0ZpbGVDaGFuZ2VzLmpzIl0sIm5hbWVzIjpbIk1BWF9HVVRURVJfV0lEVEgiLCJnZXRIaWdobGlnaHRDbGFzcyIsInR5cGUiLCJjcmVhdGVDdXN0b21MaW5lTnVtYmVyR3V0dGVyIiwiZWRpdG9yIiwibGluZU51bWJlcnMiLCJndXR0ZXJXaWR0aCIsIm9wdGlvbnMiLCJleHRyYU5hbWUiLCJvbkNsaWNrIiwic3VmZml4IiwibmFtZSIsImd1dHRlciIsImFkZEd1dHRlciIsImluZGV4IiwibGluZU51bWJlciIsIm1hcmtlciIsIm1hcmtCdWZmZXJQb3NpdGlvbiIsImludmFsaWRhdGUiLCJpdGVtIiwiY3JlYXRlR3V0dGVySXRlbSIsImRlY29yYXRlTWFya2VyIiwib25EaWREZXN0cm95IiwiZGVzdHJveSIsIlJlYWN0RE9NIiwidW5tb3VudENvbXBvbmVudEF0Tm9kZSIsIk5CU1AiLCJmaWxsV2lkdGgiLCJTdHJpbmciLCJsZW5ndGgiLCJmaWxsZXIiLCJBcnJheSIsImZpbGwiLCJqb2luIiwiY2xpY2thYmxlIiwiSHVua0RpZmYiLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJfZGlzcG9zYWJsZXMiLCJVbml2ZXJzYWxEaXNwb3NhYmxlIiwiYXRvbSIsImNvbnRleHRNZW51IiwiYWRkIiwibGFiZWwiLCJjb21tYW5kIiwiY29tbWFuZHMiLCJldmVudCIsInRhcmdldCIsIkhUTUxFbGVtZW50IiwiZWxlbWVudCIsInRleHQiLCJpbm5lclRleHQiLCJhbGxTcGFjZXNSZWdleCIsIlJlZ0V4cCIsIlpFUk9fV0lEVEhfU1BBQ0UiLCJjbGlwYm9hcmQiLCJ3cml0ZSIsInJlcGxhY2UiLCJzdG9wUHJvcGFnYXRpb24iLCJjb21wb25lbnREaWRNb3VudCIsIl9jcmVhdGVMaW5lTWFya2VycyIsIl9jcmVhdGVMaW5lTnVtYmVycyIsIlVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzIiwibmV4dFByb3BzIiwiaHVuayIsImdyYW1tYXIiLCJjaGFuZ2VzIiwicHJldkh1bmsiLCJuZXdUZXh0IiwibWFwIiwiY2hhbmdlIiwiY29udGVudCIsInNsaWNlIiwib2xkVGV4dCIsIm9sZEdyYW1tYXIiLCJzZXRUZXh0Iiwic2V0R3JhbW1hciIsImRpc3Bvc2UiLCJzaG91bGRDb21wb25lbnRVcGRhdGUiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsIm5ld1N0YXJ0IiwiaW5pdGlhbE9mZnNldCIsImNoYW5nZUNvdW50IiwibWF4RGlzcGxheUxpbmVOdW1iZXIiLCJkZWxldGVkTGluZXNJblNlY3Rpb24iLCJkZWxldGVkTGluZXMiLCJsaW5lTnVtYmVyR2VuZXJhdG9yIiwibGluZSIsIm9uQ2xpY2tMaW5lIiwiaHVua0luZGV4IiwiaHVua0NoYW5nZXMiLCJyYW5nZSIsIlJhbmdlIiwibWFya0J1ZmZlclJhbmdlIiwiY2xhc3NOYW1lIiwiZGVjb3JhdGlvbiIsImNsYXNzIiwicmVuZGVyIiwic29mdFdyYXBwZWQiLCJ0ZXh0QnVmZmVyIiwiVGV4dEJ1ZmZlciIsImVkaXRvclJlZiIsImdldE1vZGVsIiwiaGFuZGxlRmlsZW5hbWVDbGljayIsImZ1bGxQYXRoIiwicmVuZGVyRmlsZUNoYW5nZUNvbnRhaW5lciIsImlzUHJldmlldyIsImNvbGxhcHNhYmxlIiwiZGlzcGxheVBhdGgiLCJjb2xsYXBzZWRCeURlZmF1bHQiLCJoaWRlSGVhZGxpbmUiLCJkaWZmIiwiYWRkaXRpb25zIiwiYW5ub3RhdGlvbiIsImRlbGV0aW9ucyIsImZyb20iLCJmcm9tRmlsZU5hbWUiLCJ0byIsInRvRmlsZU5hbWUiLCJmaWxlTmFtZSIsImFubm90YXRpb25Db21wb25lbnQiLCJzcGxpdCIsImFkZGVkT3JEZWxldGVkU3RyaW5nIiwiZGlmZkRldGFpbHMiLCJicmVha2FibGVGaWxlbmFtZSIsInJlbmRlcmVkRmlsZW5hbWUiLCJiaW5kIiwiaGVhZGxpbmUiLCJGaWxlQ2hhbmdlcyIsImNodW5rcyIsImh1bmtzIiwiaSIsImNodW5rIiwicHVzaCIsImV4dHJhRGF0YSIsIm9sZFN0YXJ0IiwiZ3JhbW1hcnMiLCJzZWxlY3RHcmFtbWFyIiwiZGVmYXVsdFByb3BzIiwiaHVua0NvbXBvbmVudENsYXNzIiwiTG9hZGluZ0ZpbGVDaGFuZ2VzIiwiX2hhbmRsZUZpbGVuYW1lQ2xpY2siLCJzcGlubmVyIiwiTG9hZGluZ1NwaW5uZXJTaXplcyIsIkVYVFJBX1NNQUxMIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQWNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7OztBQXpCQTs7Ozs7Ozs7Ozs7QUEwREEsTUFBTUEsZ0JBQWdCLEdBQUcsQ0FBekI7O0FBRUEsU0FBU0MsaUJBQVQsQ0FBMkJDLElBQTNCLEVBQWlFO0FBQy9ELE1BQUlBLElBQUksS0FBSyxLQUFiLEVBQW9CO0FBQ2xCLFdBQU8sNkJBQVA7QUFDRDs7QUFDRCxNQUFJQSxJQUFJLEtBQUssS0FBYixFQUFvQjtBQUNsQixXQUFPLDZCQUFQO0FBQ0Q7O0FBQ0QsU0FBTyxJQUFQO0FBQ0QsQyxDQUVEO0FBQ0E7OztBQUNPLFNBQVNDLDRCQUFULENBQ0xDLE1BREssRUFFTEMsV0FGSyxFQUdMQyxXQUhLLEVBSUxDLE9BR0MsR0FBRyxFQVBDLEVBUVE7QUFDYixRQUFNO0FBQUNDLElBQUFBLFNBQUQ7QUFBWUMsSUFBQUE7QUFBWixNQUF1QkYsT0FBN0IsQ0FEYSxDQUViO0FBQ0E7O0FBQ0EsUUFBTUcsTUFBTSxHQUNWSixXQUFXLEdBQUcsQ0FBZCxJQUFtQkEsV0FBVyxHQUFHTixnQkFBakMsR0FBcUQsS0FBSU0sV0FBWSxFQUFyRSxHQUF5RSxFQUQzRTtBQUVBLE1BQUlLLElBQUksR0FBSSw2Q0FBNENELE1BQU8sRUFBL0Q7O0FBQ0EsTUFBSUYsU0FBUyxJQUFJLElBQWpCLEVBQXVCO0FBQ3JCRyxJQUFBQSxJQUFJLElBQUssSUFBR0gsU0FBVSxFQUF0QjtBQUNEOztBQUNELFFB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LG9CQURvRSxHQUM1Qy9GLEtBQUQsSUFBd0M7QUFDN0QsWUFBTTtBQUFDMEQsUUFBQUE7QUFBRCxVQUFhLEtBQUtuRSxLQUF4Qjs7QUFDQSxVQUFJbUUsUUFBUSxJQUFJLElBQWhCLEVBQXNCO0FBQ3BCO0FBQ0Q7O0FBQ0Qsc0NBQWFBLFFBQWI7QUFDQTFELE1BQUFBLEtBQUssQ0FBQ1ksZUFBTjtBQUNELEtBUm1FO0FBQUE7O0FBVXBFdUMsRUFBQUEsTUFBTSxHQUFlO0FBQ25CLFVBQU02QyxPQUFPLGdCQUNYLG9CQUFDLDhCQUFEO0FBQ0UsTUFBQSxJQUFJLEVBQUVDLG9DQUFvQkMsV0FENUI7QUFFRSxNQUFBLFNBQVMsRUFBQztBQUZaLE1BREY7QUFPQSxVQUFNO0FBQ0pyQyxNQUFBQSxXQURJO0FBRUpILE1BQUFBLFFBRkk7QUFHSkksTUFBQUEsV0FISTtBQUlKQyxNQUFBQSxrQkFKSTtBQUtKQyxNQUFBQTtBQUxJLFFBTUYsS0FBS3pFLEtBTlQ7QUFPQSxXQUFPb0UseUJBQXlCLENBQzlCcUMsT0FEOEI7QUFFOUI7QUFBZ0IsUUFGYyxFQUc5Qm5DLFdBSDhCLEVBSTlCSCxRQUo4QixFQUs5QkksV0FMOEIsRUFNOUJDLGtCQU44QixFQU85QkMsWUFQOEI7QUFROUI7QUFBVyxRQVJtQixDQUFoQztBQVVEOztBQW5DbUUiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ29weXJpZ2h0IChjKSAyMDE3LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXHJcbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbiAqXHJcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIEJTRC1zdHlsZSBsaWNlbnNlIGZvdW5kIGluIHRoZVxyXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuIEFuIGFkZGl0aW9uYWwgZ3JhbnRcclxuICogb2YgcGF0ZW50IHJpZ2h0cyBjYW4gYmUgZm91bmQgaW4gdGhlIFBBVEVOVFMgZmlsZSBpbiB0aGUgc2FtZSBkaXJlY3RvcnkuXHJcbiAqXHJcbiAqIEBmbG93XHJcbiAqIEBmb3JtYXRcclxuICovXHJcblxyXG5pbXBvcnQgdHlwZSB7TnVjbGlkZVVyaX0gZnJvbSAnQGF0b20taWRlLWNvbW11bml0eS9udWNsaWRlLWNvbW1vbnMvbnVjbGlkZVVyaSc7XHJcblxyXG5pbXBvcnQge0F0b21UZXh0RWRpdG9yfSBmcm9tICcuL0F0b21UZXh0RWRpdG9yJztcclxuaW1wb3J0IHtnb1RvTG9jYXRpb259IGZyb20gJ0BhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zLWF0b20vZ28tdG8tbG9jYXRpb24nO1xyXG5pbXBvcnQge0xvYWRpbmdTcGlubmVyLCBMb2FkaW5nU3Bpbm5lclNpemVzfSBmcm9tICcuL0xvYWRpbmdTcGlubmVyJztcclxuaW1wb3J0IG51bGx0aHJvd3MgZnJvbSAnbnVsbHRocm93cyc7XHJcbmltcG9ydCB7cGx1cmFsaXplLCBaRVJPX1dJRFRIX1NQQUNFfSBmcm9tICdAYXRvbS1pZGUtY29tbXVuaXR5L251Y2xpZGUtY29tbW9ucy9zdHJpbmcnO1xyXG5pbXBvcnQge1JhbmdlLCBUZXh0QnVmZmVyfSBmcm9tICdhdG9tJztcclxuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQgUmVhY3RET00gZnJvbSAncmVhY3QtZG9tJztcclxuaW1wb3J0IHtyZW5kZXJSZWFjdFJvb3R9IGZyb20gJy4vcmVuZGVyUmVhY3RSb290JztcclxuaW1wb3J0IHtTZWN0aW9ufSBmcm9tICcuL1NlY3Rpb24nO1xyXG5pbXBvcnQgVW5pdmVyc2FsRGlzcG9zYWJsZSBmcm9tICdAYXRvbS1pZGUtY29tbXVuaXR5L251Y2xpZGUtY29tbW9ucy9Vbml2ZXJzYWxEaXNwb3NhYmxlJztcclxuaW1wb3J0IGNsYXNzbmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XHJcblxyXG50eXBlIFByb3BzID0ge1xyXG4gIGNvbGxhcHNhYmxlPzogYm9vbGVhbixcclxuICBkaWZmOiBkaWZmcGFyc2VyJEZpbGVEaWZmLFxyXG4gIGV4dHJhRGF0YT86IG1peGVkLFxyXG4gIGdyYW1tYXI/OiBhdG9tJEdyYW1tYXIsXHJcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0L25vLXVudXNlZC1wcm9wLXR5cGVzXHJcbiAgaHVua0NvbXBvbmVudENsYXNzPzogUmVhY3QuQ29tcG9uZW50VHlwZTxIdW5rUHJvcHM+LFxyXG4gIGZ1bGxQYXRoPzogTnVjbGlkZVVyaSxcclxuICBkaXNwbGF5UGF0aD86IHN0cmluZyxcclxuICBjb2xsYXBzYWJsZT86IGJvb2xlYW4sXHJcbiAgY29sbGFwc2VkQnlEZWZhdWx0PzogYm9vbGVhbixcclxuICBoaWRlSGVhZGxpbmU/OiBib29sZWFuLFxyXG4gIHNvZnRXcmFwcGVkPzogYm9vbGVhbixcclxufTtcclxuXHJcbnR5cGUgRGVmYXVsdFByb3BzID0ge1xyXG4gIGh1bmtDb21wb25lbnRDbGFzczogUmVhY3QuQ29tcG9uZW50VHlwZTxIdW5rUHJvcHM+LFxyXG59O1xyXG5cclxuZXhwb3J0IHR5cGUgSHVua1Byb3BzID0ge1xyXG4gIC8vIFRPRE86IHJlbW92ZSBkaXNhYmxlXHJcbiAgLyogZXNsaW50LWRpc2FibGUgcmVhY3Qvbm8tdW51c2VkLXByb3AtdHlwZXMgKi9cclxuICBjb2xsYXBzYWJsZT86IGJvb2xlYW4sXHJcbiAgZXh0cmFEYXRhPzogbWl4ZWQsXHJcbiAgLyogZXNsaW50LWVuYWJsZSByZWFjdC9uby11bnVzZWQtcHJvcC10eXBlcyAqL1xyXG4gIGdyYW1tYXI6IGF0b20kR3JhbW1hcixcclxuICBodW5rOiBkaWZmcGFyc2VyJEh1bmssXHJcbiAgb25DbGlja0xpbmU/OiAobGluZU51bTogbnVtYmVyKSA9PiBtaXhlZCxcclxuICBzb2Z0V3JhcHBlZD86IGJvb2xlYW4sXHJcbn07XHJcblxyXG5jb25zdCBNQVhfR1VUVEVSX1dJRFRIID0gNTtcclxuXHJcbmZ1bmN0aW9uIGdldEhpZ2hsaWdodENsYXNzKHR5cGU6IGRpZmZwYXJzZXIkQ2hhbmdlVHlwZSk6ID9zdHJpbmcge1xyXG4gIGlmICh0eXBlID09PSAnYWRkJykge1xyXG4gICAgcmV0dXJuICdudWNsaWRlLXVpLWh1bmstZGlmZi1pbnNlcnQnO1xyXG4gIH1cclxuICBpZiAodHlwZSA9PT0gJ2RlbCcpIHtcclxuICAgIHJldHVybiAnbnVjbGlkZS11aS1odW5rLWRpZmYtZGVsZXRlJztcclxuICB9XHJcbiAgcmV0dXJuIG51bGw7XHJcbn1cclxuXHJcbi8vIGFkZCBhIGd1dHRlciB0byBhIHRleHQgZWRpdG9yIHdpdGggbGluZSBudW1iZXJzIGRlZmluZWQgYnkgYW4gaXRlcmFibGUsIGFzXHJcbi8vIG9wcG9zZWQgdG8gYmVpbmcgZm9yY2VkIHRvIHN0YXJ0IGF0IDEgYW5kIGNvdW50aW5nIHVwXHJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVDdXN0b21MaW5lTnVtYmVyR3V0dGVyKFxyXG4gIGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yLFxyXG4gIGxpbmVOdW1iZXJzOiBJdGVyYWJsZTw/bnVtYmVyPixcclxuICBndXR0ZXJXaWR0aDogbnVtYmVyLFxyXG4gIG9wdGlvbnM6IHtcclxuICAgIGV4dHJhTmFtZT86IHN0cmluZyxcclxuICAgIG9uQ2xpY2s/OiAobGluZU51bWJlcjogbnVtYmVyKSA9PiBtaXhlZCxcclxuICB9ID0ge30sXHJcbik6IGF0b20kR3V0dGVyIHtcclxuICBjb25zdCB7ZXh0cmFOYW1lLCBvbkNsaWNrfSA9IG9wdGlvbnM7XHJcbiAgLy8gJ251Y2xpZGUtdWktZmlsZS1jaGFuZ2VzLWxpbmUtbnVtYmVyLWd1dHRlci13WCcgbWFrZXMgYSBndXR0ZXIgWGVtIHdpZGUuXHJcbiAgLy8gJ251Y2xpZGUtdWktZmlsZS1jaGFuZ2VzLWxpbmUtbnVtYmVyLWd1dHRlcicgbWFrZXMgYSBndXR0ZXIgNWVtIHdpZGVcclxuICBjb25zdCBzdWZmaXggPVxyXG4gICAgZ3V0dGVyV2lkdGggPiAwICYmIGd1dHRlcldpZHRoIDwgTUFYX0dVVFRFUl9XSURUSCA/IGAtdyR7Z3V0dGVyV2lkdGh9YCA6ICcnO1xyXG4gIGxldCBuYW1lID0gYG51Y2xpZGUtdWktZmlsZS1jaGFuZ2VzLWxpbmUtbnVtYmVyLWd1dHRlciR7c3VmZml4fWA7XHJcbiAgaWYgKGV4dHJhTmFtZSAhPSBudWxsKSB7XHJcbiAgICBuYW1lICs9IGAgJHtleHRyYU5hbWV9YDtcclxuICB9XHJcbiAgY29uc3QgZ3V0dGVyID0gZWRpdG9yLmFkZEd1dHRlcih7bmFtZX0pO1xyXG5cclxuICBsZXQgaW5kZXggPSAtMTtcclxuICBmb3IgKGNvbnN0IGxpbmVOdW1iZXIgb2YgbGluZU51bWJlcnMpIHtcclxuICAgIGluZGV4Kys7XHJcbiAgICBpZiAobGluZU51bWJlciA9PSBudWxsKSB7XHJcbiAgICAgIGNvbnRpbnVlO1xyXG4gICAgfVxyXG4gICAgY29uc3QgbWFya2VyID0gZWRpdG9yLm1hcmtCdWZmZXJQb3NpdGlvbihbaW5kZXgsIDBdLCB7XHJcbiAgICAgIGludmFsaWRhdGU6ICd0b3VjaCcsXHJcbiAgICB9KTtcclxuICAgIGNvbnN0IGl0ZW0gPSBjcmVhdGVHdXR0ZXJJdGVtKGxpbmVOdW1iZXIsIGd1dHRlcldpZHRoLCBvbkNsaWNrKTtcclxuICAgIGd1dHRlci5kZWNvcmF0ZU1hcmtlcihtYXJrZXIsIHtcclxuICAgICAgdHlwZTogJ2d1dHRlcicsXHJcbiAgICAgIGl0ZW0sXHJcbiAgICB9KTtcclxuICAgIGd1dHRlci5vbkRpZERlc3Ryb3koKCkgPT4ge1xyXG4gICAgICBtYXJrZXIuZGVzdHJveSgpO1xyXG4gICAgICBSZWFjdERPTS51bm1vdW50Q29tcG9uZW50QXROb2RlKGl0ZW0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gZ3V0dGVyO1xyXG59XHJcblxyXG5jb25zdCBOQlNQID0gJ1xceGEwJztcclxuZnVuY3Rpb24gY3JlYXRlR3V0dGVySXRlbShcclxuICBsaW5lTnVtYmVyOiBudW1iZXIsXHJcbiAgZ3V0dGVyV2lkdGg6IG51bWJlcixcclxuICBvbkNsaWNrOiA/KGxpbmVOdW1iZXI6IG51bWJlcikgPT4gbWl4ZWQsXHJcbik6IEhUTUxFbGVtZW50IHtcclxuICBjb25zdCBmaWxsV2lkdGggPSBndXR0ZXJXaWR0aCAtIFN0cmluZyhsaW5lTnVtYmVyKS5sZW5ndGg7XHJcbiAgLy8gUGFyYWxsZWxpbmcgdGhlIG9yaWdpbmFsIGxpbmUtbnVtYmVyIGltcGxlbWVudGF0aW9uLFxyXG4gIC8vIHBhZCB0aGUgbGluZSBudW1iZXIgd2l0aCBsZWFkaW5nIHNwYWNlcy5cclxuICBjb25zdCBmaWxsZXIgPSBmaWxsV2lkdGggPiAwID8gbmV3IEFycmF5KGZpbGxXaWR0aCkuZmlsbChOQlNQKS5qb2luKCcnKSA6ICcnO1xyXG4gIC8vIEF0dGVtcHQgdG8gcmV1c2UgdGhlIGV4aXN0aW5nIGxpbmUtbnVtYmVyIHN0eWxlcy5cclxuICByZXR1cm4gcmVuZGVyUmVhY3RSb290KFxyXG4gICAgPGRpdlxyXG4gICAgICBvbkNsaWNrPXtvbkNsaWNrICYmICgoKSA9PiBvbkNsaWNrKGxpbmVOdW1iZXIpKX1cclxuICAgICAgY2xhc3NOYW1lPXtjbGFzc25hbWVzKCdsaW5lLW51bWJlcicsIHtjbGlja2FibGU6IG9uQ2xpY2sgIT0gbnVsbH0pfT5cclxuICAgICAge2ZpbGxlcn1cclxuICAgICAge2xpbmVOdW1iZXJ9XHJcbiAgICA8L2Rpdj4sXHJcbiAgKTtcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIEh1bmtEaWZmIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PEh1bmtQcm9wcz4ge1xyXG4gIGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yO1xyXG4gIF9kaXNwb3NhYmxlczogVW5pdmVyc2FsRGlzcG9zYWJsZTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJvcHM6IEh1bmtQcm9wcykge1xyXG4gICAgc3VwZXIocHJvcHMpO1xyXG4gICAgdGhpcy5fZGlzcG9zYWJsZXMgPSBuZXcgVW5pdmVyc2FsRGlzcG9zYWJsZShcclxuICAgICAgLy8gZW5hYmxlIGNvcHlpbmcgZmlsZW5hbWVcclxuICAgICAgLy8gY29yZTpjb3B5IGlzbid0IHVzZWQgYmVjYXVzZSBpdCBicmVha3MgdGhlIGN1c3RvbSBjb3B5IGJlaGF2aW9yIGJlbG93LFxyXG4gICAgICAvLyBhbmQgdGhpcyBzZWxlY3Rpb24gZG9lc24ndCB3b3JrIGVhc2lseSB3aXRoIGNtZC1jIGFueXdheS5cclxuICAgICAgYXRvbS5jb250ZXh0TWVudS5hZGQoe1xyXG4gICAgICAgICcubnVjbGlkZS11aS1maWxlLWNoYW5nZXMtaXRlbSc6IFtcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgbGFiZWw6ICdDb3B5JyxcclxuICAgICAgICAgICAgY29tbWFuZDogJ251Y2xpZGUtdWktZmlsZS1jaGFuZ2VzLWl0ZW06Y29weScsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIF0sXHJcbiAgICAgIH0pLFxyXG4gICAgICBhdG9tLmNvbW1hbmRzLmFkZChcclxuICAgICAgICAnLm51Y2xpZGUtdWktZmlsZS1jaGFuZ2VzLWl0ZW0nLFxyXG4gICAgICAgICdudWNsaWRlLXVpLWZpbGUtY2hhbmdlcy1pdGVtOmNvcHknLFxyXG4gICAgICAgIGV2ZW50ID0+IHtcclxuICAgICAgICAgIC8vIG5lZWQgdG8gc3RyaXAgb3V0IHplcm8td2lkdGggc3BhY2VzIHRoYXQgd2VyZSBhZGRlZCB0byB0aGUgZmlsZW5hbWVcclxuICAgICAgICAgIGlmICghKGV2ZW50LnRhcmdldCBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBjb25zdCBlbGVtZW50OiBIVE1MRWxlbWVudCA9IGV2ZW50LnRhcmdldDtcclxuICAgICAgICAgIGNvbnN0IHRleHQgPSBlbGVtZW50LmlubmVyVGV4dDtcclxuICAgICAgICAgIGlmICh0ZXh0ID09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgY29uc3QgYWxsU3BhY2VzUmVnZXggPSBuZXcgUmVnRXhwKFpFUk9fV0lEVEhfU1BBQ0UsICdnJyk7XHJcbiAgICAgICAgICBhdG9tLmNsaXBib2FyZC53cml0ZSh0ZXh0LnJlcGxhY2UoYWxsU3BhY2VzUmVnZXgsICcnKSk7XHJcbiAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB9LFxyXG4gICAgICApLFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGNvbXBvbmVudERpZE1vdW50KCk6IHZvaWQge1xyXG4gICAgY29uc3QgZWRpdG9yID0gbnVsbHRocm93cyh0aGlzLmVkaXRvcik7XHJcbiAgICB0aGlzLl9jcmVhdGVMaW5lTWFya2VycyhlZGl0b3IpO1xyXG4gICAgdGhpcy5fY3JlYXRlTGluZU51bWJlcnMoZWRpdG9yKTtcclxuICB9XHJcblxyXG4gIFVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wczogSHVua1Byb3BzKTogdm9pZCB7XHJcbiAgICBjb25zdCB7aHVuaywgZ3JhbW1hcn0gPSBuZXh0UHJvcHM7XHJcbiAgICBjb25zdCBjaGFuZ2VzID0gaHVuay5jaGFuZ2VzO1xyXG4gICAgY29uc3QgcHJldkh1bmsgPSB0aGlzLnByb3BzLmh1bms7XHJcbiAgICBjb25zdCBlZGl0b3IgPSBudWxsdGhyb3dzKHRoaXMuZWRpdG9yKTtcclxuXHJcbiAgICBjb25zdCBuZXdUZXh0ID0gY2hhbmdlcy5tYXAoY2hhbmdlID0+IGNoYW5nZS5jb250ZW50LnNsaWNlKDEpKS5qb2luKCdcXG4nKTtcclxuICAgIGNvbnN0IG9sZFRleHQgPSBwcmV2SHVuay5jaGFuZ2VzXHJcbiAgICAgIC5tYXAoY2hhbmdlID0+IGNoYW5nZS5jb250ZW50LnNsaWNlKDEpKVxyXG4gICAgICAuam9pbignXFxuJyk7XHJcbiAgICBjb25zdCBvbGRHcmFtbWFyID0gdGhpcy5wcm9wcy5ncmFtbWFyO1xyXG5cclxuICAgIGlmIChuZXdUZXh0ID09PSBvbGRUZXh0ICYmIGdyYW1tYXIgPT09IG9sZEdyYW1tYXIpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChuZXdUZXh0ICE9PSBvbGRUZXh0KSB7XHJcbiAgICAgIGVkaXRvci5zZXRUZXh0KG5ld1RleHQpO1xyXG4gICAgfVxyXG4gICAgaWYgKGdyYW1tYXIgIT09IG9sZEdyYW1tYXIpIHtcclxuICAgICAgZWRpdG9yLnNldEdyYW1tYXIoZ3JhbW1hcik7XHJcbiAgICB9XHJcbiAgICB0aGlzLl9kaXNwb3NhYmxlcy5kaXNwb3NlKCk7XHJcbiAgICB0aGlzLl9kaXNwb3NhYmxlcyA9IG5ldyBVbml2ZXJzYWxEaXNwb3NhYmxlKCk7XHJcbiAgICB0aGlzLl9jcmVhdGVMaW5lTWFya2VycyhlZGl0b3IpO1xyXG4gICAgdGhpcy5fY3JlYXRlTGluZU51bWJlcnMoZWRpdG9yKTtcclxuICB9XHJcblxyXG4gIHNob3VsZENvbXBvbmVudFVwZGF0ZShuZXh0UHJvcHM6IEh1bmtQcm9wcyk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgY29tcG9uZW50V2lsbFVubW91bnQoKTogdm9pZCB7XHJcbiAgICB0aGlzLl9kaXNwb3NhYmxlcy5kaXNwb3NlKCk7XHJcbiAgfVxyXG5cclxuICAvLyBMaW5lIG51bWJlcnMgYXJlIGNvbnRpZ3VvdXMsIGJ1dCBoYXZlIGEgcmFuZG9tIHN0YXJ0aW5nIHBvaW50LCBzbyB3ZSBjYW4ndCB1c2UgdGhlXHJcbiAgLy8gZGVmYXVsdCBsaW5lLW51bWJlciBndXR0ZXIuXHJcbiAgX2NyZWF0ZUxpbmVOdW1iZXJzKGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yKTogdm9pZCB7XHJcbiAgICBjb25zdCB7Y2hhbmdlcywgbmV3U3RhcnQ6IGluaXRpYWxPZmZzZXR9ID0gdGhpcy5wcm9wcy5odW5rO1xyXG4gICAgY29uc3QgY2hhbmdlQ291bnQgPSBjaGFuZ2VzLmxlbmd0aDtcclxuICAgIGNvbnN0IG1heERpc3BsYXlMaW5lTnVtYmVyID0gaW5pdGlhbE9mZnNldCArIGNoYW5nZUNvdW50IC0gMTtcclxuICAgIC8vIFRoZSBtYXhpbXVtIHJlcXVpcmVkIGd1dHRlciB3aWR0aCBmb3IgdGhpcyBodW5rLCBpbiBjaGFyYWN0ZXJzOlxyXG4gICAgY29uc3QgZ3V0dGVyV2lkdGggPSBTdHJpbmcobWF4RGlzcGxheUxpbmVOdW1iZXIpLmxlbmd0aDtcclxuXHJcbiAgICBsZXQgZGVsZXRlZExpbmVzSW5TZWN0aW9uID0gMDtcclxuICAgIGxldCBkZWxldGVkTGluZXMgPSAwO1xyXG4gICAgLy8gdXNlIGEgZ2VuZXJhdG9yIHRvIGF2b2lkIGhhdmluZyB0byBwcmVjYWxjdWxhdGUgYW5kIHN0b3JlIGFuIGFycmF5IG9mXHJcbiAgICAvLyBsaW5lIG51bWJlcnNcclxuICAgIGZ1bmN0aW9uKiBsaW5lTnVtYmVyR2VuZXJhdG9yKCk6IEl0ZXJhdG9yPG51bWJlcj4ge1xyXG4gICAgICBmb3IgKGxldCBsaW5lID0gMDsgbGluZSA8IGNoYW5nZUNvdW50OyBsaW5lKyspIHtcclxuICAgICAgICBpZiAoY2hhbmdlc1tsaW5lXS50eXBlID09PSAnZGVsJykge1xyXG4gICAgICAgICAgZGVsZXRlZExpbmVzSW5TZWN0aW9uKys7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGRlbGV0ZWRMaW5lcyArPSBkZWxldGVkTGluZXNJblNlY3Rpb247XHJcbiAgICAgICAgICBkZWxldGVkTGluZXNJblNlY3Rpb24gPSAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICB5aWVsZCBsaW5lICsgaW5pdGlhbE9mZnNldCAtIGRlbGV0ZWRMaW5lcztcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGd1dHRlciA9IGNyZWF0ZUN1c3RvbUxpbmVOdW1iZXJHdXR0ZXIoXHJcbiAgICAgIGVkaXRvcixcclxuICAgICAgbGluZU51bWJlckdlbmVyYXRvcigpLFxyXG4gICAgICBndXR0ZXJXaWR0aCxcclxuICAgICAge1xyXG4gICAgICAgIG9uQ2xpY2s6IHRoaXMucHJvcHMub25DbGlja0xpbmUsXHJcbiAgICAgIH0sXHJcbiAgICApO1xyXG4gICAgdGhpcy5fZGlzcG9zYWJsZXMuYWRkKCgpID0+IHtcclxuICAgICAgZ3V0dGVyLmRlc3Ryb3koKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIGxpbmVOdW1iZXIgQSBidWZmZXIgbGluZSBudW1iZXIgdG8gYmUgaGlnaGxpZ2h0ZWQuXHJcbiAgICogQHBhcmFtIHR5cGUgVGhlIHR5cGUgb2YgaGlnaGxpZ2h0IHRvIGJlIGFwcGxpZWQgdG8gdGhlIGxpbmUuXHJcbiAgICogICAgICAgICAgICAgQ291bGQgYmUgYSB2YWx1ZSBvZjogWydpbnNlcnQnLCAnZGVsZXRlJ10uXHJcbiAgICovXHJcbiAgX2NyZWF0ZUxpbmVNYXJrZXJzKGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yKTogdm9pZCB7XHJcbiAgICBsZXQgaHVua0luZGV4ID0gMDtcclxuICAgIGZvciAoY29uc3QgaHVua0NoYW5nZXMgb2YgdGhpcy5wcm9wcy5odW5rLmNoYW5nZXMpIHtcclxuICAgICAgY29uc3QgbGluZU51bWJlciA9IGh1bmtJbmRleCsrO1xyXG4gICAgICBjb25zdCByYW5nZSA9IG5ldyBSYW5nZShbbGluZU51bWJlciwgMF0sIFtsaW5lTnVtYmVyICsgMSwgMF0pO1xyXG4gICAgICBjb25zdCBtYXJrZXIgPSBlZGl0b3IubWFya0J1ZmZlclJhbmdlKHJhbmdlLCB7aW52YWxpZGF0ZTogJ25ldmVyJ30pO1xyXG4gICAgICBjb25zdCBjbGFzc05hbWUgPSBnZXRIaWdobGlnaHRDbGFzcyhodW5rQ2hhbmdlcy50eXBlKTtcclxuICAgICAgaWYgKGNsYXNzTmFtZSA9PSBudWxsKSB7XHJcbiAgICAgICAgLy8gTm8gbmVlZCB0byBoaWdobGlnaHQgbm9ybWFsIGxpbmVzLlxyXG4gICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IGRlY29yYXRpb24gPSBlZGl0b3IuZGVjb3JhdGVNYXJrZXIobWFya2VyLCB7XHJcbiAgICAgICAgdHlwZTogJ2hpZ2hsaWdodCcsXHJcbiAgICAgICAgY2xhc3M6IGNsYXNzTmFtZSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICB0aGlzLl9kaXNwb3NhYmxlcy5hZGQoKCkgPT4ge1xyXG4gICAgICAgIGRlY29yYXRpb24uZGVzdHJveSgpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJlbmRlcigpOiBSZWFjdC5Ob2RlIHtcclxuICAgIGNvbnN0IHtodW5rLCBncmFtbWFyLCBzb2Z0V3JhcHBlZH0gPSB0aGlzLnByb3BzO1xyXG4gICAgY29uc3Qge2NoYW5nZXN9ID0gaHVuaztcclxuICAgIC8vIFJlbW92ZSB0aGUgZmlyc3QgY2hhcmFjdGVyIGluIGVhY2ggbGluZSAoL1srLSBdLykgd2hpY2ggaW5kaWNhdGVzIGFkZGl0aW9uIC8gZGVsZXRpb25cclxuICAgIGNvbnN0IHRleHQgPSBjaGFuZ2VzLm1hcChjaGFuZ2UgPT4gY2hhbmdlLmNvbnRlbnQuc2xpY2UoMSkpLmpvaW4oJ1xcbicpO1xyXG4gICAgY29uc3QgdGV4dEJ1ZmZlciA9IG5ldyBUZXh0QnVmZmVyKCk7XHJcbiAgICB0ZXh0QnVmZmVyLnNldFRleHQodGV4dCk7XHJcblxyXG4gICAgcmV0dXJuIChcclxuICAgICAgPEF0b21UZXh0RWRpdG9yXHJcbiAgICAgICAgYXV0b0dyb3c9e3RydWV9XHJcbiAgICAgICAgY2xhc3NOYW1lPVwibnVjbGlkZS11aS1odW5rLWRpZmYtdGV4dC1lZGl0b3JcIlxyXG4gICAgICAgIGNvcnJlY3RDb250YWluZXJXaWR0aD17ZmFsc2V9XHJcbiAgICAgICAgZ3JhbW1hcj17Z3JhbW1hcn1cclxuICAgICAgICBndXR0ZXJIaWRkZW49e3RydWV9XHJcbiAgICAgICAgcmVhZE9ubHk9e3RydWV9XHJcbiAgICAgICAgc29mdFdyYXBwZWQ9e3NvZnRXcmFwcGVkfVxyXG4gICAgICAgIHJlZj17ZWRpdG9yUmVmID0+IHtcclxuICAgICAgICAgIC8vICRGbG93Rml4TWUoPj0wLjUzLjApIEZsb3cgc3VwcHJlc3NcclxuICAgICAgICAgIHRoaXMuZWRpdG9yID0gZWRpdG9yUmVmICYmIGVkaXRvclJlZi5nZXRNb2RlbCgpO1xyXG4gICAgICAgIH19XHJcbiAgICAgICAgdGV4dEJ1ZmZlcj17dGV4dEJ1ZmZlcn1cclxuICAgICAgLz5cclxuICAgICk7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVGaWxlbmFtZUNsaWNrKFxyXG4gIGZ1bGxQYXRoOiA/c3RyaW5nLFxyXG4gIGV2ZW50OiBTeW50aGV0aWNNb3VzZUV2ZW50PD4sXHJcbik6IHZvaWQge1xyXG4gIGlmIChmdWxsUGF0aCA9PSBudWxsKSB7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG4gIGdvVG9Mb2NhdGlvbihmdWxsUGF0aCk7XHJcbiAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJlbmRlckZpbGVDaGFuZ2VDb250YWluZXIoXHJcbiAgY29udGVudDogUmVhY3QuTm9kZSxcclxuICBpc1ByZXZpZXc6IGJvb2xlYW4sXHJcbiAgY29sbGFwc2FibGU6ID9ib29sZWFuLFxyXG4gIGZ1bGxQYXRoOiA/TnVjbGlkZVVyaSxcclxuICBkaXNwbGF5UGF0aDogP3N0cmluZyxcclxuICBjb2xsYXBzZWRCeURlZmF1bHQ6ID9ib29sZWFuLFxyXG4gIGhpZGVIZWFkbGluZTogP2Jvb2xlYW4sXHJcbiAgZGlmZjogP2RpZmZwYXJzZXIkRmlsZURpZmYsXHJcbik6IFJlYWN0Lk5vZGUge1xyXG4gIGNvbnN0IHthZGRpdGlvbnMsIGFubm90YXRpb24sIGRlbGV0aW9ucywgZnJvbTogZnJvbUZpbGVOYW1lLCB0bzogdG9GaWxlTmFtZX0gPVxyXG4gICAgZGlmZiAhPSBudWxsXHJcbiAgICAgID8gZGlmZlxyXG4gICAgICA6IHtcclxuICAgICAgICAgIGFkZGl0aW9uczogbnVsbCxcclxuICAgICAgICAgIGFubm90YXRpb246IG51bGwsXHJcbiAgICAgICAgICBkZWxldGlvbnM6IG51bGwsXHJcbiAgICAgICAgICBmcm9tOiBmdWxsUGF0aCxcclxuICAgICAgICAgIHRvOiBmdWxsUGF0aCxcclxuICAgICAgICB9O1xyXG5cclxuICBpZiAodG9GaWxlTmFtZSA9PSBudWxsIHx8IGZyb21GaWxlTmFtZSA9PSBudWxsKSB7XHJcbiAgICAvLyBzYW5pdHkgY2hlY2s6IHRvRmlsZU5hbWUgJiBmcm9tRmlsZU5hbWUgc2hvdWxkIGFsd2F5cyBiZSBnaXZlblxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG4gIGNvbnN0IGZpbGVOYW1lID1cclxuICAgIGRpc3BsYXlQYXRoICE9IG51bGxcclxuICAgICAgPyBkaXNwbGF5UGF0aFxyXG4gICAgICA6IHRvRmlsZU5hbWUgIT09ICcvZGV2L251bGwnXHJcbiAgICAgICAgPyB0b0ZpbGVOYW1lXHJcbiAgICAgICAgOiBmcm9tRmlsZU5hbWU7XHJcbiAgbGV0IGFubm90YXRpb25Db21wb25lbnQ7XHJcbiAgaWYgKCFpc1ByZXZpZXcgJiYgYW5ub3RhdGlvbiAhPSBudWxsKSB7XHJcbiAgICBhbm5vdGF0aW9uQ29tcG9uZW50ID0gKFxyXG4gICAgICA8c3Bhbj5cclxuICAgICAgICB7YW5ub3RhdGlvbi5zcGxpdCgnXFxuJykubWFwKChsaW5lLCBpbmRleCkgPT4gKFxyXG4gICAgICAgICAgPHNwYW4ga2V5PXtpbmRleH0+XHJcbiAgICAgICAgICAgIHtsaW5lfVxyXG4gICAgICAgICAgICA8YnIgLz5cclxuICAgICAgICAgIDwvc3Bhbj5cclxuICAgICAgICApKX1cclxuICAgICAgPC9zcGFuPlxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGxldCBhZGRlZE9yRGVsZXRlZFN0cmluZyA9ICcnO1xyXG4gIGlmICh0b0ZpbGVOYW1lID09PSAnL2Rldi9udWxsJykge1xyXG4gICAgYWRkZWRPckRlbGV0ZWRTdHJpbmcgPSAnZmlsZSBkZWxldGVkIC0gJztcclxuICB9IGVsc2UgaWYgKGZyb21GaWxlTmFtZSA9PT0gJy9kZXYvbnVsbCcpIHtcclxuICAgIGFkZGVkT3JEZWxldGVkU3RyaW5nID0gJ2ZpbGUgYWRkZWQgLSAnO1xyXG4gIH1cclxuICBjb25zdCBkaWZmRGV0YWlscyA9IGlzUHJldmlldyA/IG51bGwgOiAoXHJcbiAgICA8c3BhbiBjbGFzc05hbWU9XCJudWNsaWRlLXVpLWZpbGUtY2hhbmdlcy1kZXRhaWxzXCI+XHJcbiAgICAgIHthbm5vdGF0aW9uQ29tcG9uZW50fSAoXHJcbiAgICAgIHthZGRlZE9yRGVsZXRlZFN0cmluZ31cclxuICAgICAge2FkZGl0aW9ucyArIGRlbGV0aW9uc30ge3BsdXJhbGl6ZSgnbGluZScsIGFkZGl0aW9ucyArIGRlbGV0aW9ucyl9XHJcbiAgICAgIClcclxuICAgIDwvc3Bhbj5cclxuICApO1xyXG5cclxuICAvLyBpbnNlcnQgemVyby13aWR0aCBzcGFjZXMgc28gZmlsZW5hbWVzIGFyZSB3cmFwcGVkIGF0ICcvJ1xyXG4gIGNvbnN0IGJyZWFrYWJsZUZpbGVuYW1lID0gZmlsZU5hbWUucmVwbGFjZSgvXFwvL2csICcvJyArIFpFUk9fV0lEVEhfU1BBQ0UpO1xyXG4gIGNvbnN0IHJlbmRlcmVkRmlsZW5hbWUgPVxyXG4gICAgZnVsbFBhdGggIT0gbnVsbCA/IChcclxuICAgICAgPGFcclxuICAgICAgICBjbGFzc05hbWU9XCJudWNsaWRlLXVpLWZpbGUtY2hhbmdlcy1uYW1lXCJcclxuICAgICAgICBvbkNsaWNrPXtoYW5kbGVGaWxlbmFtZUNsaWNrLmJpbmQobnVsbCwgZnVsbFBhdGgpfT5cclxuICAgICAgICB7YnJlYWthYmxlRmlsZW5hbWV9XHJcbiAgICAgIDwvYT5cclxuICAgICkgOiAoXHJcbiAgICAgIGJyZWFrYWJsZUZpbGVuYW1lXHJcbiAgICApO1xyXG5cclxuICBpZiAoaGlkZUhlYWRsaW5lKSB7XHJcbiAgICByZXR1cm4gY29udGVudDtcclxuICB9XHJcblxyXG4gIGNvbnN0IGhlYWRsaW5lID0gKFxyXG4gICAgPHNwYW5cclxuICAgICAgY2xhc3NOYW1lPXtjbGFzc25hbWVzKFxyXG4gICAgICAgICdudWNsaWRlLXVpLWZpbGUtY2hhbmdlcy1pdGVtJyxcclxuICAgICAgICAnbmF0aXZlLWtleS1iaW5kaW5ncycsXHJcbiAgICAgICl9XHJcbiAgICAgIHRhYkluZGV4PXstMX0+XHJcbiAgICAgIHtyZW5kZXJlZEZpbGVuYW1lfSB7ZGlmZkRldGFpbHN9XHJcbiAgICA8L3NwYW4+XHJcbiAgKTtcclxuICByZXR1cm4gKFxyXG4gICAgPFNlY3Rpb25cclxuICAgICAgY29sbGFwc2FibGU9e2NvbGxhcHNhYmxlID09PSB0cnVlfVxyXG4gICAgICBjb2xsYXBzZWRCeURlZmF1bHQ9e2NvbGxhcHNlZEJ5RGVmYXVsdCA9PT0gdHJ1ZX1cclxuICAgICAgaGVhZGxpbmU9e2hlYWRsaW5lfVxyXG4gICAgICB0aXRsZT1cIkNsaWNrIHRvIG9wZW5cIj5cclxuICAgICAge2NvbnRlbnR9XHJcbiAgICA8L1NlY3Rpb24+XHJcbiAgKTtcclxufVxyXG5cclxuLyogUmVuZGVycyBjaGFuZ2VzIHRvIGEgc2luZ2xlIGZpbGUuICovXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEZpbGVDaGFuZ2VzIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PFByb3BzPiB7XHJcbiAgc3RhdGljIGRlZmF1bHRQcm9wczogRGVmYXVsdFByb3BzID0ge1xyXG4gICAgaHVua0NvbXBvbmVudENsYXNzOiBIdW5rRGlmZixcclxuICB9O1xyXG5cclxuICByZW5kZXIoKTogUmVhY3QuTm9kZSB7XHJcbiAgICBjb25zdCB7XHJcbiAgICAgIGNvbGxhcHNhYmxlLFxyXG4gICAgICBmdWxsUGF0aCxcclxuICAgICAgZGlzcGxheVBhdGgsXHJcbiAgICAgIGNvbGxhcHNlZEJ5RGVmYXVsdCxcclxuICAgICAgaGlkZUhlYWRsaW5lLFxyXG4gICAgICBkaWZmLFxyXG4gICAgICBncmFtbWFyLFxyXG4gICAgICBzb2Z0V3JhcHBlZCxcclxuICAgIH0gPSB0aGlzLnByb3BzO1xyXG4gICAgY29uc3Qge2NodW5rcywgZnJvbTogZnJvbUZpbGVOYW1lLCB0bzogdG9GaWxlTmFtZX0gPSBkaWZmO1xyXG4gICAgaWYgKHRvRmlsZU5hbWUgPT0gbnVsbCB8fCBmcm9tRmlsZU5hbWUgPT0gbnVsbCkge1xyXG4gICAgICAvLyBzYW5pdHkgY2hlY2s6IHRvRmlsZU5hbWUgJiBmcm9tRmlsZU5hbWUgc2hvdWxkIGFsd2F5cyBiZSBnaXZlblxyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIGNvbnN0IGZpbGVOYW1lID0gdG9GaWxlTmFtZSAhPT0gJy9kZXYvbnVsbCcgPyB0b0ZpbGVOYW1lIDogZnJvbUZpbGVOYW1lO1xyXG5cclxuICAgIGNvbnN0IGh1bmtzID0gW107XHJcbiAgICBsZXQgaSA9IDA7XHJcbiAgICBmb3IgKGNvbnN0IGNodW5rIG9mIGNodW5rcykge1xyXG4gICAgICBpZiAoaSA+IDApIHtcclxuICAgICAgICBodW5rcy5wdXNoKFxyXG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJudWNsaWRlLXVpLWh1bmstZGlmZi1zcGFjZXJcIiBrZXk9e2BzcGFjZXItJHtpfWB9IC8+LFxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgICAgaHVua3MucHVzaChcclxuICAgICAgICAvLyAkRmxvd0ZpeE1lKD49MC41My4wKSBGbG93IHN1cHByZXNzXHJcbiAgICAgICAgPHRoaXMucHJvcHMuaHVua0NvbXBvbmVudENsYXNzXHJcbiAgICAgICAgICBleHRyYURhdGE9e3RoaXMucHJvcHMuZXh0cmFEYXRhfVxyXG4gICAgICAgICAga2V5PXtjaHVuay5vbGRTdGFydH1cclxuICAgICAgICAgIGdyYW1tYXI9e1xyXG4gICAgICAgICAgICBncmFtbWFyICE9IG51bGxcclxuICAgICAgICAgICAgICA/IGdyYW1tYXJcclxuICAgICAgICAgICAgICA6IGF0b20uZ3JhbW1hcnMuc2VsZWN0R3JhbW1hcihmaWxlTmFtZSwgJycpXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBodW5rPXtjaHVua31cclxuICAgICAgICAgIG9uQ2xpY2tMaW5lPXsobGluZTogbnVtYmVyKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChmdWxsUGF0aCAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgZ29Ub0xvY2F0aW9uKGZ1bGxQYXRoLCB7bGluZX0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9fVxyXG4gICAgICAgICAgc29mdFdyYXBwZWQ9e3NvZnRXcmFwcGVkfVxyXG4gICAgICAgIC8+LFxyXG4gICAgICApO1xyXG4gICAgICBpKys7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJlbmRlckZpbGVDaGFuZ2VDb250YWluZXIoXHJcbiAgICAgIGh1bmtzLFxyXG4gICAgICAvKiBpc1ByZXZpZXcgKi8gZmFsc2UsXHJcbiAgICAgIGNvbGxhcHNhYmxlLFxyXG4gICAgICBmdWxsUGF0aCxcclxuICAgICAgZGlzcGxheVBhdGgsXHJcbiAgICAgIGNvbGxhcHNlZEJ5RGVmYXVsdCxcclxuICAgICAgaGlkZUhlYWRsaW5lLFxyXG4gICAgICBkaWZmLFxyXG4gICAgKTtcclxuICB9XHJcbn1cclxuXHJcbnR5cGUgTG9hZGluZ1Byb3BzID0ge1xyXG4gIGNvbGxhcHNhYmxlPzogYm9vbGVhbixcclxuICBmdWxsUGF0aD86IE51Y2xpZGVVcmksXHJcbiAgZGlzcGxheVBhdGg/OiBzdHJpbmcsXHJcbiAgY29sbGFwc2VkQnlEZWZhdWx0PzogYm9vbGVhbixcclxuICBoaWRlSGVhZGxpbmU/OiBib29sZWFuLFxyXG59O1xyXG5cclxuZXhwb3J0IGNsYXNzIExvYWRpbmdGaWxlQ2hhbmdlcyBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxMb2FkaW5nUHJvcHM+IHtcclxuICBfaGFuZGxlRmlsZW5hbWVDbGljayA9IChldmVudDogU3ludGhldGljTW91c2VFdmVudDw+KTogdm9pZCA9PiB7XHJcbiAgICBjb25zdCB7ZnVsbFBhdGh9ID0gdGhpcy5wcm9wcztcclxuICAgIGlmIChmdWxsUGF0aCA9PSBudWxsKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGdvVG9Mb2NhdGlvbihmdWxsUGF0aCk7XHJcbiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICB9O1xyXG5cclxuICByZW5kZXIoKTogUmVhY3QuTm9kZSB7XHJcbiAgICBjb25zdCBzcGlubmVyID0gKFxyXG4gICAgICA8TG9hZGluZ1NwaW5uZXJcclxuICAgICAgICBzaXplPXtMb2FkaW5nU3Bpbm5lclNpemVzLkVYVFJBX1NNQUxMfVxyXG4gICAgICAgIGNsYXNzTmFtZT1cIm51Y2xpZGUtdWktZmlsZS1jaGFuZ2VzLWZpbGUtc3Bpbm5lclwiXHJcbiAgICAgIC8+XHJcbiAgICApO1xyXG5cclxuICAgIGNvbnN0IHtcclxuICAgICAgY29sbGFwc2FibGUsXHJcbiAgICAgIGZ1bGxQYXRoLFxyXG4gICAgICBkaXNwbGF5UGF0aCxcclxuICAgICAgY29sbGFwc2VkQnlEZWZhdWx0LFxyXG4gICAgICBoaWRlSGVhZGxpbmUsXHJcbiAgICB9ID0gdGhpcy5wcm9wcztcclxuICAgIHJldHVybiByZW5kZXJGaWxlQ2hhbmdlQ29udGFpbmVyKFxyXG4gICAgICBzcGlubmVyLFxyXG4gICAgICAvKiBpc1ByZXZpZXcgKi8gdHJ1ZSxcclxuICAgICAgY29sbGFwc2FibGUsXHJcbiAgICAgIGZ1bGxQYXRoLFxyXG4gICAgICBkaXNwbGF5UGF0aCxcclxuICAgICAgY29sbGFwc2VkQnlEZWZhdWx0LFxyXG4gICAgICBoaWRlSGVhZGxpbmUsXHJcbiAgICAgIC8qIGRpZmYgKi8gbnVsbCxcclxuICAgICk7XHJcbiAgfVxyXG59XHJcbiJdfQ==