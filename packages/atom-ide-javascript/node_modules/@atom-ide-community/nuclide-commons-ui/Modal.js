"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Modal = void 0;

var _UniversalDisposable = _interopRequireDefault(require("@atom-ide-community/nuclide-commons/UniversalDisposable"));

var React = _interopRequireWildcard(require("react"));

var _reactDom = _interopRequireDefault(require("react-dom"));

var _rxjsCompatUmdMin = require("rxjs-compat/bundles/rxjs-compat.umd.min.js");

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }

/**
 * Shows a modal dialog when rendered, using Atom's APIs (atom.workspace.addModalPanel).
 */
class Modal extends React.Component {
  constructor(...args) {
    super(...args);
    this._container = void 0;
    this._cancelDisposable = void 0;
    this._innerElement = void 0;
    this._panel = void 0;

    this._handleWindowClick = event => {
      // If the user clicks outside of the modal, and not on a tooltip or
      // notification, close it.
      if (this._innerElement && !this._innerElement.contains(event.target) && event.target.closest('atom-notifications, .tooltip') == null) {
        this.props.onDismiss();
      }
    };

    this._handleContainerInnerElement = el => {
      if (this._cancelDisposable != null) {
        this._cancelDisposable.dispose();
      }

      this._innerElement = el;

      if (el == null) {
        return;
      }

      el.focus();
      this._cancelDisposable = new _UniversalDisposable.default(atom.commands.add(window, 'core:cancel', () => {
        this.props.onDismiss();
      }), _rxjsCompatUmdMin.Observable.fromEvent(window, 'mousedown') // Ignore clicks in the current tick. We don't want to capture the click that showed this
      // modal.
      .skipUntil(_rxjsCompatUmdMin.Observable.interval(0).first()).subscribe(this._handleWindowClick));
    };
  }

  UNSAFE_componentWillMount() {
    this._container = document.createElement('div');
    this._panel = atom.workspace.addModalPanel({
      item: this._container,
      className: this.props.modalClassName
    });
  }

  componentWillUnmount() {
    this._panel.destroy();
  }

  componentDidUpdate(prevProps) {
    const {
      modalClassName
    } = this.props;
    const {
      modalClassName: prevModalClassName
    } = prevProps;

    const panelElement = this._panel.getElement();

    if (prevModalClassName != null) {
      panelElement.classList.remove(...prevModalClassName.split(/\s+/).filter(token => token.length > 0));
    }

    if (modalClassName != null) {
      panelElement.classList.add(...modalClassName.split(/\s+/).filter(token => token.length > 0));
    }
  }

  render() {
    const {
      modalClassName,
      children,
      onDismiss,
      ...props
    } = this.props;
    return /*#__PURE__*/_reactDom.default.createPortal( /*#__PURE__*/React.createElement("div", _extends({
      tabIndex: "0"
    }, props, {
      ref: this._handleContainerInnerElement
    }), this.props.children), this._container);
  }

}

exports.Modal = Modal;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL251Y2xpZGUvbnVjbGlkZS1jb21tb25zLXVpL01vZGFsLmpzIl0sIm5hbWVzIjpbIk1vZGFsIiwiUmVhY3QiLCJDb21wb25lbnQiLCJfY29udGFpbmVyIiwiX2NhbmNlbERpc3Bvc2FibGUiLCJfaW5uZXJFbGVtZW50IiwiX3BhbmVsIiwiX2hhbmRsZVdpbmRvd0NsaWNrIiwiZXZlbnQiLCJjb250YWlucyIsInRhcmdldCIsImNsb3Nlc3QiLCJwcm9wcyIsIm9uRGlzbWlzcyIsIl9oYW5kbGVDb250YWluZXJJbm5lckVsZW1lbnQiLCJlbCIsImRpc3Bvc2UiLCJmb2N1cyIsIlVuaXZlcnNhbERpc3Bvc2FibGUiLCJhdG9tIiwiY29tbWFuZHMiLCJhZGQiLCJ3aW5kb3ciLCJPYnNlcnZhYmxlIiwiZnJvbUV2ZW50Iiwic2tpcFVudGlsIiwiaW50ZXJ2YWwiLCJmaXJzdCIsInN1YnNjcmliZSIsIlVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJ3b3Jrc3BhY2UiLCJhZGRNb2RhbFBhbmVsIiwiaXRlbSIsImNsYXNzTmFtZSIsIm1vZGFsQ2xhc3NOYW1lIiwiY29tcG9uZW50V2lsbFVubW91bnQiLCJkZXN0cm95IiwiY29tcG9uZW50RGlkVXBkYXRlIiwicHJldlByb3BzIiwicHJldk1vZGFsQ2xhc3NOYW1lIiwicGFuZWxFbGVtZW50IiwiZ2V0RWxlbWVudCIsImNsYXNzTGlzdCIsInJlbW92ZSIsInNwbGl0IiwiZmlsdGVyIiwidG9rZW4iLCJsZW5ndGgiLCJyZW5kZXIiLCJjaGlsZHJlbiIsIlJlYWN0RE9NIiwiY3JlYXRlUG9ydGFsIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBY0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7Ozs7QUFRQTs7O0FBR08sTUFBTUEsS0FBTixTQUFvQkMsS0FBSyxDQUFDQyxTQUExQixDQUEyQztBQUFBO0FBQUE7QUFBQSxTQUNoREMsVUFEZ0Q7QUFBQSxTQUVoREMsaUJBRmdEO0FBQUEsU0FHaERDLGFBSGdEO0FBQUEsU0FJaERDLE1BSmdEOztBQUFBLFNBa0NoREMsa0JBbENnRCxHQWtDMUJDLEtBQUQsSUFBd0M7QUFDM0Q7QUFDQTtBQUNBLFVBQ0UsS0FBS0gsYUFBTCxJQUNBLENBQUMsS0FBS0EsYUFBTCxDQUFtQkksUUFBbkIsQ0FBOEJELEtBQUssQ0FBQ0UsTUFBcEMsQ0FERCxJQUVDRixLQUFLLENBQUNFLE1BQVAsQ0FBb0JDLE9BQXBCLENBQTRCLDhCQUE1QixLQUErRCxJQUhqRSxFQUlFO0FBQ0EsYUFBS0MsS0FBTCxDQUFXQyxTQUFYO0FBQ0Q7QUFDRixLQTVDK0M7O0FBQUEsU0ErQ2hEQyw0QkEvQ2dELEdBK0NoQkMsRUFBRCxJQUE0QjtBQUN6RCxVQUFJLEtBQUtYLGlCQUFMLElBQTBCLElBQTlCLEVBQW9DO0FBQ2xDLGFBQUtBLGlCQUFMLENBQXVCWSxPQUF2QjtBQUNEOztBQUVELFdBQUtYLGFBQUwsR0FBcUJVLEVBQXJCOztBQUNBLFVBQUlBLEVBQUUsSUFBSSxJQUFWLEVBQWdCO0FBQ2Q7QUFDRDs7QUFFREEsTUFBQUEsRUFBRSxDQUFDRSxLQUFIO0FBQ0EsV0FBS2IsaUJBQUwsR0FBeUIsSUFBSWMsNEJBQUosQ0FDdkJDLElBQUksQ0FBQ0MsUUFBTCxDQUFjQyxHQUFkLENBQWtCQyxNQUFsQixFQUEwQixhQUExQixFQUF5QyxNQUFNO0FBQzdDLGFBQUtWLEtBQUwsQ0FBV0MsU0FBWDtBQUNELE9BRkQsQ0FEdUIsRUFJdkJVLDZCQUFXQyxTQUFYLENBQXFCRixNQUFyQixFQUE2QixXQUE3QixFQUNFO0FBQ0E7QUFGRixPQUdHRyxTQUhILENBR2FGLDZCQUFXRyxRQUFYLENBQW9CLENBQXBCLEVBQXVCQyxLQUF2QixFQUhiLEVBSUdDLFNBSkgsQ0FJYSxLQUFLckIsa0JBSmxCLENBSnVCLENBQXpCO0FBVUQsS0FwRStDO0FBQUE7O0FBTWhEc0IsRUFBQUEseUJBQXlCLEdBQVM7QUFDaEMsU0FBSzFCLFVBQUwsR0FBa0IyQixRQUFRLENBQUNDLGFBQVQsQ0FBdUIsS0FBdkIsQ0FBbEI7QUFDQSxTQUFLekIsTUFBTCxHQUFjYSxJQUFJLENBQUNhLFNBQUwsQ0FBZUMsYUFBZixDQUE2QjtBQUN6Q0MsTUFBQUEsSUFBSSxFQUFFLEtBQUsvQixVQUQ4QjtBQUV6Q2dDLE1BQUFBLFNBQVMsRUFBRSxLQUFLdkIsS0FBTCxDQUFXd0I7QUFGbUIsS0FBN0IsQ0FBZDtBQUlEOztBQUVEQyxFQUFBQSxvQkFBb0IsR0FBUztBQUMzQixTQUFLL0IsTUFBTCxDQUFZZ0MsT0FBWjtBQUNEOztBQUVEQyxFQUFBQSxrQkFBa0IsQ0FBQ0MsU0FBRCxFQUF5QjtBQUN6QyxVQUFNO0FBQUNKLE1BQUFBO0FBQUQsUUFBbUIsS0FBS3hCLEtBQTlCO0FBQ0EsVUFBTTtBQUFDd0IsTUFBQUEsY0FBYyxFQUFFSztBQUFqQixRQUF1Q0QsU0FBN0M7O0FBQ0EsVUFBTUUsWUFBWSxHQUFHLEtBQUtwQyxNQUFMLENBQVlxQyxVQUFaLEVBQXJCOztBQUNBLFFBQUlGLGtCQUFrQixJQUFJLElBQTFCLEVBQWdDO0FBQzlCQyxNQUFBQSxZQUFZLENBQUNFLFNBQWIsQ0FBdUJDLE1BQXZCLENBQ0UsR0FBR0osa0JBQWtCLENBQUNLLEtBQW5CLENBQXlCLEtBQXpCLEVBQWdDQyxNQUFoQyxDQUF1Q0MsS0FBSyxJQUFJQSxLQUFLLENBQUNDLE1BQU4sR0FBZSxDQUEvRCxDQURMO0FBR0Q7O0FBQ0QsUUFBSWIsY0FBYyxJQUFJLElBQXRCLEVBQTRCO0FBQzFCTSxNQUFBQSxZQUFZLENBQUNFLFNBQWIsQ0FBdUJ2QixHQUF2QixDQUNFLEdBQUdlLGNBQWMsQ0FBQ1UsS0FBZixDQUFxQixLQUFyQixFQUE0QkMsTUFBNUIsQ0FBbUNDLEtBQUssSUFBSUEsS0FBSyxDQUFDQyxNQUFOLEdBQWUsQ0FBM0QsQ0FETDtBQUdEO0FBQ0Y7O0FBc0NEQyxFQUFBQSxNQUFNLEdBQUc7QUFDUCxVQUFNO0FBQUNkLE1BQUFBLGNBQUQ7QUFBaUJlLE1BQUFBLFFBQWpCO0FBQTJCdEMsTUFBQUEsU0FBM0I7QUFBc0MsU0FBR0Q7QUFBekMsUUFBa0QsS0FBS0EsS0FBN0Q7QUFDQSx3QkFBT3dDLGtCQUFTQyxZQUFULGVBQ0w7QUFBSyxNQUFBLFFBQVEsRUFBQztBQUFkLE9BQXNCekMsS0FBdEI7QUFBNkIsTUFBQSxHQUFHLEVBQUUsS0FBS0U7QUFBdkMsUUFDRyxLQUFLRixLQUFMLENBQVd1QyxRQURkLENBREssRUFJTCxLQUFLaEQsVUFKQSxDQUFQO0FBTUQ7O0FBOUUrQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTctcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cclxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuICpcclxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgQlNELXN0eWxlIGxpY2Vuc2UgZm91bmQgaW4gdGhlXHJcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4gQW4gYWRkaXRpb25hbCBncmFudFxyXG4gKiBvZiBwYXRlbnQgcmlnaHRzIGNhbiBiZSBmb3VuZCBpbiB0aGUgUEFURU5UUyBmaWxlIGluIHRoZSBzYW1lIGRpcmVjdG9yeS5cclxuICpcclxuICogQGZsb3dcclxuICogQGZvcm1hdFxyXG4gKi9cclxuXHJcbi8vIERFUFJFQ0FURUQsIEFWT0lEIFVTSU5HIFRISVMuIFVzZSAnc2hvd01vZGFsJyBpbiBAYXRvbS1pZGUtY29tbXVuaXR5L251Y2xpZGUtY29tbW9ucy11aSBpbnN0ZWFkXHJcblxyXG5pbXBvcnQgVW5pdmVyc2FsRGlzcG9zYWJsZSBmcm9tICdAYXRvbS1pZGUtY29tbXVuaXR5L251Y2xpZGUtY29tbW9ucy9Vbml2ZXJzYWxEaXNwb3NhYmxlJztcclxuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQgUmVhY3RET00gZnJvbSAncmVhY3QtZG9tJztcclxuaW1wb3J0IHtPYnNlcnZhYmxlfSBmcm9tICdyeGpzLWNvbXBhdC9idW5kbGVzL3J4anMtY29tcGF0LnVtZC5taW4uanMnO1xyXG5cclxudHlwZSBQcm9wcyA9IHtcclxuICBjaGlsZHJlbj86IGFueSxcclxuICBtb2RhbENsYXNzTmFtZT86IHN0cmluZyxcclxuICBvbkRpc21pc3M6ICgpID0+IHZvaWQsXHJcbn07XHJcblxyXG4vKipcclxuICogU2hvd3MgYSBtb2RhbCBkaWFsb2cgd2hlbiByZW5kZXJlZCwgdXNpbmcgQXRvbSdzIEFQSXMgKGF0b20ud29ya3NwYWNlLmFkZE1vZGFsUGFuZWwpLlxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIE1vZGFsIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PFByb3BzPiB7XHJcbiAgX2NvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XHJcbiAgX2NhbmNlbERpc3Bvc2FibGU6ID9JRGlzcG9zYWJsZTtcclxuICBfaW5uZXJFbGVtZW50OiA/SFRNTEVsZW1lbnQ7XHJcbiAgX3BhbmVsOiBhdG9tJFBhbmVsO1xyXG5cclxuICBVTlNBRkVfY29tcG9uZW50V2lsbE1vdW50KCk6IHZvaWQge1xyXG4gICAgdGhpcy5fY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICB0aGlzLl9wYW5lbCA9IGF0b20ud29ya3NwYWNlLmFkZE1vZGFsUGFuZWwoe1xyXG4gICAgICBpdGVtOiB0aGlzLl9jb250YWluZXIsXHJcbiAgICAgIGNsYXNzTmFtZTogdGhpcy5wcm9wcy5tb2RhbENsYXNzTmFtZSxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgY29tcG9uZW50V2lsbFVubW91bnQoKTogdm9pZCB7XHJcbiAgICB0aGlzLl9wYW5lbC5kZXN0cm95KCk7XHJcbiAgfVxyXG5cclxuICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzOiBQcm9wcyk6IHZvaWQge1xyXG4gICAgY29uc3Qge21vZGFsQ2xhc3NOYW1lfSA9IHRoaXMucHJvcHM7XHJcbiAgICBjb25zdCB7bW9kYWxDbGFzc05hbWU6IHByZXZNb2RhbENsYXNzTmFtZX0gPSBwcmV2UHJvcHM7XHJcbiAgICBjb25zdCBwYW5lbEVsZW1lbnQgPSB0aGlzLl9wYW5lbC5nZXRFbGVtZW50KCk7XHJcbiAgICBpZiAocHJldk1vZGFsQ2xhc3NOYW1lICE9IG51bGwpIHtcclxuICAgICAgcGFuZWxFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXHJcbiAgICAgICAgLi4ucHJldk1vZGFsQ2xhc3NOYW1lLnNwbGl0KC9cXHMrLykuZmlsdGVyKHRva2VuID0+IHRva2VuLmxlbmd0aCA+IDApLFxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gICAgaWYgKG1vZGFsQ2xhc3NOYW1lICE9IG51bGwpIHtcclxuICAgICAgcGFuZWxFbGVtZW50LmNsYXNzTGlzdC5hZGQoXHJcbiAgICAgICAgLi4ubW9kYWxDbGFzc05hbWUuc3BsaXQoL1xccysvKS5maWx0ZXIodG9rZW4gPT4gdG9rZW4ubGVuZ3RoID4gMCksXHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfaGFuZGxlV2luZG93Q2xpY2sgPSAoZXZlbnQ6IFN5bnRoZXRpY01vdXNlRXZlbnQ8Pik6IHZvaWQgPT4ge1xyXG4gICAgLy8gSWYgdGhlIHVzZXIgY2xpY2tzIG91dHNpZGUgb2YgdGhlIG1vZGFsLCBhbmQgbm90IG9uIGEgdG9vbHRpcCBvclxyXG4gICAgLy8gbm90aWZpY2F0aW9uLCBjbG9zZSBpdC5cclxuICAgIGlmIChcclxuICAgICAgdGhpcy5faW5uZXJFbGVtZW50ICYmXHJcbiAgICAgICF0aGlzLl9pbm5lckVsZW1lbnQuY29udGFpbnMoKChldmVudC50YXJnZXQ6IGFueSk6IE5vZGUpKSAmJlxyXG4gICAgICAoZXZlbnQudGFyZ2V0OiBhbnkpLmNsb3Nlc3QoJ2F0b20tbm90aWZpY2F0aW9ucywgLnRvb2x0aXAnKSA9PSBudWxsXHJcbiAgICApIHtcclxuICAgICAgdGhpcy5wcm9wcy5vbkRpc21pc3MoKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICAvLyBTaW5jZSB3ZSdyZSByZW5kZXJpbmcgbnVsbCwgd2UgY2FuJ3QgdXNlIGBmaW5kRE9NTm9kZSh0aGlzKWAuXHJcbiAgX2hhbmRsZUNvbnRhaW5lcklubmVyRWxlbWVudCA9IChlbDogP0hUTUxFbGVtZW50KTogdm9pZCA9PiB7XHJcbiAgICBpZiAodGhpcy5fY2FuY2VsRGlzcG9zYWJsZSAhPSBudWxsKSB7XHJcbiAgICAgIHRoaXMuX2NhbmNlbERpc3Bvc2FibGUuZGlzcG9zZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuX2lubmVyRWxlbWVudCA9IGVsO1xyXG4gICAgaWYgKGVsID09IG51bGwpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGVsLmZvY3VzKCk7XHJcbiAgICB0aGlzLl9jYW5jZWxEaXNwb3NhYmxlID0gbmV3IFVuaXZlcnNhbERpc3Bvc2FibGUoXHJcbiAgICAgIGF0b20uY29tbWFuZHMuYWRkKHdpbmRvdywgJ2NvcmU6Y2FuY2VsJywgKCkgPT4ge1xyXG4gICAgICAgIHRoaXMucHJvcHMub25EaXNtaXNzKCk7XHJcbiAgICAgIH0pLFxyXG4gICAgICBPYnNlcnZhYmxlLmZyb21FdmVudCh3aW5kb3csICdtb3VzZWRvd24nKVxyXG4gICAgICAgIC8vIElnbm9yZSBjbGlja3MgaW4gdGhlIGN1cnJlbnQgdGljay4gV2UgZG9uJ3Qgd2FudCB0byBjYXB0dXJlIHRoZSBjbGljayB0aGF0IHNob3dlZCB0aGlzXHJcbiAgICAgICAgLy8gbW9kYWwuXHJcbiAgICAgICAgLnNraXBVbnRpbChPYnNlcnZhYmxlLmludGVydmFsKDApLmZpcnN0KCkpXHJcbiAgICAgICAgLnN1YnNjcmliZSh0aGlzLl9oYW5kbGVXaW5kb3dDbGljayksXHJcbiAgICApO1xyXG4gIH07XHJcblxyXG4gIHJlbmRlcigpIHtcclxuICAgIGNvbnN0IHttb2RhbENsYXNzTmFtZSwgY2hpbGRyZW4sIG9uRGlzbWlzcywgLi4ucHJvcHN9ID0gdGhpcy5wcm9wcztcclxuICAgIHJldHVybiBSZWFjdERPTS5jcmVhdGVQb3J0YWwoXHJcbiAgICAgIDxkaXYgdGFiSW5kZXg9XCIwXCIgey4uLnByb3BzfSByZWY9e3RoaXMuX2hhbmRsZUNvbnRhaW5lcklubmVyRWxlbWVudH0+XHJcbiAgICAgICAge3RoaXMucHJvcHMuY2hpbGRyZW59XHJcbiAgICAgIDwvZGl2PixcclxuICAgICAgdGhpcy5fY29udGFpbmVyLFxyXG4gICAgKTtcclxuICB9XHJcbn1cclxuIl19