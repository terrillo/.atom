"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.MultiSelectList = void 0;

var _UniversalDisposable = _interopRequireDefault(require("@atom-ide-community/nuclide-commons/UniversalDisposable"));

var _classnames = _interopRequireDefault(require("classnames"));

var React = _interopRequireWildcard(require("react"));

var _reactDom = _interopRequireDefault(require("react-dom"));

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */
class MultiSelectList extends React.Component {
  constructor(props) {
    super(props);
    this._commandsDisposables = void 0;
    this.state = {
      selectedValue: null
    };
  }

  componentDidMount() {
    this._updateCommands();
  }

  componentDidUpdate(prevProps) {
    if (prevProps.commandScope !== this.props.commandScope) {
      this._updateCommands();
    }
  }

  _updateCommands() {
    if (this._commandsDisposables != null) {
      this._commandsDisposables.dispose();
    }

    const el = this.props.commandScope || _reactDom.default.findDOMNode(this);

    this._commandsDisposables = new _UniversalDisposable.default(atom.commands.add( // $FlowFixMe
    el, {
      'core:move-up': () => {
        this._moveSelectionIndex(-1);
      },
      'core:move-down': () => {
        this._moveSelectionIndex(1);
      },
      'core:confirm': () => {
        const {
          selectedValue
        } = this.state;

        if (selectedValue != null) {
          this._toggleActive(selectedValue);
        }
      }
    }));
  }

  _moveSelectionIndex(delta) {
    const currentIndex = this.props.options.findIndex(option => option.value === this.state.selectedValue);
    const nextIndex = currentIndex + delta;

    if (nextIndex >= 0 && nextIndex < this.props.options.length) {
      this.setState({
        selectedValue: this.props.options[nextIndex].value
      });
    }
  }

  componentWillUnmount() {
    if (this._commandsDisposables != null) {
      this._commandsDisposables.dispose();
    }
  }

  _toggleActive(value) {
    const activeValues = this.props.value.slice();
    const index = activeValues.indexOf(value);

    if (index === -1) {
      activeValues.push(value);
    } else {
      activeValues.splice(index, 1);
    }

    this.props.onChange(activeValues);
  }

  render() {
    return /*#__PURE__*/React.createElement("div", {
      className: "nuclide-multi-select-list select-list block",
      tabIndex: "0"
    }, /*#__PURE__*/React.createElement("ol", {
      className: "list-group mark-active"
    }, this._renderOptions()));
  }

  _renderOptions() {
    const OptionComponent = this.props.optionComponent || DefaultOptionComponent;
    return this.props.options.map((option, index) => {
      const selected = this.state.selectedValue === option.value;
      const active = this.props.value.indexOf(option.value) !== -1;
      const className = (0, _classnames.default)({
        clearfix: true,
        selected,
        active
      });
      return /*#__PURE__*/React.createElement("li", {
        key: index,
        className: className,
        onMouseOver: () => {
          this.setState({
            selectedValue: option.value
          });
        },
        onClick: () => {
          this._toggleActive(option.value);
        }
      }, /*#__PURE__*/React.createElement(OptionComponent, {
        option: option,
        active: active,
        selected: selected
      }));
    });
  }

}

exports.MultiSelectList = MultiSelectList;
MultiSelectList.defaultProps = {
  onChange: values => {},
  optionComponent: DefaultOptionComponent,
  options: [],
  value: []
};

function DefaultOptionComponent(props) {
  return /*#__PURE__*/React.createElement("span", null, props.option.label);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL251Y2xpZGUvbnVjbGlkZS1jb21tb25zLXVpL011bHRpU2VsZWN0TGlzdC5qcyJdLCJuYW1lcyI6WyJNdWx0aVNlbGVjdExpc3QiLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJfY29tbWFuZHNEaXNwb3NhYmxlcyIsInN0YXRlIiwic2VsZWN0ZWRWYWx1ZSIsImNvbXBvbmVudERpZE1vdW50IiwiX3VwZGF0ZUNvbW1hbmRzIiwiY29tcG9uZW50RGlkVXBkYXRlIiwicHJldlByb3BzIiwiY29tbWFuZFNjb3BlIiwiZGlzcG9zZSIsImVsIiwiUmVhY3RET00iLCJmaW5kRE9NTm9kZSIsIlVuaXZlcnNhbERpc3Bvc2FibGUiLCJhdG9tIiwiY29tbWFuZHMiLCJhZGQiLCJfbW92ZVNlbGVjdGlvbkluZGV4IiwiX3RvZ2dsZUFjdGl2ZSIsImRlbHRhIiwiY3VycmVudEluZGV4Iiwib3B0aW9ucyIsImZpbmRJbmRleCIsIm9wdGlvbiIsInZhbHVlIiwibmV4dEluZGV4IiwibGVuZ3RoIiwic2V0U3RhdGUiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsImFjdGl2ZVZhbHVlcyIsInNsaWNlIiwiaW5kZXgiLCJpbmRleE9mIiwicHVzaCIsInNwbGljZSIsIm9uQ2hhbmdlIiwicmVuZGVyIiwiX3JlbmRlck9wdGlvbnMiLCJPcHRpb25Db21wb25lbnQiLCJvcHRpb25Db21wb25lbnQiLCJEZWZhdWx0T3B0aW9uQ29tcG9uZW50IiwibWFwIiwic2VsZWN0ZWQiLCJhY3RpdmUiLCJjbGFzc05hbWUiLCJjbGVhcmZpeCIsImRlZmF1bHRQcm9wcyIsInZhbHVlcyIsImxhYmVsIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBWUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7O0FBZkE7Ozs7Ozs7Ozs7O0FBOENPLE1BQU1BLGVBQU4sU0FBOEJDLEtBQUssQ0FBQ0MsU0FBcEMsQ0FBNEQ7QUFVakVDLEVBQUFBLFdBQVcsQ0FBQ0MsS0FBRCxFQUFlO0FBQ3hCLFVBQU1BLEtBQU47QUFEd0IsU0FUMUJDLG9CQVMwQjtBQUV4QixTQUFLQyxLQUFMLEdBQWE7QUFDWEMsTUFBQUEsYUFBYSxFQUFFO0FBREosS0FBYjtBQUdEOztBQUVEQyxFQUFBQSxpQkFBaUIsR0FBUztBQUN4QixTQUFLQyxlQUFMO0FBQ0Q7O0FBRURDLEVBQUFBLGtCQUFrQixDQUFDQyxTQUFELEVBQXlCO0FBQ3pDLFFBQUlBLFNBQVMsQ0FBQ0MsWUFBVixLQUEyQixLQUFLUixLQUFMLENBQVdRLFlBQTFDLEVBQXdEO0FBQ3RELFdBQUtILGVBQUw7QUFDRDtBQUNGOztBQUVEQSxFQUFBQSxlQUFlLEdBQVM7QUFDdEIsUUFBSSxLQUFLSixvQkFBTCxJQUE2QixJQUFqQyxFQUF1QztBQUNyQyxXQUFLQSxvQkFBTCxDQUEwQlEsT0FBMUI7QUFDRDs7QUFDRCxVQUFNQyxFQUFFLEdBQUcsS0FBS1YsS0FBTCxDQUFXUSxZQUFYLElBQTJCRyxrQkFBU0MsV0FBVCxDQUFxQixJQUFyQixDQUF0Qzs7QUFDQSxTQUFLWCxvQkFBTCxHQUE0QixJQUFJWSw0QkFBSixDQUMxQkMsSUFBSSxDQUFDQyxRQUFMLENBQWNDLEdBQWQsRUFDRTtBQUNBTixJQUFBQSxFQUZGLEVBR0U7QUFDRSxzQkFBZ0IsTUFBTTtBQUNwQixhQUFLTyxtQkFBTCxDQUF5QixDQUFDLENBQTFCO0FBQ0QsT0FISDtBQUlFLHdCQUFrQixNQUFNO0FBQ3RCLGFBQUtBLG1CQUFMLENBQXlCLENBQXpCO0FBQ0QsT0FOSDtBQU9FLHNCQUFnQixNQUFNO0FBQ3BCLGNBQU07QUFBQ2QsVUFBQUE7QUFBRCxZQUFrQixLQUFLRCxLQUE3Qjs7QUFDQSxZQUFJQyxhQUFhLElBQUksSUFBckIsRUFBMkI7QUFDekIsZUFBS2UsYUFBTCxDQUFtQmYsYUFBbkI7QUFDRDtBQUNGO0FBWkgsS0FIRixDQUQwQixDQUE1QjtBQW9CRDs7QUFFRGMsRUFBQUEsbUJBQW1CLENBQUNFLEtBQUQsRUFBc0I7QUFDdkMsVUFBTUMsWUFBWSxHQUFHLEtBQUtwQixLQUFMLENBQVdxQixPQUFYLENBQW1CQyxTQUFuQixDQUNuQkMsTUFBTSxJQUFJQSxNQUFNLENBQUNDLEtBQVAsS0FBaUIsS0FBS3RCLEtBQUwsQ0FBV0MsYUFEbkIsQ0FBckI7QUFHQSxVQUFNc0IsU0FBUyxHQUFHTCxZQUFZLEdBQUdELEtBQWpDOztBQUNBLFFBQUlNLFNBQVMsSUFBSSxDQUFiLElBQWtCQSxTQUFTLEdBQUcsS0FBS3pCLEtBQUwsQ0FBV3FCLE9BQVgsQ0FBbUJLLE1BQXJELEVBQTZEO0FBQzNELFdBQUtDLFFBQUwsQ0FBYztBQUFDeEIsUUFBQUEsYUFBYSxFQUFFLEtBQUtILEtBQUwsQ0FBV3FCLE9BQVgsQ0FBbUJJLFNBQW5CLEVBQThCRDtBQUE5QyxPQUFkO0FBQ0Q7QUFDRjs7QUFFREksRUFBQUEsb0JBQW9CLEdBQVM7QUFDM0IsUUFBSSxLQUFLM0Isb0JBQUwsSUFBNkIsSUFBakMsRUFBdUM7QUFDckMsV0FBS0Esb0JBQUwsQ0FBMEJRLE9BQTFCO0FBQ0Q7QUFDRjs7QUFFRFMsRUFBQUEsYUFBYSxDQUFDTSxLQUFELEVBQW1CO0FBQzlCLFVBQU1LLFlBQVksR0FBRyxLQUFLN0IsS0FBTCxDQUFXd0IsS0FBWCxDQUFpQk0sS0FBakIsRUFBckI7QUFDQSxVQUFNQyxLQUFLLEdBQUdGLFlBQVksQ0FBQ0csT0FBYixDQUFxQlIsS0FBckIsQ0FBZDs7QUFDQSxRQUFJTyxLQUFLLEtBQUssQ0FBQyxDQUFmLEVBQWtCO0FBQ2hCRixNQUFBQSxZQUFZLENBQUNJLElBQWIsQ0FBa0JULEtBQWxCO0FBQ0QsS0FGRCxNQUVPO0FBQ0xLLE1BQUFBLFlBQVksQ0FBQ0ssTUFBYixDQUFvQkgsS0FBcEIsRUFBMkIsQ0FBM0I7QUFDRDs7QUFDRCxTQUFLL0IsS0FBTCxDQUFXbUMsUUFBWCxDQUFvQk4sWUFBcEI7QUFDRDs7QUFFRE8sRUFBQUEsTUFBTSxHQUFlO0FBQ25CLHdCQUNFO0FBQUssTUFBQSxTQUFTLEVBQUMsNkNBQWY7QUFBNkQsTUFBQSxRQUFRLEVBQUM7QUFBdEUsb0JBQ0U7QUFBSSxNQUFBLFNBQVMsRUFBQztBQUFkLE9BQXdDLEtBQUtDLGNBQUwsRUFBeEMsQ0FERixDQURGO0FBS0Q7O0FBRURBLEVBQUFBLGNBQWMsR0FBOEI7QUFDMUMsVUFBTUMsZUFBZSxHQUNuQixLQUFLdEMsS0FBTCxDQUFXdUMsZUFBWCxJQUE4QkMsc0JBRGhDO0FBRUEsV0FBTyxLQUFLeEMsS0FBTCxDQUFXcUIsT0FBWCxDQUFtQm9CLEdBQW5CLENBQXVCLENBQUNsQixNQUFELEVBQVNRLEtBQVQsS0FBbUI7QUFDL0MsWUFBTVcsUUFBUSxHQUFHLEtBQUt4QyxLQUFMLENBQVdDLGFBQVgsS0FBNkJvQixNQUFNLENBQUNDLEtBQXJEO0FBQ0EsWUFBTW1CLE1BQU0sR0FBRyxLQUFLM0MsS0FBTCxDQUFXd0IsS0FBWCxDQUFpQlEsT0FBakIsQ0FBeUJULE1BQU0sQ0FBQ0MsS0FBaEMsTUFBMkMsQ0FBQyxDQUEzRDtBQUNBLFlBQU1vQixTQUFTLEdBQUcseUJBQVc7QUFDM0JDLFFBQUFBLFFBQVEsRUFBRSxJQURpQjtBQUUzQkgsUUFBQUEsUUFGMkI7QUFHM0JDLFFBQUFBO0FBSDJCLE9BQVgsQ0FBbEI7QUFLQSwwQkFDRTtBQUNFLFFBQUEsR0FBRyxFQUFFWixLQURQO0FBRUUsUUFBQSxTQUFTLEVBQUVhLFNBRmI7QUFHRSxRQUFBLFdBQVcsRUFBRSxNQUFNO0FBQ2pCLGVBQUtqQixRQUFMLENBQWM7QUFBQ3hCLFlBQUFBLGFBQWEsRUFBRW9CLE1BQU0sQ0FBQ0M7QUFBdkIsV0FBZDtBQUNELFNBTEg7QUFNRSxRQUFBLE9BQU8sRUFBRSxNQUFNO0FBQ2IsZUFBS04sYUFBTCxDQUFtQkssTUFBTSxDQUFDQyxLQUExQjtBQUNEO0FBUkgsc0JBU0Usb0JBQUMsZUFBRDtBQUNFLFFBQUEsTUFBTSxFQUFFRCxNQURWO0FBRUUsUUFBQSxNQUFNLEVBQUVvQixNQUZWO0FBR0UsUUFBQSxRQUFRLEVBQUVEO0FBSFosUUFURixDQURGO0FBaUJELEtBekJNLENBQVA7QUEwQkQ7O0FBdEhnRTs7O0FBQXREOUMsZSxDQUdKa0QsWSxHQUE2QjtBQUNsQ1gsRUFBQUEsUUFBUSxFQUFFWSxNQUFNLElBQUksQ0FBRSxDQURZO0FBRWxDUixFQUFBQSxlQUFlLEVBQUVDLHNCQUZpQjtBQUdsQ25CLEVBQUFBLE9BQU8sRUFBRSxFQUh5QjtBQUlsQ0csRUFBQUEsS0FBSyxFQUFFO0FBSjJCLEM7O0FBK0h0QyxTQUFTZ0Isc0JBQVQsQ0FBZ0N4QyxLQUFoQyxFQUE2RDtBQUMzRCxzQkFBTyxrQ0FBT0EsS0FBSyxDQUFDdUIsTUFBTixDQUFheUIsS0FBcEIsQ0FBUDtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENvcHlyaWdodCAoYykgMjAxNy1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxyXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4gKlxyXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBCU0Qtc3R5bGUgbGljZW5zZSBmb3VuZCBpbiB0aGVcclxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLiBBbiBhZGRpdGlvbmFsIGdyYW50XHJcbiAqIG9mIHBhdGVudCByaWdodHMgY2FuIGJlIGZvdW5kIGluIHRoZSBQQVRFTlRTIGZpbGUgaW4gdGhlIHNhbWUgZGlyZWN0b3J5LlxyXG4gKlxyXG4gKiBAZmxvd1xyXG4gKiBAZm9ybWF0XHJcbiAqL1xyXG5cclxuaW1wb3J0IFVuaXZlcnNhbERpc3Bvc2FibGUgZnJvbSAnQGF0b20taWRlLWNvbW11bml0eS9udWNsaWRlLWNvbW1vbnMvVW5pdmVyc2FsRGlzcG9zYWJsZSc7XHJcbmltcG9ydCBjbGFzc25hbWVzIGZyb20gJ2NsYXNzbmFtZXMnO1xyXG5pbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XHJcbmltcG9ydCBSZWFjdERPTSBmcm9tICdyZWFjdC1kb20nO1xyXG5cclxudHlwZSBPcHRpb24gPSB7XHJcbiAgLy8gJEZsb3dGaXhNZSg+PTAuNTMuMCkgRmxvdyBzdXBwcmVzc1xyXG4gIGxhYmVsOiBSZWFjdC5DaGlsZHJlbixcclxuICB2YWx1ZTogYW55LFxyXG59O1xyXG5cclxudHlwZSBQcm9wcyA9IHtcclxuICAvLyAkRmxvd0ZpeE1lKD49MC41My4wKSBGbG93IHN1cHByZXNzXHJcbiAgb3B0aW9uQ29tcG9uZW50PzogKHByb3BzOiBPcHRpb25Db21wb25lbnRQcm9wcykgPT4gUmVhY3QuRWxlbWVudDxhbnk+LFxyXG4gIC8vIFRPRE86IHJlbW92ZSBkaXNhYmxlXHJcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0L25vLXVudXNlZC1wcm9wLXR5cGVzXHJcbiAgY2xhc3NOYW1lPzogc3RyaW5nLFxyXG4gIG9wdGlvbnM6IEFycmF5PE9wdGlvbj4sXHJcbiAgdmFsdWU6IEFycmF5PGFueT4sXHJcbiAgb25DaGFuZ2U6ICh2YWx1ZTogQXJyYXk8YW55PikgPT4gdm9pZCxcclxuICBjb21tYW5kU2NvcGU/OiBIVE1MRWxlbWVudCxcclxufTtcclxuXHJcbnR5cGUgU3RhdGUgPSB7XHJcbiAgc2VsZWN0ZWRWYWx1ZTogYW55LFxyXG59O1xyXG5cclxudHlwZSBEZWZhdWx0UHJvcHMgPSB7XHJcbiAgb25DaGFuZ2U6ICh2YWx1ZTogQXJyYXk8YW55PikgPT4gdm9pZCxcclxuICBvcHRpb25Db21wb25lbnQ6IFJlYWN0LkNvbXBvbmVudFR5cGU8T3B0aW9uQ29tcG9uZW50UHJvcHM+LFxyXG4gIHZhbHVlOiBBcnJheTxhbnk+LFxyXG4gIG9wdGlvbnM6IEFycmF5PE9wdGlvbj4sXHJcbn07XHJcblxyXG5leHBvcnQgY2xhc3MgTXVsdGlTZWxlY3RMaXN0IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PFByb3BzLCBTdGF0ZT4ge1xyXG4gIF9jb21tYW5kc0Rpc3Bvc2FibGVzOiBVbml2ZXJzYWxEaXNwb3NhYmxlO1xyXG5cclxuICBzdGF0aWMgZGVmYXVsdFByb3BzOiBEZWZhdWx0UHJvcHMgPSB7XHJcbiAgICBvbkNoYW5nZTogdmFsdWVzID0+IHt9LFxyXG4gICAgb3B0aW9uQ29tcG9uZW50OiBEZWZhdWx0T3B0aW9uQ29tcG9uZW50LFxyXG4gICAgb3B0aW9uczogW10sXHJcbiAgICB2YWx1ZTogW10sXHJcbiAgfTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJvcHM6IFByb3BzKSB7XHJcbiAgICBzdXBlcihwcm9wcyk7XHJcbiAgICB0aGlzLnN0YXRlID0ge1xyXG4gICAgICBzZWxlY3RlZFZhbHVlOiBudWxsLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGNvbXBvbmVudERpZE1vdW50KCk6IHZvaWQge1xyXG4gICAgdGhpcy5fdXBkYXRlQ29tbWFuZHMoKTtcclxuICB9XHJcblxyXG4gIGNvbXBvbmVudERpZFVwZGF0ZShwcmV2UHJvcHM6IFByb3BzKTogdm9pZCB7XHJcbiAgICBpZiAocHJldlByb3BzLmNvbW1hbmRTY29wZSAhPT0gdGhpcy5wcm9wcy5jb21tYW5kU2NvcGUpIHtcclxuICAgICAgdGhpcy5fdXBkYXRlQ29tbWFuZHMoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF91cGRhdGVDb21tYW5kcygpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLl9jb21tYW5kc0Rpc3Bvc2FibGVzICE9IG51bGwpIHtcclxuICAgICAgdGhpcy5fY29tbWFuZHNEaXNwb3NhYmxlcy5kaXNwb3NlKCk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBlbCA9IHRoaXMucHJvcHMuY29tbWFuZFNjb3BlIHx8IFJlYWN0RE9NLmZpbmRET01Ob2RlKHRoaXMpO1xyXG4gICAgdGhpcy5fY29tbWFuZHNEaXNwb3NhYmxlcyA9IG5ldyBVbml2ZXJzYWxEaXNwb3NhYmxlKFxyXG4gICAgICBhdG9tLmNvbW1hbmRzLmFkZChcclxuICAgICAgICAvLyAkRmxvd0ZpeE1lXHJcbiAgICAgICAgZWwsXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgJ2NvcmU6bW92ZS11cCc6ICgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5fbW92ZVNlbGVjdGlvbkluZGV4KC0xKTtcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICAnY29yZTptb3ZlLWRvd24nOiAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuX21vdmVTZWxlY3Rpb25JbmRleCgxKTtcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICAnY29yZTpjb25maXJtJzogKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB7c2VsZWN0ZWRWYWx1ZX0gPSB0aGlzLnN0YXRlO1xyXG4gICAgICAgICAgICBpZiAoc2VsZWN0ZWRWYWx1ZSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5fdG9nZ2xlQWN0aXZlKHNlbGVjdGVkVmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIH0sXHJcbiAgICAgICksXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgX21vdmVTZWxlY3Rpb25JbmRleChkZWx0YTogbnVtYmVyKTogdm9pZCB7XHJcbiAgICBjb25zdCBjdXJyZW50SW5kZXggPSB0aGlzLnByb3BzLm9wdGlvbnMuZmluZEluZGV4KFxyXG4gICAgICBvcHRpb24gPT4gb3B0aW9uLnZhbHVlID09PSB0aGlzLnN0YXRlLnNlbGVjdGVkVmFsdWUsXHJcbiAgICApO1xyXG4gICAgY29uc3QgbmV4dEluZGV4ID0gY3VycmVudEluZGV4ICsgZGVsdGE7XHJcbiAgICBpZiAobmV4dEluZGV4ID49IDAgJiYgbmV4dEluZGV4IDwgdGhpcy5wcm9wcy5vcHRpb25zLmxlbmd0aCkge1xyXG4gICAgICB0aGlzLnNldFN0YXRlKHtzZWxlY3RlZFZhbHVlOiB0aGlzLnByb3BzLm9wdGlvbnNbbmV4dEluZGV4XS52YWx1ZX0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY29tcG9uZW50V2lsbFVubW91bnQoKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5fY29tbWFuZHNEaXNwb3NhYmxlcyAhPSBudWxsKSB7XHJcbiAgICAgIHRoaXMuX2NvbW1hbmRzRGlzcG9zYWJsZXMuZGlzcG9zZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgX3RvZ2dsZUFjdGl2ZSh2YWx1ZTogYW55KTogdm9pZCB7XHJcbiAgICBjb25zdCBhY3RpdmVWYWx1ZXMgPSB0aGlzLnByb3BzLnZhbHVlLnNsaWNlKCk7XHJcbiAgICBjb25zdCBpbmRleCA9IGFjdGl2ZVZhbHVlcy5pbmRleE9mKHZhbHVlKTtcclxuICAgIGlmIChpbmRleCA9PT0gLTEpIHtcclxuICAgICAgYWN0aXZlVmFsdWVzLnB1c2godmFsdWUpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgYWN0aXZlVmFsdWVzLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLnByb3BzLm9uQ2hhbmdlKGFjdGl2ZVZhbHVlcyk7XHJcbiAgfVxyXG5cclxuICByZW5kZXIoKTogUmVhY3QuTm9kZSB7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cIm51Y2xpZGUtbXVsdGktc2VsZWN0LWxpc3Qgc2VsZWN0LWxpc3QgYmxvY2tcIiB0YWJJbmRleD1cIjBcIj5cclxuICAgICAgICA8b2wgY2xhc3NOYW1lPVwibGlzdC1ncm91cCBtYXJrLWFjdGl2ZVwiPnt0aGlzLl9yZW5kZXJPcHRpb25zKCl9PC9vbD5cclxuICAgICAgPC9kaXY+XHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgX3JlbmRlck9wdGlvbnMoKTogQXJyYXk8UmVhY3QuRWxlbWVudDxhbnk+PiB7XHJcbiAgICBjb25zdCBPcHRpb25Db21wb25lbnQgPVxyXG4gICAgICB0aGlzLnByb3BzLm9wdGlvbkNvbXBvbmVudCB8fCBEZWZhdWx0T3B0aW9uQ29tcG9uZW50O1xyXG4gICAgcmV0dXJuIHRoaXMucHJvcHMub3B0aW9ucy5tYXAoKG9wdGlvbiwgaW5kZXgpID0+IHtcclxuICAgICAgY29uc3Qgc2VsZWN0ZWQgPSB0aGlzLnN0YXRlLnNlbGVjdGVkVmFsdWUgPT09IG9wdGlvbi52YWx1ZTtcclxuICAgICAgY29uc3QgYWN0aXZlID0gdGhpcy5wcm9wcy52YWx1ZS5pbmRleE9mKG9wdGlvbi52YWx1ZSkgIT09IC0xO1xyXG4gICAgICBjb25zdCBjbGFzc05hbWUgPSBjbGFzc25hbWVzKHtcclxuICAgICAgICBjbGVhcmZpeDogdHJ1ZSxcclxuICAgICAgICBzZWxlY3RlZCxcclxuICAgICAgICBhY3RpdmUsXHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gKFxyXG4gICAgICAgIDxsaVxyXG4gICAgICAgICAga2V5PXtpbmRleH1cclxuICAgICAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lfVxyXG4gICAgICAgICAgb25Nb3VzZU92ZXI9eygpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7c2VsZWN0ZWRWYWx1ZTogb3B0aW9uLnZhbHVlfSk7XHJcbiAgICAgICAgICB9fVxyXG4gICAgICAgICAgb25DbGljaz17KCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLl90b2dnbGVBY3RpdmUob3B0aW9uLnZhbHVlKTtcclxuICAgICAgICAgIH19PlxyXG4gICAgICAgICAgPE9wdGlvbkNvbXBvbmVudFxyXG4gICAgICAgICAgICBvcHRpb249e29wdGlvbn1cclxuICAgICAgICAgICAgYWN0aXZlPXthY3RpdmV9XHJcbiAgICAgICAgICAgIHNlbGVjdGVkPXtzZWxlY3RlZH1cclxuICAgICAgICAgIC8+XHJcbiAgICAgICAgPC9saT5cclxuICAgICAgKTtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IHR5cGUgT3B0aW9uQ29tcG9uZW50UHJvcHMgPSB7XHJcbiAgb3B0aW9uOiBPcHRpb24sXHJcbiAgLy8gVE9ETzogcmVtb3ZlIGRpc2FibGVcclxuICAvKiBlc2xpbnQtZGlzYWJsZSByZWFjdC9uby11bnVzZWQtcHJvcC10eXBlcyAqL1xyXG4gIGFjdGl2ZTogYm9vbGVhbixcclxuICBzZWxlY3RlZDogYm9vbGVhbixcclxuICAvKiBlc2xpbnQtZW5hYmxlIHJlYWN0L25vLXVudXNlZC1wcm9wLXR5cGVzICovXHJcbn07XHJcblxyXG5mdW5jdGlvbiBEZWZhdWx0T3B0aW9uQ29tcG9uZW50KHByb3BzOiBPcHRpb25Db21wb25lbnRQcm9wcykge1xyXG4gIHJldHVybiA8c3Bhbj57cHJvcHMub3B0aW9uLmxhYmVsfTwvc3Bhbj47XHJcbn1cclxuIl19