"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _UniversalDisposable = _interopRequireDefault(require("@atom-ide-community/nuclide-commons/UniversalDisposable"));

var React = _interopRequireWildcard(require("react"));

var _nullthrows = _interopRequireDefault(require("nullthrows"));

var _PulseButton = _interopRequireDefault(require("./PulseButton"));

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */
class PulseButtonWithTooltip extends React.Component {
  constructor(...args) {
    super(...args);
    this._divEl = void 0;
    this._disposables = void 0;
    this._tooltipDisposable = void 0;
    this.state = {
      isDismissing: false,
      dismissed: false
    };

    this._handleDivRef = el => {
      this._divEl = el;
    };

    this._handleDismiss = () => {
      this.setState({
        isDismissing: true
      });

      if (this.props.onDismiss != null) {
        this.props.onDismiss();
      }
    };

    this._handleButtonClick = e => {
      const {
        onClick
      } = this.props;

      const tooltip = this._getTooltip();

      if (tooltip != null) {
        tooltip.show();
      }

      if (onClick != null) {
        onClick(e);
      }
    };
  }

  componentDidMount() {
    this._tooltipDisposable = this._updateTooltip();
    (0, _nullthrows.default)(this._getTooltip()).hide();
    this._disposables = new _UniversalDisposable.default(this._tooltipDisposable);
  }

  componentDidUpdate(prevProps, prevState) {
    if (!prevState.isDismissing && this.state.isDismissing) {
      const tooltip = this._getTooltip();

      if (tooltip != null) {
        tooltip.hide();
      }

      this.setState({
        dismissed: true
      });
    }

    if (prevProps.tooltipText !== this.props.tooltipText) {
      this._tooltipDisposable.dispose();

      this._tooltipDisposable = this._updateTooltip();
    }
  }

  componentWillUnmount() {
    (0, _nullthrows.default)(this._disposables).dispose();
  }

  _updateTooltip() {
    return atom.tooltips.add((0, _nullthrows.default)(this._divEl), {
      item: createTooltipBody(this.props.tooltipText, this._handleDismiss),
      trigger: 'manual'
    });
  }

  _getTooltip() {
    if (this._divEl == null) {
      return;
    }

    return atom.tooltips.findTooltips(this._divEl)[0];
  }

  render() {
    const {
      ariaLabel,
      className,
      isSelected,
      size,
      style,
      onMouseOver,
      onMouseLeave,
      wrapperStyle
    } = this.props;

    if (this.state.dismissed) {
      return null;
    }

    return /*#__PURE__*/React.createElement("div", {
      ref: this._handleDivRef,
      style: wrapperStyle
    }, /*#__PURE__*/React.createElement(_PulseButton.default, {
      ariaLabel: ariaLabel,
      className: className,
      isSelected: isSelected,
      onClick: this._handleButtonClick,
      size: size,
      style: style,
      onMouseOver: onMouseOver,
      onMouseLeave: onMouseLeave
    }));
  }

}

exports.default = PulseButtonWithTooltip;

function createTooltipBody(title, onDismiss) {
  const div = document.createElement('div');
  const p = document.createElement('p');
  p.innerText = title;
  div.appendChild(p);
  const button = document.createElement('button');
  button.classList.add('btn', 'btn-primary');
  button.innerText = 'Got it';
  button.addEventListener('click', onDismiss);
  div.appendChild(button);
  return div;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL251Y2xpZGUvbnVjbGlkZS1jb21tb25zLXVpL1B1bHNlQnV0dG9uV2l0aFRvb2x0aXAuanMiXSwibmFtZXMiOlsiUHVsc2VCdXR0b25XaXRoVG9vbHRpcCIsIlJlYWN0IiwiQ29tcG9uZW50IiwiX2RpdkVsIiwiX2Rpc3Bvc2FibGVzIiwiX3Rvb2x0aXBEaXNwb3NhYmxlIiwic3RhdGUiLCJpc0Rpc21pc3NpbmciLCJkaXNtaXNzZWQiLCJfaGFuZGxlRGl2UmVmIiwiZWwiLCJfaGFuZGxlRGlzbWlzcyIsInNldFN0YXRlIiwicHJvcHMiLCJvbkRpc21pc3MiLCJfaGFuZGxlQnV0dG9uQ2xpY2siLCJlIiwib25DbGljayIsInRvb2x0aXAiLCJfZ2V0VG9vbHRpcCIsInNob3ciLCJjb21wb25lbnREaWRNb3VudCIsIl91cGRhdGVUb29sdGlwIiwiaGlkZSIsIlVuaXZlcnNhbERpc3Bvc2FibGUiLCJjb21wb25lbnREaWRVcGRhdGUiLCJwcmV2UHJvcHMiLCJwcmV2U3RhdGUiLCJ0b29sdGlwVGV4dCIsImRpc3Bvc2UiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsImF0b20iLCJ0b29sdGlwcyIsImFkZCIsIml0ZW0iLCJjcmVhdGVUb29sdGlwQm9keSIsInRyaWdnZXIiLCJmaW5kVG9vbHRpcHMiLCJyZW5kZXIiLCJhcmlhTGFiZWwiLCJjbGFzc05hbWUiLCJpc1NlbGVjdGVkIiwic2l6ZSIsInN0eWxlIiwib25Nb3VzZU92ZXIiLCJvbk1vdXNlTGVhdmUiLCJ3cmFwcGVyU3R5bGUiLCJ0aXRsZSIsImRpdiIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInAiLCJpbm5lclRleHQiLCJhcHBlbmRDaGlsZCIsImJ1dHRvbiIsImNsYXNzTGlzdCIsImFkZEV2ZW50TGlzdGVuZXIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFZQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7QUFmQTs7Ozs7Ozs7Ozs7QUFvQ2UsTUFBTUEsc0JBQU4sU0FBcUNDLEtBQUss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NUI7QUFDQXFCLEVBQUFBLE1BQU0sQ0FBQ0YsU0FBUCxHQUFtQixRQUFuQjtBQUNBRSxFQUFBQSxNQUFNLENBQUNFLGdCQUFQLENBQXdCLE9BQXhCLEVBQWlDMUMsU0FBakM7QUFDQWtDLEVBQUFBLEdBQUcsQ0FBQ0ssV0FBSixDQUFnQkMsTUFBaEI7QUFDQSxTQUFPTixHQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ29weXJpZ2h0IChjKSAyMDE3LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXHJcbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbiAqXHJcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIEJTRC1zdHlsZSBsaWNlbnNlIGZvdW5kIGluIHRoZVxyXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuIEFuIGFkZGl0aW9uYWwgZ3JhbnRcclxuICogb2YgcGF0ZW50IHJpZ2h0cyBjYW4gYmUgZm91bmQgaW4gdGhlIFBBVEVOVFMgZmlsZSBpbiB0aGUgc2FtZSBkaXJlY3RvcnkuXHJcbiAqXHJcbiAqIEBmbG93IHN0cmljdC1sb2NhbFxyXG4gKiBAZm9ybWF0XHJcbiAqL1xyXG5cclxuaW1wb3J0IFVuaXZlcnNhbERpc3Bvc2FibGUgZnJvbSAnQGF0b20taWRlLWNvbW11bml0eS9udWNsaWRlLWNvbW1vbnMvVW5pdmVyc2FsRGlzcG9zYWJsZSc7XHJcbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0IG51bGx0aHJvd3MgZnJvbSAnbnVsbHRocm93cyc7XHJcbmltcG9ydCBQdWxzZUJ1dHRvbiBmcm9tICcuL1B1bHNlQnV0dG9uJztcclxuXHJcbnR5cGUgUHJvcHMgPSB7XHJcbiAgYXJpYUxhYmVsOiBzdHJpbmcsXHJcbiAgY2xhc3NOYW1lPzogc3RyaW5nLFxyXG4gIGlzU2VsZWN0ZWQ/OiBib29sZWFuLFxyXG4gIG9uQ2xpY2s/OiAoU3ludGhldGljTW91c2VFdmVudDw+KSA9PiBtaXhlZCxcclxuICBvbkRpc21pc3M/OiAoKSA9PiBtaXhlZCxcclxuICBzaXplPzogbnVtYmVyLFxyXG4gIHN0eWxlPzoge1trZXk6IHN0cmluZ106IHN0cmluZ30sXHJcbiAgd3JhcHBlclN0eWxlPzoge1trZXk6IHN0cmluZ106IHN0cmluZ30sXHJcbiAgb25Nb3VzZU92ZXI/OiAoU3ludGhldGljTW91c2VFdmVudDw+KSA9PiBtaXhlZCxcclxuICBvbk1vdXNlTGVhdmU/OiAoU3ludGhldGljTW91c2VFdmVudDw+KSA9PiBtaXhlZCxcclxuICB0b29sdGlwVGV4dDogc3RyaW5nLFxyXG59O1xyXG5cclxudHlwZSBTdGF0ZSA9IHtcclxuICBkaXNtaXNzZWQ6IGJvb2xlYW4sXHJcbiAgaXNEaXNtaXNzaW5nOiBib29sZWFuLFxyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUHVsc2VCdXR0b25XaXRoVG9vbHRpcCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxcclxuICBQcm9wcyxcclxuICBTdGF0ZSxcclxuPiB7XHJcbiAgX2RpdkVsOiA/SFRNTERpdkVsZW1lbnQ7XHJcbiAgX2Rpc3Bvc2FibGVzOiA/VW5pdmVyc2FsRGlzcG9zYWJsZTtcclxuICBfdG9vbHRpcERpc3Bvc2FibGU6IElEaXNwb3NhYmxlO1xyXG4gIHN0YXRlID0ge1xyXG4gICAgaXNEaXNtaXNzaW5nOiBmYWxzZSxcclxuICAgIGRpc21pc3NlZDogZmFsc2UsXHJcbiAgfTtcclxuXHJcbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XHJcbiAgICB0aGlzLl90b29sdGlwRGlzcG9zYWJsZSA9IHRoaXMuX3VwZGF0ZVRvb2x0aXAoKTtcclxuICAgIG51bGx0aHJvd3ModGhpcy5fZ2V0VG9vbHRpcCgpKS5oaWRlKCk7XHJcbiAgICB0aGlzLl9kaXNwb3NhYmxlcyA9IG5ldyBVbml2ZXJzYWxEaXNwb3NhYmxlKHRoaXMuX3Rvb2x0aXBEaXNwb3NhYmxlKTtcclxuICB9XHJcblxyXG4gIGNvbXBvbmVudERpZFVwZGF0ZShwcmV2UHJvcHM6IFByb3BzLCBwcmV2U3RhdGU6IFN0YXRlKSB7XHJcbiAgICBpZiAoIXByZXZTdGF0ZS5pc0Rpc21pc3NpbmcgJiYgdGhpcy5zdGF0ZS5pc0Rpc21pc3NpbmcpIHtcclxuICAgICAgY29uc3QgdG9vbHRpcCA9IHRoaXMuX2dldFRvb2x0aXAoKTtcclxuICAgICAgaWYgKHRvb2x0aXAgIT0gbnVsbCkge1xyXG4gICAgICAgIHRvb2x0aXAuaGlkZSgpO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuc2V0U3RhdGUoe2Rpc21pc3NlZDogdHJ1ZX0pO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChwcmV2UHJvcHMudG9vbHRpcFRleHQgIT09IHRoaXMucHJvcHMudG9vbHRpcFRleHQpIHtcclxuICAgICAgdGhpcy5fdG9vbHRpcERpc3Bvc2FibGUuZGlzcG9zZSgpO1xyXG4gICAgICB0aGlzLl90b29sdGlwRGlzcG9zYWJsZSA9IHRoaXMuX3VwZGF0ZVRvb2x0aXAoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xyXG4gICAgbnVsbHRocm93cyh0aGlzLl9kaXNwb3NhYmxlcykuZGlzcG9zZSgpO1xyXG4gIH1cclxuXHJcbiAgX3VwZGF0ZVRvb2x0aXAoKTogSURpc3Bvc2FibGUge1xyXG4gICAgcmV0dXJuIGF0b20udG9vbHRpcHMuYWRkKG51bGx0aHJvd3ModGhpcy5fZGl2RWwpLCB7XHJcbiAgICAgIGl0ZW06IGNyZWF0ZVRvb2x0aXBCb2R5KHRoaXMucHJvcHMudG9vbHRpcFRleHQsIHRoaXMuX2hhbmRsZURpc21pc3MpLFxyXG4gICAgICB0cmlnZ2VyOiAnbWFudWFsJyxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgX2hhbmRsZURpdlJlZiA9IChlbDogP0hUTUxEaXZFbGVtZW50KSA9PiB7XHJcbiAgICB0aGlzLl9kaXZFbCA9IGVsO1xyXG4gIH07XHJcblxyXG4gIF9oYW5kbGVEaXNtaXNzID0gKCkgPT4ge1xyXG4gICAgdGhpcy5zZXRTdGF0ZSh7aXNEaXNtaXNzaW5nOiB0cnVlfSk7XHJcbiAgICBpZiAodGhpcy5wcm9wcy5vbkRpc21pc3MgIT0gbnVsbCkge1xyXG4gICAgICB0aGlzLnByb3BzLm9uRGlzbWlzcygpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIF9oYW5kbGVCdXR0b25DbGljayA9IChlOiBTeW50aGV0aWNNb3VzZUV2ZW50PD4pID0+IHtcclxuICAgIGNvbnN0IHtvbkNsaWNrfSA9IHRoaXMucHJvcHM7XHJcbiAgICBjb25zdCB0b29sdGlwID0gdGhpcy5fZ2V0VG9vbHRpcCgpO1xyXG4gICAgaWYgKHRvb2x0aXAgIT0gbnVsbCkge1xyXG4gICAgICB0b29sdGlwLnNob3coKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAob25DbGljayAhPSBudWxsKSB7XHJcbiAgICAgIG9uQ2xpY2soZSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgX2dldFRvb2x0aXAoKTogP2F0b20kVG9vbHRpcCB7XHJcbiAgICBpZiAodGhpcy5fZGl2RWwgPT0gbnVsbCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGF0b20udG9vbHRpcHMuZmluZFRvb2x0aXBzKHRoaXMuX2RpdkVsKVswXTtcclxuICB9XHJcblxyXG4gIHJlbmRlcigpIHtcclxuICAgIGNvbnN0IHtcclxuICAgICAgYXJpYUxhYmVsLFxyXG4gICAgICBjbGFzc05hbWUsXHJcbiAgICAgIGlzU2VsZWN0ZWQsXHJcbiAgICAgIHNpemUsXHJcbiAgICAgIHN0eWxlLFxyXG4gICAgICBvbk1vdXNlT3ZlcixcclxuICAgICAgb25Nb3VzZUxlYXZlLFxyXG4gICAgICB3cmFwcGVyU3R5bGUsXHJcbiAgICB9ID0gdGhpcy5wcm9wcztcclxuXHJcbiAgICBpZiAodGhpcy5zdGF0ZS5kaXNtaXNzZWQpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIChcclxuICAgICAgPGRpdiByZWY9e3RoaXMuX2hhbmRsZURpdlJlZn0gc3R5bGU9e3dyYXBwZXJTdHlsZX0+XHJcbiAgICAgICAgPFB1bHNlQnV0dG9uXHJcbiAgICAgICAgICBhcmlhTGFiZWw9e2FyaWFMYWJlbH1cclxuICAgICAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lfVxyXG4gICAgICAgICAgaXNTZWxlY3RlZD17aXNTZWxlY3RlZH1cclxuICAgICAgICAgIG9uQ2xpY2s9e3RoaXMuX2hhbmRsZUJ1dHRvbkNsaWNrfVxyXG4gICAgICAgICAgc2l6ZT17c2l6ZX1cclxuICAgICAgICAgIHN0eWxlPXtzdHlsZX1cclxuICAgICAgICAgIG9uTW91c2VPdmVyPXtvbk1vdXNlT3Zlcn1cclxuICAgICAgICAgIG9uTW91c2VMZWF2ZT17b25Nb3VzZUxlYXZlfVxyXG4gICAgICAgIC8+XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgKTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNyZWF0ZVRvb2x0aXBCb2R5KHRpdGxlLCBvbkRpc21pc3MpIHtcclxuICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICBjb25zdCBwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIHAuaW5uZXJUZXh0ID0gdGl0bGU7XHJcbiAgZGl2LmFwcGVuZENoaWxkKHApO1xyXG5cclxuICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcclxuICBidXR0b24uY2xhc3NMaXN0LmFkZCgnYnRuJywgJ2J0bi1wcmltYXJ5Jyk7XHJcbiAgYnV0dG9uLmlubmVyVGV4dCA9ICdHb3QgaXQnO1xyXG4gIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uRGlzbWlzcyk7XHJcbiAgZGl2LmFwcGVuZENoaWxkKGJ1dHRvbik7XHJcbiAgcmV0dXJuIGRpdjtcclxufVxyXG4iXX0=