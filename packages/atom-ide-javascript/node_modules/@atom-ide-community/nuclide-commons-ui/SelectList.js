"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _UniversalDisposable = _interopRequireDefault(require("@atom-ide-community/nuclide-commons/UniversalDisposable"));

var _classnames = _interopRequireDefault(require("classnames"));

var React = _interopRequireWildcard(require("react"));

var _reactDom = _interopRequireDefault(require("react-dom"));

var _scrollIntoView = require("./scrollIntoView");

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */
class SelectList extends React.Component {
  constructor(...args) {
    super(...args);
    this._commandsDisposables = void 0;
    this._activeElement = void 0;
  }

  componentDidMount() {
    this._updateCommands();
  }

  componentDidUpdate(prevProps) {
    if (prevProps.commandScope !== this.props.commandScope) {
      this._updateCommands();
    }

    if (prevProps.value !== this.props.value) {
      this._scrollActiveElementIntoView();
    }
  }

  _scrollActiveElementIntoView() {
    if (this._activeElement == null) {
      return;
    }

    (0, _scrollIntoView.scrollIntoViewIfNeeded)(this._activeElement);
  }

  _updateCommands() {
    if (this._commandsDisposables != null) {
      this._commandsDisposables.dispose();
    }

    const el = this.props.commandScope || _reactDom.default.findDOMNode(this);

    this._commandsDisposables = new _UniversalDisposable.default(atom.commands.add( // $FlowFixMe
    el, {
      'core:move-up': () => {
        this._moveSelectionIndex(-1);
      },
      'core:move-down': () => {
        this._moveSelectionIndex(1);
      }
    }));
  }

  _moveSelectionIndex(delta) {
    var _this$props$options$n;

    const currentIndex = this.props.options.findIndex(option => option.value === this.props.value);
    const nextIndex = currentIndex + delta;

    if (nextIndex < 0 || nextIndex >= this.props.options.length) {
      return;
    }

    this.props.onChange((_this$props$options$n = this.props.options[nextIndex]) === null || _this$props$options$n === void 0 ? void 0 : _this$props$options$n.value, nextIndex);
  }

  componentWillUnmount() {
    if (this._commandsDisposables != null) {
      this._commandsDisposables.dispose();
    }
  }

  render() {
    var _this$props$tabIndex;

    return /*#__PURE__*/React.createElement("div", {
      className: "nuclide-select-list select-list block",
      tabIndex: (_this$props$tabIndex = this.props.tabIndex) !== null && _this$props$tabIndex !== void 0 ? _this$props$tabIndex : '0'
    }, /*#__PURE__*/React.createElement("ol", {
      className: "list-group mark-active"
    }, this._renderOptions()));
  }

  _renderOptions() {
    const OptionComponent = this.props.optionComponent || DefaultOptionComponent;
    return this.props.options.map((option, index) => {
      const active = this.props.value === option.value;
      const className = (0, _classnames.default)({
        clearfix: true,
        active
      });
      let ref;

      if (active) {
        ref = el => {
          this._activeElement = el;
        };
      }

      return /*#__PURE__*/React.createElement("li", {
        key: index,
        className: className // eslint-disable-next-line nuclide-internal/jsx-simple-callback-refs
        ,
        ref: ref,
        onClick: () => {
          this.props.onChange(option.value, index);
        }
      }, /*#__PURE__*/React.createElement(OptionComponent, {
        option: option,
        active: active
      }));
    });
  }

}

exports.default = SelectList;
SelectList.defaultProps = {
  onChange: () => {},
  optionComponent: DefaultOptionComponent,
  options: [],
  value: null
};

function DefaultOptionComponent(props) {
  return /*#__PURE__*/React.createElement("span", null, props.option.label);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL251Y2xpZGUvbnVjbGlkZS1jb21tb25zLXVpL1NlbGVjdExpc3QuanMiXSwibmFtZXMiOlsiU2VsZWN0TGlzdCIsIlJlYWN0IiwiQ29tcG9uZW50IiwiX2NvbW1hbmRzRGlzcG9zYWJsZXMiLCJfYWN0aXZlRWxlbWVudCIsImNvbXBvbmVudERpZE1vdW50IiwiX3VwZGF0ZUNvbW1hbmRzIiwiY29tcG9uZW50RGlkVXBkYXRlIiwicHJldlByb3BzIiwiY29tbWFuZFNjb3BlIiwicHJvcHMiLCJ2YWx1ZSIsIl9zY3JvbGxBY3RpdmVFbGVtZW50SW50b1ZpZXciLCJkaXNwb3NlIiwiZWwiLCJSZWFjdERPTSIsImZpbmRET01Ob2RlIiwiVW5pdmVyc2FsRGlzcG9zYWJsZSIsImF0b20iLCJjb21tYW5kcyIsImFkZCIsIl9tb3ZlU2VsZWN0aW9uSW5kZXgiLCJkZWx0YSIsImN1cnJlbnRJbmRleCIsIm9wdGlvbnMiLCJmaW5kSW5kZXgiLCJvcHRpb24iLCJuZXh0SW5kZXgiLCJsZW5ndGgiLCJvbkNoYW5nZSIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwicmVuZGVyIiwidGFiSW5kZXgiLCJfcmVuZGVyT3B0aW9ucyIsIk9wdGlvbkNvbXBvbmVudCIsIm9wdGlvbkNvbXBvbmVudCIsIkRlZmF1bHRPcHRpb25Db21wb25lbnQiLCJtYXAiLCJpbmRleCIsImFjdGl2ZSIsImNsYXNzTmFtZSIsImNsZWFyZml4IiwicmVmIiwiZGVmYXVsdFByb3BzIiwibGFiZWwiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFZQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7QUFoQkE7Ozs7Ozs7Ozs7O0FBNENlLE1BQU1BLFVBQU4sU0FBeUJDLEtBQUssQ0FBQ0MsU0FBL0IsQ0FBZ0Q7QUFBQTtBQUFBO0FBQUEsU0FDN0RDLG9CQUQ2RDtBQUFBLFNBRTdEQyxjQUY2RDtBQUFBOztBQVc3REMsRUFBQUEsaUJBQWlCLEdBQVM7QUFDeEIsU0FBS0MsZUFBTDtBQUNEOztB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Sjs7QUFDQSxVQUFJSCxNQUFKLEVBQVk7QUFDVkcsUUFBQUEsR0FBRyxHQUFHNUIsRUFBRSxJQUFJO0FBQ1YsZUFBS1YsY0FBTCxHQUFzQlUsRUFBdEI7QUFDRCxTQUZEO0FBR0Q7O0FBQ0QsMEJBQ0U7QUFDRSxRQUFBLEdBQUcsRUFBRXdCLEtBRFA7QUFFRSxRQUFBLFNBQVMsRUFBRUUsU0FGYixDQUdFO0FBSEY7QUFJRSxRQUFBLEdBQUcsRUFBRUUsR0FKUDtBQUtFLFFBQUEsT0FBTyxFQUFFLE1BQU07QUFDYixlQUFLaEMsS0FBTCxDQUFXbUIsUUFBWCxDQUFvQkgsTUFBTSxDQUFDZixLQUEzQixFQUFrQzJCLEtBQWxDO0FBQ0Q7QUFQSCxzQkFRRSxvQkFBQyxlQUFEO0FBQWlCLFFBQUEsTUFBTSxFQUFFWixNQUF6QjtBQUFpQyxRQUFBLE1BQU0sRUFBRWE7QUFBekMsUUFSRixDQURGO0FBWUQsS0F4Qk0sQ0FBUDtBQXlCRDs7QUE1RzREOzs7QUFBMUN2QyxVLENBSVoyQyxZLEdBQTZCO0FBQ2xDZCxFQUFBQSxRQUFRLEVBQUUsTUFBTSxDQUFFLENBRGdCO0FBRWxDTSxFQUFBQSxlQUFlLEVBQUVDLHNCQUZpQjtBQUdsQ1osRUFBQUEsT0FBTyxFQUFFLEVBSHlCO0FBSWxDYixFQUFBQSxLQUFLLEVBQUU7QUFKMkIsQzs7QUFrSHRDLFNBQVN5QixzQkFBVCxDQUFnQzFCLEtBQWhDLEVBQTZEO0FBQzNELHNCQUFPLGtDQUFPQSxLQUFLLENBQUNnQixNQUFOLENBQWFrQixLQUFwQixDQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ29weXJpZ2h0IChjKSAyMDE3LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXHJcbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbiAqXHJcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIEJTRC1zdHlsZSBsaWNlbnNlIGZvdW5kIGluIHRoZVxyXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuIEFuIGFkZGl0aW9uYWwgZ3JhbnRcclxuICogb2YgcGF0ZW50IHJpZ2h0cyBjYW4gYmUgZm91bmQgaW4gdGhlIFBBVEVOVFMgZmlsZSBpbiB0aGUgc2FtZSBkaXJlY3RvcnkuXHJcbiAqXHJcbiAqIEBmbG93XHJcbiAqIEBmb3JtYXRcclxuICovXHJcblxyXG5pbXBvcnQgVW5pdmVyc2FsRGlzcG9zYWJsZSBmcm9tICdAYXRvbS1pZGUtY29tbXVuaXR5L251Y2xpZGUtY29tbW9ucy9Vbml2ZXJzYWxEaXNwb3NhYmxlJztcclxuaW1wb3J0IGNsYXNzbmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XHJcbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0IFJlYWN0RE9NIGZyb20gJ3JlYWN0LWRvbSc7XHJcbmltcG9ydCB7c2Nyb2xsSW50b1ZpZXdJZk5lZWRlZH0gZnJvbSAnLi9zY3JvbGxJbnRvVmlldyc7XHJcblxyXG50eXBlIE9wdGlvbiA9IHtcclxuICAvLyAkRmxvd0ZpeE1lKD49MC41My4wKSBGbG93IHN1cHByZXNzXHJcbiAgbGFiZWw6IFJlYWN0LkNoaWxkcmVuLFxyXG4gIHZhbHVlOiBhbnksXHJcbn07XHJcblxyXG50eXBlIFByb3BzID0ge1xyXG4gIC8vICRGbG93Rml4TWUoPj0wLjUzLjApIEZsb3cgc3VwcHJlc3NcclxuICBvcHRpb25Db21wb25lbnQ/OiAocHJvcHM6IE9wdGlvbkNvbXBvbmVudFByb3BzKSA9PiBSZWFjdC5FbGVtZW50PGFueT4sXHJcbiAgLy8gVE9ETzogcmVtb3ZlIGRpc2FibGVcclxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3Qvbm8tdW51c2VkLXByb3AtdHlwZXNcclxuICBjbGFzc05hbWU/OiBzdHJpbmcsXHJcbiAgb3B0aW9uczogQXJyYXk8T3B0aW9uPixcclxuICB2YWx1ZTogYW55LFxyXG4gIG9uQ2hhbmdlOiAodmFsdWU6IGFueSwgaW5kZXg6IG51bWJlcikgPT4gdm9pZCxcclxuICBjb21tYW5kU2NvcGU/OiBIVE1MRWxlbWVudCxcclxuICB0YWJJbmRleD86IHN0cmluZyxcclxufTtcclxuXHJcbnR5cGUgRGVmYXVsdFByb3BzID0ge1xyXG4gIG9uQ2hhbmdlOiAodmFsdWU6IGFueSwgaW5kZXg6IG51bWJlcikgPT4gdm9pZCxcclxuICBvcHRpb25Db21wb25lbnQ6IFJlYWN0LkNvbXBvbmVudFR5cGU8T3B0aW9uQ29tcG9uZW50UHJvcHM+LFxyXG4gIHZhbHVlOiBhbnksXHJcbiAgb3B0aW9uczogQXJyYXk8T3B0aW9uPixcclxufTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlbGVjdExpc3QgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8UHJvcHM+IHtcclxuICBfY29tbWFuZHNEaXNwb3NhYmxlczogVW5pdmVyc2FsRGlzcG9zYWJsZTtcclxuICBfYWN0aXZlRWxlbWVudDogP0hUTUxFbGVtZW50O1xyXG5cclxuICBzdGF0aWMgZGVmYXVsdFByb3BzOiBEZWZhdWx0UHJvcHMgPSB7XHJcbiAgICBvbkNoYW5nZTogKCkgPT4ge30sXHJcbiAgICBvcHRpb25Db21wb25lbnQ6IERlZmF1bHRPcHRpb25Db21wb25lbnQsXHJcbiAgICBvcHRpb25zOiBbXSxcclxuICAgIHZhbHVlOiBudWxsLFxyXG4gIH07XHJcblxyXG4gIGNvbXBvbmVudERpZE1vdW50KCk6IHZvaWQge1xyXG4gICAgdGhpcy5fdXBkYXRlQ29tbWFuZHMoKTtcclxuICB9XHJcblxyXG4gIGNvbXBvbmVudERpZFVwZGF0ZShwcmV2UHJvcHM6IFByb3BzKTogdm9pZCB7XHJcbiAgICBpZiAocHJldlByb3BzLmNvbW1hbmRTY29wZSAhPT0gdGhpcy5wcm9wcy5jb21tYW5kU2NvcGUpIHtcclxuICAgICAgdGhpcy5fdXBkYXRlQ29tbWFuZHMoKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAocHJldlByb3BzLnZhbHVlICE9PSB0aGlzLnByb3BzLnZhbHVlKSB7XHJcbiAgICAgIHRoaXMuX3Njcm9sbEFjdGl2ZUVsZW1lbnRJbnRvVmlldygpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgX3Njcm9sbEFjdGl2ZUVsZW1lbnRJbnRvVmlldygpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLl9hY3RpdmVFbGVtZW50ID09IG51bGwpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgc2Nyb2xsSW50b1ZpZXdJZk5lZWRlZCh0aGlzLl9hY3RpdmVFbGVtZW50KTtcclxuICB9XHJcblxyXG4gIF91cGRhdGVDb21tYW5kcygpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLl9jb21tYW5kc0Rpc3Bvc2FibGVzICE9IG51bGwpIHtcclxuICAgICAgdGhpcy5fY29tbWFuZHNEaXNwb3NhYmxlcy5kaXNwb3NlKCk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBlbCA9IHRoaXMucHJvcHMuY29tbWFuZFNjb3BlIHx8IFJlYWN0RE9NLmZpbmRET01Ob2RlKHRoaXMpO1xyXG4gICAgdGhpcy5fY29tbWFuZHNEaXNwb3NhYmxlcyA9IG5ldyBVbml2ZXJzYWxEaXNwb3NhYmxlKFxyXG4gICAgICBhdG9tLmNvbW1hbmRzLmFkZChcclxuICAgICAgICAvLyAkRmxvd0ZpeE1lXHJcbiAgICAgICAgZWwsXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgJ2NvcmU6bW92ZS11cCc6ICgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5fbW92ZVNlbGVjdGlvbkluZGV4KC0xKTtcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICAnY29yZTptb3ZlLWRvd24nOiAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuX21vdmVTZWxlY3Rpb25JbmRleCgxKTtcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgfSxcclxuICAgICAgKSxcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBfbW92ZVNlbGVjdGlvbkluZGV4KGRlbHRhOiBudW1iZXIpOiB2b2lkIHtcclxuICAgIGNvbnN0IGN1cnJlbnRJbmRleCA9IHRoaXMucHJvcHMub3B0aW9ucy5maW5kSW5kZXgoXHJcbiAgICAgIG9wdGlvbiA9PiBvcHRpb24udmFsdWUgPT09IHRoaXMucHJvcHMudmFsdWUsXHJcbiAgICApO1xyXG4gICAgY29uc3QgbmV4dEluZGV4ID0gY3VycmVudEluZGV4ICsgZGVsdGE7XHJcbiAgICBpZiAobmV4dEluZGV4IDwgMCB8fCBuZXh0SW5kZXggPj0gdGhpcy5wcm9wcy5vcHRpb25zLmxlbmd0aCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLnByb3BzLm9uQ2hhbmdlKHRoaXMucHJvcHMub3B0aW9uc1tuZXh0SW5kZXhdPy52YWx1ZSwgbmV4dEluZGV4KTtcclxuICB9XHJcblxyXG4gIGNvbXBvbmVudFdpbGxVbm1vdW50KCk6IHZvaWQge1xyXG4gICAgaWYgKHRoaXMuX2NvbW1hbmRzRGlzcG9zYWJsZXMgIT0gbnVsbCkge1xyXG4gICAgICB0aGlzLl9jb21tYW5kc0Rpc3Bvc2FibGVzLmRpc3Bvc2UoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJlbmRlcigpOiBSZWFjdC5Ob2RlIHtcclxuICAgIHJldHVybiAoXHJcbiAgICAgIDxkaXZcclxuICAgICAgICBjbGFzc05hbWU9XCJudWNsaWRlLXNlbGVjdC1saXN0IHNlbGVjdC1saXN0IGJsb2NrXCJcclxuICAgICAgICB0YWJJbmRleD17dGhpcy5wcm9wcy50YWJJbmRleCA/PyAnMCd9PlxyXG4gICAgICAgIDxvbCBjbGFzc05hbWU9XCJsaXN0LWdyb3VwIG1hcmstYWN0aXZlXCI+e3RoaXMuX3JlbmRlck9wdGlvbnMoKX08L29sPlxyXG4gICAgICA8L2Rpdj5cclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBfcmVuZGVyT3B0aW9ucygpOiBBcnJheTxSZWFjdC5FbGVtZW50PGFueT4+IHtcclxuICAgIGNvbnN0IE9wdGlvbkNvbXBvbmVudCA9XHJcbiAgICAgIHRoaXMucHJvcHMub3B0aW9uQ29tcG9uZW50IHx8IERlZmF1bHRPcHRpb25Db21wb25lbnQ7XHJcbiAgICByZXR1cm4gdGhpcy5wcm9wcy5vcHRpb25zLm1hcCgob3B0aW9uLCBpbmRleCkgPT4ge1xyXG4gICAgICBjb25zdCBhY3RpdmUgPSB0aGlzLnByb3BzLnZhbHVlID09PSBvcHRpb24udmFsdWU7XHJcbiAgICAgIGNvbnN0IGNsYXNzTmFtZSA9IGNsYXNzbmFtZXMoe1xyXG4gICAgICAgIGNsZWFyZml4OiB0cnVlLFxyXG4gICAgICAgIGFjdGl2ZSxcclxuICAgICAgfSk7XHJcbiAgICAgIGxldCByZWY7XHJcbiAgICAgIGlmIChhY3RpdmUpIHtcclxuICAgICAgICByZWYgPSBlbCA9PiB7XHJcbiAgICAgICAgICB0aGlzLl9hY3RpdmVFbGVtZW50ID0gZWw7XHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gKFxyXG4gICAgICAgIDxsaVxyXG4gICAgICAgICAga2V5PXtpbmRleH1cclxuICAgICAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lfVxyXG4gICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG51Y2xpZGUtaW50ZXJuYWwvanN4LXNpbXBsZS1jYWxsYmFjay1yZWZzXHJcbiAgICAgICAgICByZWY9e3JlZn1cclxuICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5wcm9wcy5vbkNoYW5nZShvcHRpb24udmFsdWUsIGluZGV4KTtcclxuICAgICAgICAgIH19PlxyXG4gICAgICAgICAgPE9wdGlvbkNvbXBvbmVudCBvcHRpb249e29wdGlvbn0gYWN0aXZlPXthY3RpdmV9IC8+XHJcbiAgICAgICAgPC9saT5cclxuICAgICAgKTtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IHR5cGUgT3B0aW9uQ29tcG9uZW50UHJvcHMgPSB7XHJcbiAgb3B0aW9uOiBPcHRpb24sXHJcbiAgLy8gVE9ETzogcmVtb3ZlIGRpc2FibGVcclxuICAvKiBlc2xpbnQtZGlzYWJsZSByZWFjdC9uby11bnVzZWQtcHJvcC10eXBlcyAqL1xyXG4gIGFjdGl2ZTogYm9vbGVhbixcclxufTtcclxuXHJcbmZ1bmN0aW9uIERlZmF1bHRPcHRpb25Db21wb25lbnQocHJvcHM6IE9wdGlvbkNvbXBvbmVudFByb3BzKSB7XHJcbiAgcmV0dXJuIDxzcGFuPntwcm9wcy5vcHRpb24ubGFiZWx9PC9zcGFuPjtcclxufVxyXG4iXX0=