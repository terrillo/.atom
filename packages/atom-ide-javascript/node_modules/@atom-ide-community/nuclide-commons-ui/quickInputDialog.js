"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = quickInputDialog;

var _AtomInput = require("./AtomInput");

var _Button = require("./Button");

var _ButtonGroup = require("./ButtonGroup");

var React = _interopRequireWildcard(require("react"));

var _reactDom = _interopRequireDefault(require("react-dom"));

var _UniversalDisposable = _interopRequireDefault(require("@atom-ide-community/nuclide-commons/UniversalDisposable"));

var _assert = _interopRequireDefault(require("assert"));

var _nullthrows = _interopRequireDefault(require("nullthrows"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */

/* global Node */
function quickInputDialog(title, inputLabel, onConfirm, validateInput, initialValue = '') {
  const item = document.createElement('div');
  const panel = atom.workspace.addModalPanel({
    item
  });
  return new Promise((resolve, reject) => {
    const cancel = () => {
      panel.destroy();
      resolve(null);
    };

    _reactDom.default.render( /*#__PURE__*/React.createElement(QuickInputDialog, {
      validateInput: validateInput,
      initialValue: initialValue,
      inputLabel: inputLabel,
      onCancel: cancel,
      onConfirm: content => {
        if (onConfirm) {
          onConfirm(content);
        }

        resolve(content);
        panel.destroy();
      },
      title: title
    }), item);

    panel.onDidDestroy(() => _reactDom.default.unmountComponentAtNode(item));
  });
}

class QuickInputDialog extends React.Component {
  constructor(props) {
    super(props);
    this._disposables = void 0;
    this._rootNode = void 0;

    this._handleOutsideClick = event => {
      const domNode = this._rootNode;
      (0, _assert.default)(event.target instanceof Node);

      if (!domNode || !domNode.contains(event.target)) {
        this.props.onCancel();
      }
    };

    this._handleConfirmClick = () => {
      this.props.onConfirm(this.state.content);
    };

    this._handleInputChange = content => {
      this.setState({
        content
      });
    };

    this.state = {
      content: props.initialValue
    };
    this._disposables = new _UniversalDisposable.default();
  }

  componentDidMount() {
    document.addEventListener('click', this._handleOutsideClick);
    const rootNode = (0, _nullthrows.default)(this._rootNode);

    this._disposables.add(() => document.removeEventListener('click', this._handleOutsideClick), atom.commands.add(rootNode, 'core:confirm', this._handleConfirmClick), atom.commands.add(rootNode, 'core:cancel', this.props.onCancel));
  }

  componentWillUnmount() {
    this._disposables.dispose();
  }

  render() {
    const errorMessage = this.props.validateInput(this.state.content);
    return /*#__PURE__*/React.createElement("div", {
      ref: rootNode => this._rootNode = rootNode
    }, /*#__PURE__*/React.createElement("h6", null, /*#__PURE__*/React.createElement("strong", null, this.props.title)), /*#__PURE__*/React.createElement("label", null, this.props.inputLabel), /*#__PURE__*/React.createElement(_AtomInput.AtomInput, {
      autofocus: true,
      initialValue: this.props.initialValue,
      onDidChange: this._handleInputChange,
      startSelected: true
    }), /*#__PURE__*/React.createElement("div", {
      style: {
        display: 'flex',
        justifyContent: 'space-between'
      }
    }, /*#__PURE__*/React.createElement("span", null, errorMessage), /*#__PURE__*/React.createElement(_ButtonGroup.ButtonGroup, {
      size: _ButtonGroup.ButtonGroupSizes.SMALL
    }, /*#__PURE__*/React.createElement(_Button.Button, {
      onClick: this.props.onCancel
    }, "Cancel"), /*#__PURE__*/React.createElement(_Button.Button, {
      buttonType: _Button.ButtonTypes.PRIMARY,
      disabled: errorMessage != null,
      onClick: this._handleConfirmClick
    }, "Confirm"))));
  }

}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL251Y2xpZGUvbnVjbGlkZS1jb21tb25zLXVpL3F1aWNrSW5wdXREaWFsb2cuanMiXSwibmFtZXMiOlsicXVpY2tJbnB1dERpYWxvZyIsInRpdGxlIiwiaW5wdXRMYWJlbCIsIm9uQ29uZmlybSIsInZhbGlkYXRlSW5wdXQiLCJpbml0aWFsVmFsdWUiLCJpdGVtIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwicGFuZWwiLCJhdG9tIiwid29ya3NwYWNlIiwiYWRkTW9kYWxQYW5lbCIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiY2FuY2VsIiwiZGVzdHJveSIsIlJlYWN0RE9NIiwicmVuZGVyIiwiY29udGVudCIsIm9uRGlkRGVzdHJveSIsInVubW91bnRDb21wb25lbnRBdE5vZGUiLCJRdWlja0lucHV0RGlhbG9nIiwiUmVhY3QiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiX2Rpc3Bvc2FibGVzIiwiX3Jvb3ROb2RlIiwiX2hhbmRsZU91dHNpZGVDbGljayIsImV2ZW50IiwiZG9tTm9kZSIsInRhcmdldCIsIk5vZGUiLCJjb250YWlucyIsIm9uQ2FuY2VsIiwiX2hhbmRsZUNvbmZpcm1DbGljayIsInN0YXRlIiwiX2hhbmRsZUlucHV0Q2hhbmdlIiwic2V0U3RhdGUiLCJVbml2ZXJzYWxEaXNwb3NhYmxlIiwiY29tcG9uZW50RGlkTW91bnQiLCJhZGRFdmVudExpc3RlbmVyIiwicm9vdE5vZGUiLCJhZGQiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiY29tbWFuZHMiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsImRpc3Bvc2UiLCJlcnJvck1lc3NhZ2UiLCJkaXNwbGF5IiwianVzdGlmeUNvbnRlbnQiLCJCdXR0b25Hcm91cFNpemVzIiwiU01BTEwiLCJCdXR0b25UeXBlcyIsIlBSSU1BUlkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFjQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7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RDtBQUNFLE1BQUEsVUFBVSxFQUFFbUIsb0JBQVlDLE9BRDFCO0FBRUUsTUFBQSxRQUFRLEVBQUVOLFlBQVksSUFBSSxJQUY1QjtBQUdFLE1BQUEsT0FBTyxFQUFFLEtBQUtiO0FBSGhCLGlCQUZGLENBRkYsQ0FYRixDQURGO0FBMEJEOztBQXpFMEQiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ29weXJpZ2h0IChjKSAyMDE3LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXHJcbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbiAqXHJcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIEJTRC1zdHlsZSBsaWNlbnNlIGZvdW5kIGluIHRoZVxyXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuIEFuIGFkZGl0aW9uYWwgZ3JhbnRcclxuICogb2YgcGF0ZW50IHJpZ2h0cyBjYW4gYmUgZm91bmQgaW4gdGhlIFBBVEVOVFMgZmlsZSBpbiB0aGUgc2FtZSBkaXJlY3RvcnkuXHJcbiAqXHJcbiAqIEBmbG93IHN0cmljdC1sb2NhbFxyXG4gKiBAZm9ybWF0XHJcbiAqL1xyXG5cclxuLyogZ2xvYmFsIE5vZGUgKi9cclxuXHJcbmltcG9ydCB7QXRvbUlucHV0fSBmcm9tICcuL0F0b21JbnB1dCc7XHJcbmltcG9ydCB7QnV0dG9uLCBCdXR0b25UeXBlc30gZnJvbSAnLi9CdXR0b24nO1xyXG5pbXBvcnQge0J1dHRvbkdyb3VwLCBCdXR0b25Hcm91cFNpemVzfSBmcm9tICcuL0J1dHRvbkdyb3VwJztcclxuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQgUmVhY3RET00gZnJvbSAncmVhY3QtZG9tJztcclxuaW1wb3J0IFVuaXZlcnNhbERpc3Bvc2FibGUgZnJvbSAnQGF0b20taWRlLWNvbW11bml0eS9udWNsaWRlLWNvbW1vbnMvVW5pdmVyc2FsRGlzcG9zYWJsZSc7XHJcbmltcG9ydCBpbnZhcmlhbnQgZnJvbSAnYXNzZXJ0JztcclxuaW1wb3J0IG51bGx0aHJvd3MgZnJvbSAnbnVsbHRocm93cyc7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBxdWlja0lucHV0RGlhbG9nKFxyXG4gIHRpdGxlOiBzdHJpbmcsXHJcbiAgaW5wdXRMYWJlbDogc3RyaW5nLFxyXG4gIG9uQ29uZmlybTogPyhzdHJpbmcpID0+IG1peGVkLFxyXG4gIHZhbGlkYXRlSW5wdXQ6IHN0cmluZyA9PiA/c3RyaW5nLFxyXG4gIGluaXRpYWxWYWx1ZTogc3RyaW5nID0gJycsXHJcbik6IFByb21pc2U8P3N0cmluZz4ge1xyXG4gIGNvbnN0IGl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICBjb25zdCBwYW5lbCA9IGF0b20ud29ya3NwYWNlLmFkZE1vZGFsUGFuZWwoe2l0ZW19KTtcclxuXHJcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgIGNvbnN0IGNhbmNlbCA9ICgpID0+IHtcclxuICAgICAgcGFuZWwuZGVzdHJveSgpO1xyXG4gICAgICByZXNvbHZlKG51bGwpO1xyXG4gICAgfTtcclxuXHJcbiAgICBSZWFjdERPTS5yZW5kZXIoXHJcbiAgICAgIDxRdWlja0lucHV0RGlhbG9nXHJcbiAgICAgICAgdmFsaWRhdGVJbnB1dD17dmFsaWRhdGVJbnB1dH1cclxuICAgICAgICBpbml0aWFsVmFsdWU9e2luaXRpYWxWYWx1ZX1cclxuICAgICAgICBpbnB1dExhYmVsPXtpbnB1dExhYmVsfVxyXG4gICAgICAgIG9uQ2FuY2VsPXtjYW5jZWx9XHJcbiAgICAgICAgb25Db25maXJtPXtjb250ZW50ID0+IHtcclxuICAgICAgICAgIGlmIChvbkNvbmZpcm0pIHtcclxuICAgICAgICAgICAgb25Db25maXJtKGNvbnRlbnQpO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIHJlc29sdmUoY29udGVudCk7XHJcbiAgICAgICAgICBwYW5lbC5kZXN0cm95KCk7XHJcbiAgICAgICAgfX1cclxuICAgICAgICB0aXRsZT17dGl0bGV9XHJcbiAgICAgIC8+LFxyXG4gICAgICBpdGVtLFxyXG4gICAgKTtcclxuXHJcbiAgICBwYW5lbC5vbkRpZERlc3Ryb3koKCkgPT4gUmVhY3RET00udW5tb3VudENvbXBvbmVudEF0Tm9kZShpdGVtKSk7XHJcbiAgfSk7XHJcbn1cclxuXHJcbnR5cGUgUHJvcHMgPSB7XHJcbiAgdmFsaWRhdGVJbnB1dDogc3RyaW5nID0+ID9zdHJpbmcsXHJcbiAgaW5pdGlhbFZhbHVlOiBzdHJpbmcsXHJcbiAgaW5wdXRMYWJlbDogc3RyaW5nLFxyXG4gIG9uQ2FuY2VsOiAoKSA9PiBtaXhlZCxcclxuICBvbkNvbmZpcm06IHN0cmluZyA9PiBtaXhlZCxcclxuICB0aXRsZTogc3RyaW5nLFxyXG59O1xyXG5cclxudHlwZSBTdGF0ZSA9IHtcclxuICBjb250ZW50OiBzdHJpbmcsXHJcbn07XHJcblxyXG5jbGFzcyBRdWlja0lucHV0RGlhbG9nIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PFByb3BzLCBTdGF0ZT4ge1xyXG4gIF9kaXNwb3NhYmxlczogVW5pdmVyc2FsRGlzcG9zYWJsZTtcclxuICBfcm9vdE5vZGU6ID9IVE1MRGl2RWxlbWVudDtcclxuXHJcbiAgY29uc3RydWN0b3IocHJvcHM6IFByb3BzKSB7XHJcbiAgICBzdXBlcihwcm9wcyk7XHJcblxyXG4gICAgdGhpcy5zdGF0ZSA9IHtcclxuICAgICAgY29udGVudDogcHJvcHMuaW5pdGlhbFZhbHVlLFxyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLl9kaXNwb3NhYmxlcyA9IG5ldyBVbml2ZXJzYWxEaXNwb3NhYmxlKCk7XHJcbiAgfVxyXG5cclxuICBjb21wb25lbnREaWRNb3VudCgpOiB2b2lkIHtcclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5faGFuZGxlT3V0c2lkZUNsaWNrKTtcclxuICAgIGNvbnN0IHJvb3ROb2RlID0gbnVsbHRocm93cyh0aGlzLl9yb290Tm9kZSk7XHJcblxyXG4gICAgdGhpcy5fZGlzcG9zYWJsZXMuYWRkKFxyXG4gICAgICAoKSA9PiBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuX2hhbmRsZU91dHNpZGVDbGljayksXHJcbiAgICAgIGF0b20uY29tbWFuZHMuYWRkKHJvb3ROb2RlLCAnY29yZTpjb25maXJtJywgdGhpcy5faGFuZGxlQ29uZmlybUNsaWNrKSxcclxuICAgICAgYXRvbS5jb21tYW5kcy5hZGQocm9vdE5vZGUsICdjb3JlOmNhbmNlbCcsIHRoaXMucHJvcHMub25DYW5jZWwpLFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGNvbXBvbmVudFdpbGxVbm1vdW50KCk6IHZvaWQge1xyXG4gICAgdGhpcy5fZGlzcG9zYWJsZXMuZGlzcG9zZSgpO1xyXG4gIH1cclxuXHJcbiAgX2hhbmRsZU91dHNpZGVDbGljayA9IChldmVudDogRXZlbnQpOiB2b2lkID0+IHtcclxuICAgIGNvbnN0IGRvbU5vZGUgPSB0aGlzLl9yb290Tm9kZTtcclxuICAgIGludmFyaWFudChldmVudC50YXJnZXQgaW5zdGFuY2VvZiBOb2RlKTtcclxuICAgIGlmICghZG9tTm9kZSB8fCAhZG9tTm9kZS5jb250YWlucyhldmVudC50YXJnZXQpKSB7XHJcbiAgICAgIHRoaXMucHJvcHMub25DYW5jZWwoKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBfaGFuZGxlQ29uZmlybUNsaWNrID0gKCk6IHZvaWQgPT4ge1xyXG4gICAgdGhpcy5wcm9wcy5vbkNvbmZpcm0odGhpcy5zdGF0ZS5jb250ZW50KTtcclxuICB9O1xyXG5cclxuICBfaGFuZGxlSW5wdXRDaGFuZ2UgPSAoY29udGVudDogc3RyaW5nKTogdm9pZCA9PiB7XHJcbiAgICB0aGlzLnNldFN0YXRlKHtjb250ZW50fSk7XHJcbiAgfTtcclxuXHJcbiAgcmVuZGVyKCk6IFJlYWN0Lk5vZGUge1xyXG4gICAgY29uc3QgZXJyb3JNZXNzYWdlID0gdGhpcy5wcm9wcy52YWxpZGF0ZUlucHV0KHRoaXMuc3RhdGUuY29udGVudCk7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICA8ZGl2IHJlZj17cm9vdE5vZGUgPT4gKHRoaXMuX3Jvb3ROb2RlID0gcm9vdE5vZGUpfT5cclxuICAgICAgICA8aDY+XHJcbiAgICAgICAgICA8c3Ryb25nPnt0aGlzLnByb3BzLnRpdGxlfTwvc3Ryb25nPlxyXG4gICAgICAgIDwvaDY+XHJcbiAgICAgICAgPGxhYmVsPnt0aGlzLnByb3BzLmlucHV0TGFiZWx9PC9sYWJlbD5cclxuICAgICAgICA8QXRvbUlucHV0XHJcbiAgICAgICAgICBhdXRvZm9jdXM9e3RydWV9XHJcbiAgICAgICAgICBpbml0aWFsVmFsdWU9e3RoaXMucHJvcHMuaW5pdGlhbFZhbHVlfVxyXG4gICAgICAgICAgb25EaWRDaGFuZ2U9e3RoaXMuX2hhbmRsZUlucHV0Q2hhbmdlfVxyXG4gICAgICAgICAgc3RhcnRTZWxlY3RlZD17dHJ1ZX1cclxuICAgICAgICAvPlxyXG4gICAgICAgIDxkaXYgc3R5bGU9e3tkaXNwbGF5OiAnZmxleCcsIGp1c3RpZnlDb250ZW50OiAnc3BhY2UtYmV0d2Vlbid9fT5cclxuICAgICAgICAgIDxzcGFuPntlcnJvck1lc3NhZ2V9PC9zcGFuPlxyXG4gICAgICAgICAgPEJ1dHRvbkdyb3VwIHNpemU9e0J1dHRvbkdyb3VwU2l6ZXMuU01BTEx9PlxyXG4gICAgICAgICAgICA8QnV0dG9uIG9uQ2xpY2s9e3RoaXMucHJvcHMub25DYW5jZWx9PkNhbmNlbDwvQnV0dG9uPlxyXG4gICAgICAgICAgICA8QnV0dG9uXHJcbiAgICAgICAgICAgICAgYnV0dG9uVHlwZT17QnV0dG9uVHlwZXMuUFJJTUFSWX1cclxuICAgICAgICAgICAgICBkaXNhYmxlZD17ZXJyb3JNZXNzYWdlICE9IG51bGx9XHJcbiAgICAgICAgICAgICAgb25DbGljaz17dGhpcy5faGFuZGxlQ29uZmlybUNsaWNrfT5cclxuICAgICAgICAgICAgICBDb25maXJtXHJcbiAgICAgICAgICAgIDwvQnV0dG9uPlxyXG4gICAgICAgICAgPC9CdXR0b25Hcm91cD5cclxuICAgICAgICA8L2Rpdj5cclxuICAgICAgPC9kaXY+XHJcbiAgICApO1xyXG4gIH1cclxufVxyXG4iXX0=