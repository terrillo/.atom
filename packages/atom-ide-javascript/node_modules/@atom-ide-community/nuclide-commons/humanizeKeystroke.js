"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = humanizeKeystroke;

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */

/*
 * adapted from https://github.com/atom/underscore-plus/blob/master/src/underscore-plus.coffee
 */
const MAC_MODIFIER_KEYMAP = {
  alt: '\u2325',
  cmd: '\u2318',
  ctrl: '\u2303',
  down: '\u2193',
  enter: '\u23ce',
  left: '\u2190',
  option: '\u2325',
  right: '\u2192',
  shift: '\u21e7',
  up: '\u2191'
};
const NON_MAC_MODIFIER_KEYMAP = {
  alt: 'Alt',
  cmd: 'Cmd',
  ctrl: 'Ctrl',
  down: 'Down',
  enter: 'Enter',
  left: 'Left',
  option: 'Alt',
  right: 'Right',
  shift: 'Shift',
  up: 'Up'
}; // Human key combos should always explicitly state the shift key. This map is a disambiguator.
// 'shift-version': 'no-shift-version'

const SHIFT_KEYMAP = {
  _: '-',
  ':': ';',
  '?': '/',
  '"': "'",
  '{': '[',
  '}': ']',
  '+': '=',
  '<': ',',
  '>': '.',
  '|': '\\',
  '~': '`'
};
const FN_KEY_RE = /f[0-9]{1,2}/; // $FlowIssue

function flatten(arr) {
  let flattened = [];

  for (const el of arr) {
    if (Array.isArray(el)) {
      flattened = flattened.concat(flatten(el));
    } else {
      flattened.push(el);
    }
  }

  return flattened;
}

function capitalize(word) {
  const first = word[0] || '';
  const rest = word.slice(1);
  return first.toUpperCase() + rest;
}

function humanizeKey(key, platform) {
  if (!key) {
    return key;
  }

  const modifierKeyMap = platform === 'darwin' ? MAC_MODIFIER_KEYMAP : NON_MAC_MODIFIER_KEYMAP;

  if (modifierKeyMap[key]) {
    return modifierKeyMap[key];
  }

  if (key.length === 1) {
    if (SHIFT_KEYMAP[key]) {
      return [modifierKeyMap.shift, SHIFT_KEYMAP[key]];
    }

    const uppercase = key.toUpperCase();

    if (key === uppercase && uppercase !== key.toLowerCase()) {
      return [modifierKeyMap.shift, uppercase];
    }

    return uppercase;
  }

  if (FN_KEY_RE.test(key)) {
    return key.toUpperCase();
  }

  return platform === 'darwin' ? key : capitalize(key);
}
/**
 * Humanize the keystroke according to platform conventions. This method
 * attempts to mirror the text the given keystroke would have if displayed in
 * a system menu.
 *
 * @param keystroke A String keystroke to humanize such as `ctrl-O`.
 * @param platform An optional String platform to humanize for (default: `process.platform`).
 * @return a humanized representation of the keystroke.
 */


function humanizeKeystroke(keystroke, platform_) {
  let platform = platform_;

  if (!keystroke) {
    return keystroke;
  } // flowlint-next-line sketchy-null-string:off


  platform = platform || process.platform;
  const separator = platform === 'darwin' ? '' : '+';
  let key;
  let keys;
  let splitKeystroke;
  const keystrokes = keystroke.split(' ');
  const humanizedKeystrokes = [];

  for (let i = 0; i < keystrokes.length; i++) {
    const currentKeystroke = keystrokes[i];
    splitKeystroke = currentKeystroke.split('-');
    keys = [];

    for (let index = 0; index < splitKeystroke.length; index++) {
      key = splitKeystroke[index];

      if (key === '' && splitKeystroke[index - 1] === '') {
        key = '-';
      }

      if (key) {
        keys.push(humanizeKey(key, platform));
      }
    }

    keys = Array.from(new Set(flatten(keys)));
    humanizedKeystrokes.push(keys.join(separator));
  }

  return humanizedKeystrokes.join(' ');
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL251Y2xpZGUvbnVjbGlkZS1jb21tb25zL2h1bWFuaXplS2V5c3Ryb2tlLmpzIl0sIm5hbWVzIjpbIk1BQ19NT0RJRklFUl9LRVlNQVAiLCJhbHQiLCJjbWQiLCJjdHJsIiwiZG93biIsImVudGVyIiwibGVmdCIsIm9wdGlvbiIsInJpZ2h0Iiwic2hpZnQiLCJ1cCIsIk5PTl9NQUNfTU9ESUZJRVJfS0VZTUFQIiwiU0hJRlRfS0VZTUFQIiwiXyIsIkZOX0tFWV9SRSIsImZsYXR0ZW4iLCJhcnIiLCJmbGF0dGVuZWQiLCJlbCIsIkFycmF5IiwiaXNBcnJheSIsImNvbmNhdCIsInB1c2giLCJjYXBpdGFsaXplIiwid29yZCIsImZpcnN0IiwicmVzdCIsInNsaWNlIiwidG9VcHBlckNhc2UiLCJodW1hbml6ZUtleSIsImtleSIsInBsYXRmb3JtIiwibW9kaWZpZXJLZXlNYXAiLCJsZW5ndGgiLCJ1cHBlcmNhc2UiLCJ0b0xvd2VyQ2FzZSIsInRlc3QiLCJodW1hbml6ZUtleXN0cm9rZSIsImtleXN0cm9rZSIsInBsYXRmb3JtXyIsInByb2Nlc3MiLCJzZXBhcmF0b3IiLCJrZXlzIiwic3BsaXRLZXlzdHJva2UiLCJrZXlzdHJva2VzIiwic3BsaXQiLCJodW1hbml6ZWRLZXlzdHJva2VzIiwiaSIsImN1cnJlbnRLZXlzdHJva2UiLCJpbmRleCIsImZyb20iLCJTZXQiLCJqb2luIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7Ozs7Ozs7Ozs7OztBQVlBOzs7QUFJQSxNQUFNQSxtQkFBbUIsR0FBRztBQUMxQkMsRUFBQUEsR0FBRyxFQUFFLFFBRHFCO0FBRTFCQyxFQUFBQSxHQUFHLEVBQUUsUUFGcUI7QUFHMUJDLEVBQUFBLElBQUksRUFBRSxRQUhvQjtBQUkxQkMsRUFBQUEsSUFBSSxFQUFFLFFBSm9CO0FBSzFCQyxFQUFBQSxLQUFLLEVBQUUsUUFMbUI7QUFNMUJDLEVBQUFBLElBQUksRUFBRSxRQU5vQjtBQU8xQkMsRUFBQUEsTUFBTSxFQUFFLFFB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QUFELENBQXBCOztBQUNBLFVBQUluQixHQUFHLEtBQUssRUFBUixJQUFjYSxjQUFjLENBQUNNLEtBQUssR0FBRyxDQUFULENBQWQsS0FBOEIsRUFBaEQsRUFBb0Q7QUFDbERuQixRQUFBQSxHQUFHLEdBQUcsR0FBTjtBQUNEOztBQUNELFVBQUlBLEdBQUosRUFBUztBQUNQWSxRQUFBQSxJQUFJLENBQUNwQixJQUFMLENBQVVPLFdBQVcsQ0FBQ0MsR0FBRCxFQUFNQyxRQUFOLENBQXJCO0FBQ0Q7QUFDRjs7QUFDRFcsSUFBQUEsSUFBSSxHQUFHdkIsS0FBSyxDQUFDK0IsSUFBTixDQUFXLElBQUlDLEdBQUosQ0FBUXBDLE9BQU8sQ0FBQzJCLElBQUQsQ0FBZixDQUFYLENBQVA7QUFDQUksSUFBQUEsbUJBQW1CLENBQUN4QixJQUFwQixDQUF5Qm9CLElBQUksQ0FBQ1UsSUFBTCxDQUFVWCxTQUFWLENBQXpCO0FBQ0Q7O0FBQ0QsU0FBT0ssbUJBQW1CLENBQUNNLElBQXBCLENBQXlCLEdBQXpCLENBQVA7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTctcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cclxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuICpcclxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgQlNELXN0eWxlIGxpY2Vuc2UgZm91bmQgaW4gdGhlXHJcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4gQW4gYWRkaXRpb25hbCBncmFudFxyXG4gKiBvZiBwYXRlbnQgcmlnaHRzIGNhbiBiZSBmb3VuZCBpbiB0aGUgUEFURU5UUyBmaWxlIGluIHRoZSBzYW1lIGRpcmVjdG9yeS5cclxuICpcclxuICogQGZsb3cgc3RyaWN0XHJcbiAqIEBmb3JtYXRcclxuICovXHJcblxyXG4vKlxyXG4gKiBhZGFwdGVkIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL2F0b20vdW5kZXJzY29yZS1wbHVzL2Jsb2IvbWFzdGVyL3NyYy91bmRlcnNjb3JlLXBsdXMuY29mZmVlXHJcbiAqL1xyXG5cclxuY29uc3QgTUFDX01PRElGSUVSX0tFWU1BUCA9IHtcclxuICBhbHQ6ICdcXHUyMzI1JyxcclxuICBjbWQ6ICdcXHUyMzE4JyxcclxuICBjdHJsOiAnXFx1MjMwMycsXHJcbiAgZG93bjogJ1xcdTIxOTMnLFxyXG4gIGVudGVyOiAnXFx1MjNjZScsXHJcbiAgbGVmdDogJ1xcdTIxOTAnLFxyXG4gIG9wdGlvbjogJ1xcdTIzMjUnLFxyXG4gIHJpZ2h0OiAnXFx1MjE5MicsXHJcbiAgc2hpZnQ6ICdcXHUyMWU3JyxcclxuICB1cDogJ1xcdTIxOTEnLFxyXG59O1xyXG5cclxuY29uc3QgTk9OX01BQ19NT0RJRklFUl9LRVlNQVAgPSB7XHJcbiAgYWx0OiAnQWx0JyxcclxuICBjbWQ6ICdDbWQnLFxyXG4gIGN0cmw6ICdDdHJsJyxcclxuICBkb3duOiAnRG93bicsXHJcbiAgZW50ZXI6ICdFbnRlcicsXHJcbiAgbGVmdDogJ0xlZnQnLFxyXG4gIG9wdGlvbjogJ0FsdCcsXHJcbiAgcmlnaHQ6ICdSaWdodCcsXHJcbiAgc2hpZnQ6ICdTaGlmdCcsXHJcbiAgdXA6ICdVcCcsXHJcbn07XHJcblxyXG4vLyBIdW1hbiBrZXkgY29tYm9zIHNob3VsZCBhbHdheXMgZXhwbGljaXRseSBzdGF0ZSB0aGUgc2hpZnQga2V5LiBUaGlzIG1hcCBpcyBhIGRpc2FtYmlndWF0b3IuXHJcbi8vICdzaGlmdC12ZXJzaW9uJzogJ25vLXNoaWZ0LXZlcnNpb24nXHJcbmNvbnN0IFNISUZUX0tFWU1BUCA9IHtcclxuICBfOiAnLScsXHJcbiAgJzonOiAnOycsXHJcbiAgJz8nOiAnLycsXHJcbiAgJ1wiJzogXCInXCIsXHJcbiAgJ3snOiAnWycsXHJcbiAgJ30nOiAnXScsXHJcbiAgJysnOiAnPScsXHJcbiAgJzwnOiAnLCcsXHJcbiAgJz4nOiAnLicsXHJcbiAgJ3wnOiAnXFxcXCcsXHJcbiAgJ34nOiAnYCcsXHJcbn07XHJcblxyXG5jb25zdCBGTl9LRVlfUkUgPSAvZlswLTldezEsMn0vO1xyXG5cclxuLy8gJEZsb3dJc3N1ZVxyXG5mdW5jdGlvbiBmbGF0dGVuPFQ+KGFycjogQXJyYXk8VCB8IEFycmF5PFQ+Pik6IEFycmF5PFQ+IHtcclxuICBsZXQgZmxhdHRlbmVkID0gW107XHJcbiAgZm9yIChjb25zdCBlbCBvZiBhcnIpIHtcclxuICAgIGlmIChBcnJheS5pc0FycmF5KGVsKSkge1xyXG4gICAgICBmbGF0dGVuZWQgPSBmbGF0dGVuZWQuY29uY2F0KGZsYXR0ZW4oZWwpKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGZsYXR0ZW5lZC5wdXNoKGVsKTtcclxuICAgIH1cclxuICB9XHJcbiAgcmV0dXJuIGZsYXR0ZW5lZDtcclxufVxyXG5cclxuZnVuY3Rpb24gY2FwaXRhbGl6ZSh3b3JkOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gIGNvbnN0IGZpcnN0ID0gd29yZFswXSB8fCAnJztcclxuICBjb25zdCByZXN0ID0gd29yZC5zbGljZSgxKTtcclxuICByZXR1cm4gZmlyc3QudG9VcHBlckNhc2UoKSArIHJlc3Q7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGh1bWFuaXplS2V5KGtleTogc3RyaW5nLCBwbGF0Zm9ybTogP3N0cmluZyk6IHN0cmluZyB8IEFycmF5PHN0cmluZz4ge1xyXG4gIGlmICgha2V5KSB7XHJcbiAgICByZXR1cm4ga2V5O1xyXG4gIH1cclxuICBjb25zdCBtb2RpZmllcktleU1hcCA9XHJcbiAgICBwbGF0Zm9ybSA9PT0gJ2RhcndpbicgPyBNQUNfTU9ESUZJRVJfS0VZTUFQIDogTk9OX01BQ19NT0RJRklFUl9LRVlNQVA7XHJcbiAgaWYgKG1vZGlmaWVyS2V5TWFwW2tleV0pIHtcclxuICAgIHJldHVybiBtb2RpZmllcktleU1hcFtrZXldO1xyXG4gIH1cclxuICBpZiAoa2V5Lmxlbmd0aCA9PT0gMSkge1xyXG4gICAgaWYgKFNISUZUX0tFWU1BUFtrZXldKSB7XHJcbiAgICAgIHJldHVybiBbbW9kaWZpZXJLZXlNYXAuc2hpZnQsIFNISUZUX0tFWU1BUFtrZXldXTtcclxuICAgIH1cclxuICAgIGNvbnN0IHVwcGVyY2FzZSA9IGtleS50b1VwcGVyQ2FzZSgpO1xyXG4gICAgaWYgKGtleSA9PT0gdXBwZXJjYXNlICYmIHVwcGVyY2FzZSAhPT0ga2V5LnRvTG93ZXJDYXNlKCkpIHtcclxuICAgICAgcmV0dXJuIFttb2RpZmllcktleU1hcC5zaGlmdCwgdXBwZXJjYXNlXTtcclxuICAgIH1cclxuICAgIHJldHVybiB1cHBlcmNhc2U7XHJcbiAgfVxyXG4gIGlmIChGTl9LRVlfUkUudGVzdChrZXkpKSB7XHJcbiAgICByZXR1cm4ga2V5LnRvVXBwZXJDYXNlKCk7XHJcbiAgfVxyXG4gIHJldHVybiBwbGF0Zm9ybSA9PT0gJ2RhcndpbicgPyBrZXkgOiBjYXBpdGFsaXplKGtleSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBIdW1hbml6ZSB0aGUga2V5c3Ryb2tlIGFjY29yZGluZyB0byBwbGF0Zm9ybSBjb252ZW50aW9ucy4gVGhpcyBtZXRob2RcclxuICogYXR0ZW1wdHMgdG8gbWlycm9yIHRoZSB0ZXh0IHRoZSBnaXZlbiBrZXlzdHJva2Ugd291bGQgaGF2ZSBpZiBkaXNwbGF5ZWQgaW5cclxuICogYSBzeXN0ZW0gbWVudS5cclxuICpcclxuICogQHBhcmFtIGtleXN0cm9rZSBBIFN0cmluZyBrZXlzdHJva2UgdG8gaHVtYW5pemUgc3VjaCBhcyBgY3RybC1PYC5cclxuICogQHBhcmFtIHBsYXRmb3JtIEFuIG9wdGlvbmFsIFN0cmluZyBwbGF0Zm9ybSB0byBodW1hbml6ZSBmb3IgKGRlZmF1bHQ6IGBwcm9jZXNzLnBsYXRmb3JtYCkuXHJcbiAqIEByZXR1cm4gYSBodW1hbml6ZWQgcmVwcmVzZW50YXRpb24gb2YgdGhlIGtleXN0cm9rZS5cclxuICovXHJcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGh1bWFuaXplS2V5c3Ryb2tlKFxyXG4gIGtleXN0cm9rZTogc3RyaW5nLFxyXG4gIHBsYXRmb3JtXzogP3N0cmluZyxcclxuKTogc3RyaW5nIHtcclxuICBsZXQgcGxhdGZvcm0gPSBwbGF0Zm9ybV87XHJcbiAgaWYgKCFrZXlzdHJva2UpIHtcclxuICAgIHJldHVybiBrZXlzdHJva2U7XHJcbiAgfVxyXG4gIC8vIGZsb3dsaW50LW5leHQtbGluZSBza2V0Y2h5LW51bGwtc3RyaW5nOm9mZlxyXG4gIHBsYXRmb3JtID0gcGxhdGZvcm0gfHwgcHJvY2Vzcy5wbGF0Zm9ybTtcclxuICBjb25zdCBzZXBhcmF0b3IgPSBwbGF0Zm9ybSA9PT0gJ2RhcndpbicgPyAnJyA6ICcrJztcclxuICBsZXQga2V5O1xyXG4gIGxldCBrZXlzO1xyXG4gIGxldCBzcGxpdEtleXN0cm9rZTtcclxuICBjb25zdCBrZXlzdHJva2VzID0ga2V5c3Ryb2tlLnNwbGl0KCcgJyk7XHJcbiAgY29uc3QgaHVtYW5pemVkS2V5c3Ryb2tlcyA9IFtdO1xyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwga2V5c3Ryb2tlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgY29uc3QgY3VycmVudEtleXN0cm9rZSA9IGtleXN0cm9rZXNbaV07XHJcbiAgICBzcGxpdEtleXN0cm9rZSA9IGN1cnJlbnRLZXlzdHJva2Uuc3BsaXQoJy0nKTtcclxuICAgIGtleXMgPSBbXTtcclxuICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBzcGxpdEtleXN0cm9rZS5sZW5ndGg7IGluZGV4KyspIHtcclxuICAgICAga2V5ID0gc3BsaXRLZXlzdHJva2VbaW5kZXhdO1xyXG4gICAgICBpZiAoa2V5ID09PSAnJyAmJiBzcGxpdEtleXN0cm9rZVtpbmRleCAtIDFdID09PSAnJykge1xyXG4gICAgICAgIGtleSA9ICctJztcclxuICAgICAgfVxyXG4gICAgICBpZiAoa2V5KSB7XHJcbiAgICAgICAga2V5cy5wdXNoKGh1bWFuaXplS2V5KGtleSwgcGxhdGZvcm0pKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAga2V5cyA9IEFycmF5LmZyb20obmV3IFNldChmbGF0dGVuKGtleXMpKSk7XHJcbiAgICBodW1hbml6ZWRLZXlzdHJva2VzLnB1c2goa2V5cy5qb2luKHNlcGFyYXRvcikpO1xyXG4gIH1cclxuICByZXR1cm4gaHVtYW5pemVkS2V5c3Ryb2tlcy5qb2luKCcgJyk7XHJcbn1cclxuIl19