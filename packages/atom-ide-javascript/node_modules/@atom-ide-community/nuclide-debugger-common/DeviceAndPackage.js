"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.DeviceAndPackage = void 0;

var _nuclideAdb = require("@atom-ide-community/nuclide-adb");

var _Dropdown = require("@atom-ide-community/nuclide-commons-ui/Dropdown");

var _LoadingSpinner = require("@atom-ide-community/nuclide-commons-ui/LoadingSpinner");

var _expected = require("@atom-ide-community/nuclide-commons/expected");

var React = _interopRequireWildcard(require("react"));

var _AdbDeviceSelector = require("./AdbDeviceSelector");

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */
class DeviceAndPackage extends React.Component {
  constructor(props) {
    super(props);

    this._handleDeviceChange = device => {
      const state = {
        selectedDeviceSerial: device === null || device === void 0 ? void 0 : device.serial,
        packages: device == null ? _expected.Expect.value([]) : _expected.Expect.pending()
      };
      const value = this.props.deserialize();

      if (device != null && (this.state.selectedDeviceSerial == null || device.serial !== this.state.selectedDeviceSerial) && value != null) {
        state.launchPackage = value;
      }

      this.setState(state, () => {
        this._refreshPackageList(device);
      });
    };

    this.state = {
      selectedDeviceSerial: null,
      launchPackage: '',
      packages: _expected.Expect.value([])
    };
  }

  async _refreshPackageList(device) {
    if (device != null) {
      const packages = _expected.Expect.value((await (0, _nuclideAdb.getAdbServiceByNuclideUri)(this.props.targetUri).getInstalledPackages(device.serial)).sort());

      this.setState({
        packages
      });
    } else {
      this.setState({
        packages: _expected.Expect.value([])
      });
    }
  }

  setState(partialState, callback) {
    const fullState = { ...this.state,
      ...partialState
    };
    super.setState(fullState, () => {
      this.props.onSelect(fullState.selectedDeviceSerial, fullState.launchPackage);
      callback && callback();
    });
  }

  render() {
    return /*#__PURE__*/React.createElement("div", {
      className: "block"
    }, /*#__PURE__*/React.createElement("label", null, "Device:"), /*#__PURE__*/React.createElement(_AdbDeviceSelector.AdbDeviceSelector, {
      onChange: this._handleDeviceChange,
      targetUri: this.props.targetUri
    }), /*#__PURE__*/React.createElement("label", null, "Package: "), this.state.packages.isPending ? /*#__PURE__*/React.createElement(_LoadingSpinner.LoadingSpinner, {
      size: "EXTRA_SMALL"
    }) : /*#__PURE__*/React.createElement(_Dropdown.Dropdown, {
      disabled: this.state.selectedDeviceSerial == null,
      options: this.state.packages.getOrDefault([]).map(packageName => {
        return {
          value: packageName,
          label: packageName
        };
      }),
      onChange: value => this.setState({
        launchPackage: value
      }),
      value: this.state.launchPackage
    }));
  }

}

exports.DeviceAndPackage = DeviceAndPackage;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL251Y2xpZGUvbnVjbGlkZS1kZWJ1Z2dlci1jb21tb24vRGV2aWNlQW5kUGFja2FnZS5qcyJdLCJuYW1lcyI6WyJEZXZpY2VBbmRQYWNrYWdlIiwiUmVhY3QiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiX2hhbmRsZURldmljZUNoYW5nZSIsImRldmljZSIsInN0YXRlIiwic2VsZWN0ZWREZXZpY2VTZXJpYWwiLCJzZXJpYWwiLCJwYWNrYWdlcyIsIkV4cGVjdCIsInZhbHVlIiwicGVuZGluZyIsImRlc2VyaWFsaXplIiwibGF1bmNoUGFja2FnZSIsInNldFN0YXRlIiwiX3JlZnJlc2hQYWNrYWdlTGlzdCIsInRhcmdldFVyaSIsImdldEluc3RhbGxlZFBhY2thZ2VzIiwic29ydCIsInBhcnRpYWxTdGF0ZSIsImNhbGxiYWNrIiwiZnVsbFN0YXRlIiwib25TZWxlY3QiLCJyZW5kZXIiLCJpc1BlbmRpbmciLCJnZXRPckRlZmF1bHQiLCJtYXAiLCJwYWNrYWdlTmFtZSIsImxhYmVsIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBZ0JBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7QUFyQkE7Ozs7Ozs7Ozs7O0FBbUNPLE1BQU1BLGdCQUFOLFNBQStCQyxLQUFLLENBQUNDLFNBQXJDLENBQTZEO0FBQ2xFQyxFQUFBQSxXQUFXLENBQUNDLEtBQUQsRUFBZTtBQUN4QixVQUFNQSxLQUFOOztBQUR3QixTQXdDMUJDLG1CQXhDMEIsR0F3Q0hDLE1BQUQsSUFBOEI7QUFDbEQsWUFBTUMsS0FBb0IsR0FBRztBQUMzQkMsUUFBQUEsb0JBQW9CLEVBQUVGLE1BQUYsYUFBRUEsTUFBRix1QkFBRUEsTUFBTSxDQUFFRyxNQURIO0FBRTNCQyxRQUFBQSxRQUFRLEVBQUVKLE1BQU0sSUFBSSxJQUFWLEdBQWlCSyxpQkFBT0MsS0FBUCxDQUFhLEVBQWIsQ0FBakIsR0FBb0NELGlCQUFPRSxPQUFQO0FBRm5CLE9BQTdCO0FBSUEsWUFB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c0NvbnRlbnQiOlsiLyoqXHJcbiAqIENvcHlyaWdodCAoYykgMjAxNy1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxyXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4gKlxyXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBCU0Qtc3R5bGUgbGljZW5zZSBmb3VuZCBpbiB0aGVcclxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLiBBbiBhZGRpdGlvbmFsIGdyYW50XHJcbiAqIG9mIHBhdGVudCByaWdodHMgY2FuIGJlIGZvdW5kIGluIHRoZSBQQVRFTlRTIGZpbGUgaW4gdGhlIHNhbWUgZGlyZWN0b3J5LlxyXG4gKlxyXG4gKiBAZmxvd1xyXG4gKiBAZm9ybWF0XHJcbiAqL1xyXG5cclxuaW1wb3J0IHR5cGUge0FkYkRldmljZX0gZnJvbSAnQGF0b20taWRlLWNvbW11bml0eS9udWNsaWRlLWFkYi9saWIvdHlwZXMnO1xyXG5pbXBvcnQgdHlwZSB7RXhwZWN0ZWR9IGZyb20gJ0BhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zL2V4cGVjdGVkJztcclxuaW1wb3J0IHR5cGUge051Y2xpZGVVcml9IGZyb20gJ0BhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zL251Y2xpZGVVcmknO1xyXG5cclxuaW1wb3J0IHtnZXRBZGJTZXJ2aWNlQnlOdWNsaWRlVXJpfSBmcm9tICdAYXRvbS1pZGUtY29tbXVuaXR5L251Y2xpZGUtYWRiJztcclxuaW1wb3J0IHtEcm9wZG93bn0gZnJvbSAnQGF0b20taWRlLWNvbW11bml0eS9udWNsaWRlLWNvbW1vbnMtdWkvRHJvcGRvd24nO1xyXG5pbXBvcnQge0xvYWRpbmdTcGlubmVyfSBmcm9tICdAYXRvbS1pZGUtY29tbXVuaXR5L251Y2xpZGUtY29tbW9ucy11aS9Mb2FkaW5nU3Bpbm5lcic7XHJcbmltcG9ydCB7RXhwZWN0fSBmcm9tICdAYXRvbS1pZGUtY29tbXVuaXR5L251Y2xpZGUtY29tbW9ucy9leHBlY3RlZCc7XHJcbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0IHtBZGJEZXZpY2VTZWxlY3Rvcn0gZnJvbSAnLi9BZGJEZXZpY2VTZWxlY3Rvcic7XHJcblxyXG50eXBlIFByb3BzID0ge3xcclxuICArdGFyZ2V0VXJpOiBOdWNsaWRlVXJpLFxyXG4gICtvblNlbGVjdDogKGRldmljZVNlcmlhbDogP3N0cmluZywgamF2YVBhY2thZ2U6IHN0cmluZykgPT4gdm9pZCxcclxuICArZGVzZXJpYWxpemU6ICgpID0+ID9zdHJpbmcsXHJcbnx9O1xyXG5cclxudHlwZSBTdGF0ZSA9IHtcclxuICBzZWxlY3RlZERldmljZVNlcmlhbDogP3N0cmluZyxcclxuICBsYXVuY2hQYWNrYWdlOiBzdHJpbmcsXHJcbiAgcGFja2FnZXM6IEV4cGVjdGVkPEFycmF5PHN0cmluZz4+LFxyXG59O1xyXG5cclxuZXhwb3J0IGNsYXNzIERldmljZUFuZFBhY2thZ2UgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8UHJvcHMsIFN0YXRlPiB7XHJcbiAgY29uc3RydWN0b3IocHJvcHM6IFByb3BzKSB7XHJcbiAgICBzdXBlcihwcm9wcyk7XHJcbiAgICB0aGlzLnN0YXRlID0ge1xyXG4gICAgICBzZWxlY3RlZERldmljZVNlcmlhbDogbnVsbCxcclxuICAgICAgbGF1bmNoUGFja2FnZTogJycsXHJcbiAgICAgIHBhY2thZ2VzOiBFeHBlY3QudmFsdWUoW10pLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGFzeW5jIF9yZWZyZXNoUGFja2FnZUxpc3QoZGV2aWNlOiA/QWRiRGV2aWNlKSB7XHJcbiAgICBpZiAoZGV2aWNlICE9IG51bGwpIHtcclxuICAgICAgY29uc3QgcGFja2FnZXMgPSBFeHBlY3QudmFsdWUoXHJcbiAgICAgICAgKGF3YWl0IGdldEFkYlNlcnZpY2VCeU51Y2xpZGVVcmkoXHJcbiAgICAgICAgICB0aGlzLnByb3BzLnRhcmdldFVyaSxcclxuICAgICAgICApLmdldEluc3RhbGxlZFBhY2thZ2VzKGRldmljZS5zZXJpYWwpKS5zb3J0KCksXHJcbiAgICAgICk7XHJcbiAgICAgIHRoaXMuc2V0U3RhdGUoe1xyXG4gICAgICAgIHBhY2thZ2VzLFxyXG4gICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuc2V0U3RhdGUoe1xyXG4gICAgICAgIHBhY2thZ2VzOiBFeHBlY3QudmFsdWUoW10pLFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNldFN0YXRlKHBhcnRpYWxTdGF0ZTogT2JqZWN0LCBjYWxsYmFjaz86ICgpID0+IG1peGVkKTogdm9pZCB7XHJcbiAgICBjb25zdCBmdWxsU3RhdGU6IFN0YXRlID0ge1xyXG4gICAgICAuLi50aGlzLnN0YXRlLFxyXG4gICAgICAuLi5wYXJ0aWFsU3RhdGUsXHJcbiAgICB9O1xyXG4gICAgc3VwZXIuc2V0U3RhdGUoZnVsbFN0YXRlLCAoKSA9PiB7XHJcbiAgICAgIHRoaXMucHJvcHMub25TZWxlY3QoXHJcbiAgICAgICAgZnVsbFN0YXRlLnNlbGVjdGVkRGV2aWNlU2VyaWFsLFxyXG4gICAgICAgIGZ1bGxTdGF0ZS5sYXVuY2hQYWNrYWdlLFxyXG4gICAgICApO1xyXG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjaygpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBfaGFuZGxlRGV2aWNlQ2hhbmdlID0gKGRldmljZTogP0FkYkRldmljZSk6IHZvaWQgPT4ge1xyXG4gICAgY29uc3Qgc3RhdGU6ICRTaGFwZTxTdGF0ZT4gPSB7XHJcbiAgICAgIHNlbGVjdGVkRGV2aWNlU2VyaWFsOiBkZXZpY2U/LnNlcmlhbCxcclxuICAgICAgcGFja2FnZXM6IGRldmljZSA9PSBudWxsID8gRXhwZWN0LnZhbHVlKFtdKSA6IEV4cGVjdC5wZW5kaW5nKCksXHJcbiAgICB9O1xyXG4gICAgY29uc3QgdmFsdWUgPSB0aGlzLnByb3BzLmRlc2VyaWFsaXplKCk7XHJcbiAgICBpZiAoXHJcbiAgICAgIGRldmljZSAhPSBudWxsICYmXHJcbiAgICAgICh0aGlzLnN0YXRlLnNlbGVjdGVkRGV2aWNlU2VyaWFsID09IG51bGwgfHxcclxuICAgICAgICBkZXZpY2Uuc2VyaWFsICE9PSB0aGlzLnN0YXRlLnNlbGVjdGVkRGV2aWNlU2VyaWFsKSAmJlxyXG4gICAgICB2YWx1ZSAhPSBudWxsXHJcbiAgICApIHtcclxuICAgICAgc3RhdGUubGF1bmNoUGFja2FnZSA9IHZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuc2V0U3RhdGUoc3RhdGUsICgpID0+IHtcclxuICAgICAgdGhpcy5fcmVmcmVzaFBhY2thZ2VMaXN0KGRldmljZSk7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICByZW5kZXIoKTogUmVhY3QuTm9kZSB7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cImJsb2NrXCI+XHJcbiAgICAgICAgPGxhYmVsPkRldmljZTo8L2xhYmVsPlxyXG4gICAgICAgIDxBZGJEZXZpY2VTZWxlY3RvclxyXG4gICAgICAgICAgb25DaGFuZ2U9e3RoaXMuX2hhbmRsZURldmljZUNoYW5nZX1cclxuICAgICAgICAgIHRhcmdldFVyaT17dGhpcy5wcm9wcy50YXJnZXRVcml9XHJcbiAgICAgICAgLz5cclxuICAgICAgICA8bGFiZWw+UGFja2FnZTogPC9sYWJlbD5cclxuICAgICAgICB7dGhpcy5zdGF0ZS5wYWNrYWdlcy5pc1BlbmRpbmcgPyAoXHJcbiAgICAgICAgICA8TG9hZGluZ1NwaW5uZXIgc2l6ZT1cIkVYVFJBX1NNQUxMXCIgLz5cclxuICAgICAgICApIDogKFxyXG4gICAgICAgICAgPERyb3Bkb3duXHJcbiAgICAgICAgICAgIGRpc2FibGVkPXt0aGlzLnN0YXRlLnNlbGVjdGVkRGV2aWNlU2VyaWFsID09IG51bGx9XHJcbiAgICAgICAgICAgIG9wdGlvbnM9e3RoaXMuc3RhdGUucGFja2FnZXMuZ2V0T3JEZWZhdWx0KFtdKS5tYXAocGFja2FnZU5hbWUgPT4ge1xyXG4gICAgICAgICAgICAgIHJldHVybiB7dmFsdWU6IHBhY2thZ2VOYW1lLCBsYWJlbDogcGFja2FnZU5hbWV9O1xyXG4gICAgICAgICAgICB9KX1cclxuICAgICAgICAgICAgb25DaGFuZ2U9e3ZhbHVlID0+IHRoaXMuc2V0U3RhdGUoe2xhdW5jaFBhY2thZ2U6IHZhbHVlfSl9XHJcbiAgICAgICAgICAgIHZhbHVlPXt0aGlzLnN0YXRlLmxhdW5jaFBhY2thZ2V9XHJcbiAgICAgICAgICAvPlxyXG4gICAgICAgICl9XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgKTtcclxuICB9XHJcbn1cclxuIl19