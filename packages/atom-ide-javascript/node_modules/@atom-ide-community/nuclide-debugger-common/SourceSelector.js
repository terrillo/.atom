"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.SourceSelector = void 0;

var _idx = _interopRequireDefault(require("idx"));

var _Dropdown = require("@atom-ide-community/nuclide-commons-ui/Dropdown");

var _nuclideUri = _interopRequireDefault(require("@atom-ide-community/nuclide-commons/nuclideUri"));

var _UniversalDisposable = _interopRequireDefault(require("@atom-ide-community/nuclide-commons/UniversalDisposable"));

var React = _interopRequireWildcard(require("react"));

var _utils = require("./utils");

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */
class SourceSelector extends React.Component {
  constructor(props) {
    super(props);
    this._disposables = void 0;

    this._sourceToOption = source => {
      const label = this._getLabelFromSource(source);

      return {
        value: source,
        label,
        selectedLabel: label
      };
    };

    this._disposables = new _UniversalDisposable.default();
    this.state = {
      selectableSources: [],
      selectedSource: null
    };
  }

  _getNewlySelectedSource(selectedSource, projectPaths, deserializedProjectPath) {
    let newSelectedSource = null;

    if (selectedSource != null) {
      newSelectedSource = projectPaths.includes(selectedSource) ? selectedSource : null;
    }

    if (newSelectedSource == null && projectPaths.length > 0) {
      const matches = projectPaths.filter(projectPath => projectPath.projectPath === deserializedProjectPath);
      newSelectedSource = matches.length > 0 ? matches[0] : projectPaths[0];
    }

    return newSelectedSource;
  }

  componentDidMount() {
    this._disposables.add((0, _utils.observeProjectPathsAllFromSourcePathsService)(projectPaths => {
      const newSelectedSource = this._getNewlySelectedSource( // TODO: (wbinnssmith) T30771435 this setState depends on current state
      // and should use an updater function rather than an object
      // eslint-disable-next-line react/no-access-state-in-setstate
      this.state.selectedSource, projectPaths, this.props.deserialize());

      this.setState({
        selectableSources: projectPaths,
        selectedSource: newSelectedSource
      });
    }));
  }

  componentWillUnmount() {
    this._disposables.dispose();
  }

  _getLabelFromSource(source) {
    const {
      projectPath,
      hostLabel
    } = source;

    const basename = _nuclideUri.default.basename(projectPath);

    return hostLabel + ' - ' + basename;
  }

  setState(partialState, callback) {
    const fullState = { ...this.state,
      ...partialState
    };
    super.setState(fullState, () => {
      this.props.onSelect((0, _idx.default)(fullState, _ => _.selectedSource.projectPath));
      callback && callback();
    });
  }

  render() {
    const {
      selectableSources,
      selectedSource
    } = this.state;
    const options = selectableSources.map(this._sourceToOption);

    if (options.length === 0) {
      return /*#__PURE__*/React.createElement("div", null, "No Projects Found. Please add a project to your file tree so the debugger can find sources.");
    }

    const potentiallyWrongSourceLabel = selectedSource != null && !selectedSource.suggested ? /*#__PURE__*/React.createElement("label", null, "Nuclide is not sure that you have selected a project which contains sources the debugger can use. Please double check that your selected source is correct.") : null;
    return /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement(_Dropdown.Dropdown, {
      options: options,
      onChange: option => this.setState({
        selectedSource: option
      }),
      placeholder: 'Select a source',
      value: selectedSource
    }), potentiallyWrongSourceLabel);
  }

}

exports.SourceSelector = SourceSelector;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL251Y2xpZGUvbnVjbGlkZS1kZWJ1Z2dlci1jb21tb24vU291cmNlU2VsZWN0b3IuanMiXSwibmFtZXMiOlsiU291cmNlU2VsZWN0b3IiLCJSZWFjdCIsIkNvbXBvbmVudCIsImNvbnN0cnVjdG9yIiwicHJvcHMiLCJfZGlzcG9zYWJsZXMiLCJfc291cmNlVG9PcHRpb24iLCJzb3VyY2UiLCJsYWJlbCIsIl9nZXRMYWJlbEZyb21Tb3VyY2UiLCJ2YWx1ZSIsInNlbGVjdGVkTGFiZWwiLCJVbml2ZXJzYWxEaXNwb3NhYmxlIiwic3RhdGUiLCJzZWxlY3RhYmxlU291cmNlcyIsInNlbGVjdGVkU291cmNlIiwiX2dldE5ld2x5U2VsZWN0ZWRTb3VyY2UiLCJwcm9qZWN0UGF0aHMiLCJkZXNlcmlhbGl6ZWRQcm9qZWN0UGF0aCIsIm5ld1NlbGVjdGVkU291cmNlIiwiaW5jbHVkZXMiLCJsZW5ndGgiLCJtYXRjaGVzIiwiZmlsdGVyIiwicHJvamVjdFBhdGgiLCJjb21wb25lbnREaWRNb3VudCIsImFkZCIsImRlc2VyaWFsaXplIiwic2V0U3RhdGUiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsImRpc3Bvc2UiLCJob3N0TGFiZWwiLCJiYXNlbmFtZSIsIm51Y2xpZGVVcmkiLCJwYXJ0aWFsU3RhdGUiLCJjYWxsYmFjayIsImZ1bGxTdGF0ZSIsIm9uU2VsZWN0IiwiXyIsInJlbmRlciIsIm9wdGlvbnMiLCJtYXAiLCJwb3RlbnRpYWxseVdyb25nU291cmNlTGFiZWwiLCJzdWdnZXN0ZWQiLCJvcHRpb24iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFlQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7QUFwQkE7Ozs7Ozs7Ozs7O0FBZ0NPLE1BQU1BLGNBQU4sU0FBNkJDLEtBQUssQ0FBQ0MsU0FBbkMsQ0FBMkQ7QUFHaEVDLEVBQUFBLFdBQVcsQ0FBQ0MsS0FBRCxFQUFlO0FBQ3hCLFVBQU1BLEtBQU47QUFEd0IsU0FGMUJDLFlBRTBCOztBQUFBLFNBeUQxQkMsZUF6RDBCLEdBeURQQyxNQUFELElBQWtDO0FBQ2xELFlBQU1DLEtBQUssR0FBRyxLQUFLQyxtQkFBTCxDQUF5QkYsTUFBekIsQ0FBZDs7QUFDQSxhQUFPO0FBQ0xHLFFBQUFBLEtBQUssRUFBRUgsTUFERjtBQUVMQyxRQUFBQSxLQUZLO0FBR0xHLFFBQUFBLGFBQWEsRUFBRUg7QUFIVixPQUFQO0FBS0QsS0FoRXlCOztBQUV4QixTQUFLSCxZQUFMLEdBQW9CLElBQUlPLDRCQUFKLEVBQXBCO0FBQ0EsU0FBS0MsS0FBTCxHQUFhO0FBQUNDLE1BQUFBLGlCQUFpQixFQUFFLEVBQXBCO0FBQXdCQyxNQUFBQSxjQUFjLEVBQUU7QUFBeEMsS0FBYjtBQUNEOztBQUVEQyxFQUFBQSx1QkFBdUIsQ0FDckJELGNBRHFCLEVBRXJCRSxZQUZxQixFQUdyQkMsdUJBSHFCLEVBSUU7QUFDdkIsUUFBSUMsaUJBQWlCLEdBQUcsSUFBeEI7O0FBQ0EsUUFBSUosY0FBYyxJQUFJLElBQXRCLEVBQTRCO0FBQzFCSSxNQUFBQSxpQkFBaUIsR0FBR0YsWUFBWSxDQUFDRyxRQUFiLENBQXNCTCxjQUF0QixJQUNoQkEsY0FEZ0IsR0FFaEIsSUFGSjtBQUdEOztBQUNELFFBQUlJLGlCQUFpQixJQUFJLElBQXJCLElBQTZCRixZQUFZLENBQUNJLE1BQWIsR0FBc0IsQ0FBdkQsRUFBMEQ7QUFDeEQsWUFBTUMsT0FBTyxHQUFHTCxZQUFZLENBQUNNLE1BQWIsQ0FDZEMsV0FBVyxJQUFJQSxXQUFXLENBQUNBLFdBQVosS0FBNEJOLHVCQUQ3QixDQUFoQjtBQUdBQyxNQUFBQSxpQkFBaUIsR0FBR0csT0FBTyxDQUFDRCxNQUFSLEdBQWlCLENBQWpCLEdBQXFCQyxPQUFPLENBQUMsQ0FBRCxDQUE1QixHQUFrQ0wsWUFBWSxDQUFDLENBQUQsQ0FBbEU7QUFDRDs7QUFDRCxXQUFPRSxpQkFBUDtBQUNEOztBQUVETSxFQUFBQSxpQkFBaUIsR0FBRztBQUNsQixTQUFLcEIsWUFBTCxDQUFrQnFCLEdBQWxCLENBQ0UseURBQ0dULFlBQUQsSUFBK0M7QUFDN0MsWUFBTUUsaUJBQWlCLEdBQUcsS0FBS0gsdUJBQUwsRUFDeEI7QUFDQTtBQUNBO0FBQ0EsV0FBS0gsS0FBTCxDQUFXRSxjQUphLEVBS3hCRSxZQUx3QixFQU14QixLQUFLYixLQUFMLENBQVd1QixXQUFYLEVBTndCLENBQTFCOztBQVFBLFdBQUtDLFFBQUwsQ0FBYztBQUNaZCxRQUFBQSxpQkFBaUIsRUFBRUcsWUFEUDtBQUVaRixRQUFBQSxjQUFjLEVBQUVJO0FBRkosT0FBZDtBQUlELEtBZEgsQ0FERjtBQWtCRDs7QUFFRFUsRUFBQUEsb0JBQW9CLEdBQUc7QUFDckIsU0FBS3hCLFlBQUwsQ0FBa0J5QixPQUFsQjtBQUNEOztBQUVEckIsRUFBQUEsbUJBQW1CLENBQUNGLE1BQUQsRUFBK0I7QUFDaEQsVUFBTTtBQUFDaUIsTUFBQUEsV0FBRDtBQUFjTyxNQUFBQTtBQUFkLFFBQTJCeEIsTUFBakM7O0FBQ0EsVUFBTXlCLFFBQVEsR0FBR0Msb0JBQVdELFFBQVgsQ0FBb0JSLFdBQXBCLENBQWpCOztBQUNBLFdBQU9PLFNBQVMsR0FBRyxLQUFaLEdBQW9CQyxRQUEzQjtBQUNEOztBQVdESixFQUFBQSxRQUFRLENBQUNNLFlBQUQsRUFBdUJDLFFBQXZCLEVBQXFEO0FBQzNELFVBQU1DLFNBQWdCLEdBQUcsRUFDdkIsR0FBRyxLQUFLdkIsS0FEZTtBQUV2QixTQUFHcUI7QUFGb0IsS0FBekI7QUFJQSxVQUFNTixRQUFOLENBQWVRLFNBQWYsRUFBMEIsTUFBTTtBQUM5QixXQUFLaEMsS0FBTCxDQUFXaUMsUUFBWCxDQUFvQixrQkFBSUQsU0FBSixFQUFlRSxDQUFDLElBQUlBLENBQUMsQ0FBQ3ZCLGNBQUYsQ0FBaUJTLFdBQXJDLENBQXBCO0FBQ0FXLE1BQUFBLFFBQVEsSUFBSUEsUUFBUSxFQUFwQjtBQUNELEtBSEQ7QUFJRDs7QUFFREksRUFBQUEsTUFBTSxHQUFlO0FBQ25CLFVBQU07QUFBQ3pCLE1BQUFBLGlCQUFEO0FBQW9CQyxNQUFBQTtBQUFwQixRQUFzQyxLQUFLRixLQUFqRDtBQUNBLFVBQU0yQixPQUFPLEdBQUcxQixpQkFBaUIsQ0FBQzJCLEdBQWxCLENBQXNCLEtBQUtuQyxlQUEzQixDQUFoQjs7QUFDQSxRQUFJa0MsT0FBTyxDQUFDbkIsTUFBUixLQUFtQixDQUF2QixFQUEwQjtBQUN4QiwwQkFDRSwrSEFERjtBQU1EOztBQUNELFVBQU1xQiwyQkFBMkIsR0FDL0IzQixjQUFjLElBQUksSUFBbEIsSUFBMEIsQ0FBQ0EsY0FBYyxDQUFDNEIsU0FBMUMsZ0JBQ0UsaU1BREYsR0FNSSxJQVBOO0FBUUEsd0JBQ0UsOENBQ0Usb0JBQUMsa0JBQUQ7QUFDRSxNQUFBLE9BQU8sRUFBRUgsT0FEWDtBQUVFLE1BQUEsUUFBUSxFQUFFSSxNQUFNLElBQUksS0FBS2hCLFFBQUwsQ0FBYztBQUFDYixRQUFBQSxjQUFjLEVBQUU2QjtBQUFqQixPQUFkLENBRnRCO0FBR0UsTUFBQSxXQUFXLEVBQUUsaUJBSGY7QUFJRSxNQUFBLEtBQUssRUFBRTdCO0FBSlQsTUFERixFQU9HMkIsMkJBUEgsQ0FERjtBQVdEOztBQTlHK0QiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ29weXJpZ2h0IChjKSAyMDE3LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXHJcbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbiAqXHJcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIEJTRC1zdHlsZSBsaWNlbnNlIGZvdW5kIGluIHRoZVxyXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuIEFuIGFkZGl0aW9uYWwgZ3JhbnRcclxuICogb2YgcGF0ZW50IHJpZ2h0cyBjYW4gYmUgZm91bmQgaW4gdGhlIFBBVEVOVFMgZmlsZSBpbiB0aGUgc2FtZSBkaXJlY3RvcnkuXHJcbiAqXHJcbiAqIEBmbG93XHJcbiAqIEBmb3JtYXRcclxuICovXHJcblxyXG5pbXBvcnQgdHlwZSB7U3VnZ2VzdGVkUHJvamVjdFBhdGh9IGZyb20gJ2F0b20taWRlLWRlYnVnZ2VyLWphdmEvdHlwZXMnO1xyXG5pbXBvcnQgdHlwZSB7TnVjbGlkZVVyaX0gZnJvbSAnQGF0b20taWRlLWNvbW11bml0eS9udWNsaWRlLWNvbW1vbnMvbnVjbGlkZVVyaSc7XHJcblxyXG5pbXBvcnQgaWR4IGZyb20gJ2lkeCc7XHJcbmltcG9ydCB7RHJvcGRvd259IGZyb20gJ0BhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zLXVpL0Ryb3Bkb3duJztcclxuaW1wb3J0IG51Y2xpZGVVcmkgZnJvbSAnQGF0b20taWRlLWNvbW11bml0eS9udWNsaWRlLWNvbW1vbnMvbnVjbGlkZVVyaSc7XHJcbmltcG9ydCBVbml2ZXJzYWxEaXNwb3NhYmxlIGZyb20gJ0BhdG9tLWlkZS1jb21tdW5pdHkvbnVjbGlkZS1jb21tb25zL1VuaXZlcnNhbERpc3Bvc2FibGUnO1xyXG5pbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XHJcbmltcG9ydCB7b2JzZXJ2ZVByb2plY3RQYXRoc0FsbEZyb21Tb3VyY2VQYXRoc1NlcnZpY2V9IGZyb20gJy4vdXRpbHMnO1xyXG5cclxudHlwZSBQcm9wcyA9IHt8XHJcbiAgK29uU2VsZWN0OiAoc2VsZWN0ZWRTb3VyY2U6ID9OdWNsaWRlVXJpKSA9PiB2b2lkLFxyXG4gICtkZXNlcmlhbGl6ZTogKCkgPT4gP3N0cmluZyxcclxufH07XHJcblxyXG50eXBlIFN0YXRlID0ge1xyXG4gIHNlbGVjdGFibGVTb3VyY2VzOiBBcnJheTxTdWdnZXN0ZWRQcm9qZWN0UGF0aD4sXHJcbiAgc2VsZWN0ZWRTb3VyY2U6ID9TdWdnZXN0ZWRQcm9qZWN0UGF0aCxcclxufTtcclxuXHJcbmV4cG9ydCBjbGFzcyBTb3VyY2VTZWxlY3RvciBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxQcm9wcywgU3RhdGU+IHtcclxuICBfZGlzcG9zYWJsZXM6IFVuaXZlcnNhbERpc3Bvc2FibGU7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByb3BzOiBQcm9wcykge1xyXG4gICAgc3VwZXIocHJvcHMpO1xyXG4gICAgdGhpcy5fZGlzcG9zYWJsZXMgPSBuZXcgVW5pdmVyc2FsRGlzcG9zYWJsZSgpO1xyXG4gICAgdGhpcy5zdGF0ZSA9IHtzZWxlY3RhYmxlU291cmNlczogW10sIHNlbGVjdGVkU291cmNlOiBudWxsfTtcclxuICB9XHJcblxyXG4gIF9nZXROZXdseVNlbGVjdGVkU291cmNlKFxyXG4gICAgc2VsZWN0ZWRTb3VyY2U6ID9TdWdnZXN0ZWRQcm9qZWN0UGF0aCxcclxuICAgIHByb2plY3RQYXRoczogQXJyYXk8U3VnZ2VzdGVkUHJvamVjdFBhdGg+LFxyXG4gICAgZGVzZXJpYWxpemVkUHJvamVjdFBhdGg6ID9zdHJpbmcsXHJcbiAgKTogP1N1Z2dlc3RlZFByb2plY3RQYXRoIHtcclxuICAgIGxldCBuZXdTZWxlY3RlZFNvdXJjZSA9IG51bGw7XHJcbiAgICBpZiAoc2VsZWN0ZWRTb3VyY2UgIT0gbnVsbCkge1xyXG4gICAgICBuZXdTZWxlY3RlZFNvdXJjZSA9IHByb2plY3RQYXRocy5pbmNsdWRlcyhzZWxlY3RlZFNvdXJjZSlcclxuICAgICAgICA/IHNlbGVjdGVkU291cmNlXHJcbiAgICAgICAgOiBudWxsO1xyXG4gICAgfVxyXG4gICAgaWYgKG5ld1NlbGVjdGVkU291cmNlID09IG51bGwgJiYgcHJvamVjdFBhdGhzLmxlbmd0aCA+IDApIHtcclxuICAgICAgY29uc3QgbWF0Y2hlcyA9IHByb2plY3RQYXRocy5maWx0ZXIoXHJcbiAgICAgICAgcHJvamVjdFBhdGggPT4gcHJvamVjdFBhdGgucHJvamVjdFBhdGggPT09IGRlc2VyaWFsaXplZFByb2plY3RQYXRoLFxyXG4gICAgICApO1xyXG4gICAgICBuZXdTZWxlY3RlZFNvdXJjZSA9IG1hdGNoZXMubGVuZ3RoID4gMCA/IG1hdGNoZXNbMF0gOiBwcm9qZWN0UGF0aHNbMF07XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbmV3U2VsZWN0ZWRTb3VyY2U7XHJcbiAgfVxyXG5cclxuICBjb21wb25lbnREaWRNb3VudCgpIHtcclxuICAgIHRoaXMuX2Rpc3Bvc2FibGVzLmFkZChcclxuICAgICAgb2JzZXJ2ZVByb2plY3RQYXRoc0FsbEZyb21Tb3VyY2VQYXRoc1NlcnZpY2UoXHJcbiAgICAgICAgKHByb2plY3RQYXRoczogQXJyYXk8U3VnZ2VzdGVkUHJvamVjdFBhdGg+KSA9PiB7XHJcbiAgICAgICAgICBjb25zdCBuZXdTZWxlY3RlZFNvdXJjZSA9IHRoaXMuX2dldE5ld2x5U2VsZWN0ZWRTb3VyY2UoXHJcbiAgICAgICAgICAgIC8vIFRPRE86ICh3YmlubnNzbWl0aCkgVDMwNzcxNDM1IHRoaXMgc2V0U3RhdGUgZGVwZW5kcyBvbiBjdXJyZW50IHN0YXRlXHJcbiAgICAgICAgICAgIC8vIGFuZCBzaG91bGQgdXNlIGFuIHVwZGF0ZXIgZnVuY3Rpb24gcmF0aGVyIHRoYW4gYW4gb2JqZWN0XHJcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC9uby1hY2Nlc3Mtc3RhdGUtaW4tc2V0c3RhdGVcclxuICAgICAgICAgICAgdGhpcy5zdGF0ZS5zZWxlY3RlZFNvdXJjZSxcclxuICAgICAgICAgICAgcHJvamVjdFBhdGhzLFxyXG4gICAgICAgICAgICB0aGlzLnByb3BzLmRlc2VyaWFsaXplKCksXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XHJcbiAgICAgICAgICAgIHNlbGVjdGFibGVTb3VyY2VzOiBwcm9qZWN0UGF0aHMsXHJcbiAgICAgICAgICAgIHNlbGVjdGVkU291cmNlOiBuZXdTZWxlY3RlZFNvdXJjZSxcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICksXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XHJcbiAgICB0aGlzLl9kaXNwb3NhYmxlcy5kaXNwb3NlKCk7XHJcbiAgfVxyXG5cclxuICBfZ2V0TGFiZWxGcm9tU291cmNlKHNvdXJjZTogU3VnZ2VzdGVkUHJvamVjdFBhdGgpIHtcclxuICAgIGNvbnN0IHtwcm9qZWN0UGF0aCwgaG9zdExhYmVsfSA9IHNvdXJjZTtcclxuICAgIGNvbnN0IGJhc2VuYW1lID0gbnVjbGlkZVVyaS5iYXNlbmFtZShwcm9qZWN0UGF0aCk7XHJcbiAgICByZXR1cm4gaG9zdExhYmVsICsgJyAtICcgKyBiYXNlbmFtZTtcclxuICB9XHJcblxyXG4gIF9zb3VyY2VUb09wdGlvbiA9IChzb3VyY2U6IFN1Z2dlc3RlZFByb2plY3RQYXRoKSA9PiB7XHJcbiAgICBjb25zdCBsYWJlbCA9IHRoaXMuX2dldExhYmVsRnJvbVNvdXJjZShzb3VyY2UpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdmFsdWU6IHNvdXJjZSxcclxuICAgICAgbGFiZWwsXHJcbiAgICAgIHNlbGVjdGVkTGFiZWw6IGxhYmVsLFxyXG4gICAgfTtcclxuICB9O1xyXG5cclxuICBzZXRTdGF0ZShwYXJ0aWFsU3RhdGU6IE9iamVjdCwgY2FsbGJhY2s/OiAoKSA9PiBtaXhlZCk6IHZvaWQge1xyXG4gICAgY29uc3QgZnVsbFN0YXRlOiBTdGF0ZSA9IHtcclxuICAgICAgLi4udGhpcy5zdGF0ZSxcclxuICAgICAgLi4ucGFydGlhbFN0YXRlLFxyXG4gICAgfTtcclxuICAgIHN1cGVyLnNldFN0YXRlKGZ1bGxTdGF0ZSwgKCkgPT4ge1xyXG4gICAgICB0aGlzLnByb3BzLm9uU2VsZWN0KGlkeChmdWxsU3RhdGUsIF8gPT4gXy5zZWxlY3RlZFNvdXJjZS5wcm9qZWN0UGF0aCkpO1xyXG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjaygpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICByZW5kZXIoKTogUmVhY3QuTm9kZSB7XHJcbiAgICBjb25zdCB7c2VsZWN0YWJsZVNvdXJjZXMsIHNlbGVjdGVkU291cmNlfSA9IHRoaXMuc3RhdGU7XHJcbiAgICBjb25zdCBvcHRpb25zID0gc2VsZWN0YWJsZVNvdXJjZXMubWFwKHRoaXMuX3NvdXJjZVRvT3B0aW9uKTtcclxuICAgIGlmIChvcHRpb25zLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4gKFxyXG4gICAgICAgIDxkaXY+XHJcbiAgICAgICAgICBObyBQcm9qZWN0cyBGb3VuZC4gUGxlYXNlIGFkZCBhIHByb2plY3QgdG8geW91ciBmaWxlIHRyZWUgc28gdGhlXHJcbiAgICAgICAgICBkZWJ1Z2dlciBjYW4gZmluZCBzb3VyY2VzLlxyXG4gICAgICAgIDwvZGl2PlxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gICAgY29uc3QgcG90ZW50aWFsbHlXcm9uZ1NvdXJjZUxhYmVsID1cclxuICAgICAgc2VsZWN0ZWRTb3VyY2UgIT0gbnVsbCAmJiAhc2VsZWN0ZWRTb3VyY2Uuc3VnZ2VzdGVkID8gKFxyXG4gICAgICAgIDxsYWJlbD5cclxuICAgICAgICAgIE51Y2xpZGUgaXMgbm90IHN1cmUgdGhhdCB5b3UgaGF2ZSBzZWxlY3RlZCBhIHByb2plY3Qgd2hpY2ggY29udGFpbnNcclxuICAgICAgICAgIHNvdXJjZXMgdGhlIGRlYnVnZ2VyIGNhbiB1c2UuIFBsZWFzZSBkb3VibGUgY2hlY2sgdGhhdCB5b3VyIHNlbGVjdGVkXHJcbiAgICAgICAgICBzb3VyY2UgaXMgY29ycmVjdC5cclxuICAgICAgICA8L2xhYmVsPlxyXG4gICAgICApIDogbnVsbDtcclxuICAgIHJldHVybiAoXHJcbiAgICAgIDxkaXY+XHJcbiAgICAgICAgPERyb3Bkb3duXHJcbiAgICAgICAgICBvcHRpb25zPXtvcHRpb25zfVxyXG4gICAgICAgICAgb25DaGFuZ2U9e29wdGlvbiA9PiB0aGlzLnNldFN0YXRlKHtzZWxlY3RlZFNvdXJjZTogb3B0aW9ufSl9XHJcbiAgICAgICAgICBwbGFjZWhvbGRlcj17J1NlbGVjdCBhIHNvdXJjZSd9XHJcbiAgICAgICAgICB2YWx1ZT17c2VsZWN0ZWRTb3VyY2V9XHJcbiAgICAgICAgLz5cclxuICAgICAgICB7cG90ZW50aWFsbHlXcm9uZ1NvdXJjZUxhYmVsfVxyXG4gICAgICA8L2Rpdj5cclxuICAgICk7XHJcbiAgfVxyXG59XHJcbiJdfQ==